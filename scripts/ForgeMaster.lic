=begin
ForgeMaster, by Dintarl

Can be set up to gain skill in any or all forging disciplines.  Has options to create a forging hammer or a perfect forging hammer, and will create the hammer prior to moving on to the non-crafting disciplines.  Works in any town.

To set up:  ;forgemaster setup

Special thanks to SpiffyJr for the code used in creating the GUI. 

Should be updated to get along with ClimateWear scripts.
=end

settings 					= CharSettings.to_hash

setup = proc {
	gtk_globals = Hash.new
	gtk_locals = Hash.new

	window = window_action = nil

	Gtk.queue {
#		ttips = Gtk::Tooltips.new.enable
		ttips_text = {
			'mainforgebag' => "This is the bag for your bars",
			'cutterbag' => "This is the bag for your cut bars - must be different from the Main Forge Bag",
			'fsilveramount' => "How much you want to withdraw",
			'fmindstate' => "When you want to rest.  8=Continue without stopping, 7=Fried, 6=Numbed, 5=Becoming Numbed, 4=Muddled. I do not suggest setting this lower than 4.",
			'trashtype' => "The type of trash can your forge has.  Use Barrel for Teras and Zul Logoth, Bin everwhere else.",
			'doohe' => "Check this to rank OHE",
			'doohb' => "Check this to rank OHB",
			'dopole' => "Check this to rank Polearms",
			'dothw' => "Check this to rank THW",
			'dobrawl' => "Check this to rank Brawling",
			'docraft' => "Check this to rank Crafting",
			'fneedhammer' => "Check this to create a forging hammer.  Note: this will NOT create a perfect.",
			'fneedperfect' => "Check this to create a perfect hammer.      Note: this is a LOT more expensive.",
			'fstowhammer' => "Check this if you want to put your hammer in your main forging bag instead of wearing it."
		}

		gtk_globals['mainforgebag'] = Gtk::Entry.new; gtk_globals['mainforgebag'].text = (UserVars.mainforgebag ||= "")
		gtk_globals['cutterbag'] = Gtk::Entry.new; gtk_globals['cutterbag'].text = (UserVars.cutterbag ||= "")
		gtk_globals['fsilveramount'] = Gtk::Entry.new; gtk_globals['fsilveramount'].text = (UserVars.fsilveramount ||= "")
		gtk_globals['fmindstate'] = Gtk::Entry.new; gtk_globals['fmindstate'].text = (UserVars.fmindstate ||= "")
		gtk_globals['trashtype'] = Gtk::Entry.new; gtk_globals['trashtype'].text = (UserVars.trashtype ||= "")

		gtk_locals['doohe'] = Gtk::CheckButton.new('(?) One Handed Edged'); gtk_locals['doohe'].active = (settings['doohe'] ||= false)
		gtk_locals['doohb'] = Gtk::CheckButton.new('(?) One Handed Blunt'); gtk_locals['doohb'].active = ( settings['doohb'] ||= false)
		gtk_locals['dopole'] = Gtk::CheckButton.new('(?) Polearms'); gtk_locals['dopole'].active = (settings['dopole'] ||= false)
		gtk_locals['dothw'] = Gtk::CheckButton.new('(?) Two Handed Weapons'); gtk_locals['dothw'].active = (settings['dothw'] ||= false)
		gtk_locals['dobrawl'] = Gtk::CheckButton.new('(?) Brawling Weapons'); gtk_locals['dobrawl'].active = (settings['dobrawl'] ||= false)
		gtk_locals['docraft'] = Gtk::CheckButton.new('(?) Crafting'); gtk_locals['docraft'].active = (settings['docraft'] ||= false)
		gtk_locals['fneedhammer'] = Gtk::CheckButton.new('(?) Make a Hammer'); gtk_locals['fneedhammer'].active = (settings['fneedhammer'] ||= false)
		gtk_locals['fneedperfect'] = Gtk::CheckButton.new('(?) Make a Perfect Hammer'); gtk_locals['fneedperfect'].active = (settings['fneedperfect'] ||= false)
		gtk_locals['fstowhammer'] = Gtk::CheckButton.new('(?) Store forging-hammer in Main Forge Bag.  Will wear if unchecked.'); gtk_locals['fstowhammer'].active = (settings['fstowhammer'] ||= false)

	# Add tooltips
		ttips_text.each_pair { |widget,tip|
			if widget = gtk_globals[widget] || gtk_locals[widget]
				widget.set_tooltip_text(tip).has_tooltip = true
			end
		}

	# Primary Window
		window = Gtk::Window.new
		window.title = "ForgeMaster configuration for #{Char.name}"
		window.border_width = 3
		window.resizable = true
		window.resize(450, 300)

		nb = Gtk::Notebook.new.set_show_border(true)

		vb_pg1 = Gtk::Box.new(:vertical, 1).set_border_width(3)

		vb_pg1_1 = Gtk::Box.new(:vertical, 1).set_border_width(3)
		fr_pg1_1 = Gtk::Frame.new.set_border_width(5).set_label_widget(Gtk::Label.new.set_markup('<big><b>Settings</b></big>'))
		fr_pg1_1.add(vb_pg1_1)
		vb_pg1.pack_start(fr_pg1_1, :expand => false, :fill => false, :padding => 0)

		lbl = Gtk::Label.new.set_markup("Configuration Settings for #{Char.name}:")
		lbl.set_wrap(true).set_width_request(600).set_padding(0,10)
		vb_pg1_1.pack_start(lbl, :expand => false, :fill => false, :padding => 0)

		hb = Gtk::Box.new(:horizontal, 1)
		hb.pack_start(Gtk::Alignment.new(0,0,0,1).add(gtk_locals['docraft'].set_width_request(180)), :expand => false, :fill => false, :padding => 0)
		hb.pack_start(Gtk::Alignment.new(0,0,0,1).add(gtk_locals['doohe'].set_width_request(180)), :expand => false, :fill => false, :padding => 0)
		hb.pack_start(Gtk::Alignment.new(0,0,0,1).add(gtk_locals['doohb'].set_width_request(180)), :expand => false, :fill => false, :padding => 0)
		vb_pg1_1.pack_start(hb, :expand => false, :fill => false, :padding => 0)

		hb = Gtk::Box.new(:horizontal, 1)
		hb.pack_start(Gtk::Alignment.new(0,0,0,1).add(gtk_locals['dobrawl'].set_width_request(180)), :expand => false, :fill => false, :padding => 0)
		hb.pack_start(Gtk::Alignment.new(0,0,0,1).add(gtk_locals['dothw'].set_width_request(180)), :expand => false, :fill => false, :padding => 0)
		hb.pack_start(Gtk::Alignment.new(0,0,0,1).add(gtk_locals['dopole'].set_width_request(180)), :expand => false, :fill => false, :padding => 0)
		vb_pg1_1.pack_start(hb, :expand => false, :fill => false, :padding => 0)

		hb = Gtk::Box.new(:horizontal, 1)
		hb.pack_start(Gtk::Alignment.new(1,0,0,1).add(Gtk::Label.new('Main Forge Bag: ')).set_width_request(130))
		hb.pack_start(gtk_globals['mainforgebag'], :expand => false, :fill => false, :padding => 0)
		hb.pack_start(Gtk::Alignment.new(1,0,0,1).add(Gtk::Label.new('Cut Bars Bag: ')).set_width_request(130))
		hb.pack_start(gtk_globals['cutterbag'], :expand => false, :fill => false, :padding => 0)
		vb_pg1_1.pack_start(hb, :expand => false, :fill => false, :padding => 0)

		hb = Gtk::Box.new(:horizontal, 1)
		hb.pack_start(Gtk::Alignment.new(1,0,0,1).add(Gtk::Label.new('Silvers to Withdraw: ')).set_width_request(130))
		hb.pack_start(gtk_globals['fsilveramount'], :expand => false, :fill => false, :padding => 0)
		hb.pack_start(Gtk::Alignment.new(1,0,0,1).add(Gtk::Label.new('Mind State to Rest At: ')).set_width_request(130))
		hb.pack_start(gtk_globals['fmindstate'], :expand => false, :fill => false, :padding => 0)
		vb_pg1_1.pack_start(hb, :expand => false, :fill => false, :padding => 0)

		hb = Gtk::Box.new(:horizontal, 1)
		hb.pack_start(Gtk::Alignment.new(1,0,0,1).add(Gtk::Label.new('Trash Bin Type: ')).set_width_request(130))
		hb.pack_start(gtk_globals['trashtype'], :expand => false, :fill => false, :padding => 0)
		vb_pg1_1.pack_start(hb, :expand => false, :fill => false, :padding => 0)

		hb = Gtk::Box.new(:horizontal, 1)
		hb.pack_start(Gtk::Alignment.new(0,0,0,1).add(gtk_locals['fneedhammer'].set_width_request(180)), :expand => false, :fill => false, :padding => 0)
		hb.pack_start(Gtk::Alignment.new(0,0,0,1).add(gtk_locals['fneedperfect'].set_width_request(180)), :expand => false, :fill => false, :padding => 0)
		vb_pg1_1.pack_start(hb, :expand => false, :fill => false, :padding => 0)

		hb = Gtk::Box.new(:horizontal, 1)
		hb.pack_start(Gtk::Alignment.new(0,0,0,1).add(gtk_locals['fstowhammer'].set_width_request(480)), :expand => false, :fill => false, :padding => 0)
		vb_pg1_1.pack_start(hb, :expand => false, :fill => false, :padding => 0)

		nb.append_page(vb_pg1,Gtk::Label.new('Settings'))

		lbl = Gtk::Label.new.set_markup("")
		lbl.set_wrap(true).set_width_request(600).set_padding(0,0)
		vb_pg1_1.pack_start(lbl, :expand => false, :fill => false, :padding => 0)

		lbl = Gtk::Label.new.set_markup("Like my original StormFront scripts, this is NOT intended for AFK use.")
		lbl.set_wrap(true).set_width_request(600).set_padding(0,0)
		vb_pg1_1.pack_start(lbl, :expand => false, :fill => false, :padding => 0)

		lbl = Gtk::Label.new.set_markup("Thank you to SpiffyJr, whose code I cannibalized to make this setup GUI.")
		lbl.set_wrap(true).set_width_request(600).set_padding(0,0)
		vb_pg1_1.pack_start(lbl, :expand => false, :fill => false, :padding => 0)

		lbl = Gtk::Label.new.set_markup("-Dintarl")
		lbl.set_wrap(true).set_width_request(600).set_padding(0,0)
		vb_pg1_1.pack_start(lbl, :expand => false, :fill => false, :padding => 0)

	#Save/Close Buttons

		hb_saveclose = Gtk::Box.new(:horizontal, 0)
		save = Gtk::Button.new(:label => 'Save')
		close = Gtk::Button.new(:label => 'Exit')

		save.signal_connect('clicked') { window_action = :save }
		close.signal_connect('clicked') { window_action = :done }

		hb_saveclose.pack_start(save, :expand => false, :fill => false, :padding => 0)
		hb_saveclose.pack_start(close, :expand => false, :fill => false, :padding => 0)

	#Box for Save/Close Buttons

		vb_main = Gtk::Box.new(:vertical, 5)
		vb_main.border_width = 3

		vb_main.pack_start(nb, :expand => false, :fill => false, :padding => 0)
		vb_main.pack_start(Gtk::Alignment.new(1,0,0,0).add(hb_saveclose), :expand => false, :fill => false, :padding => 0)

		window.signal_connect('delete_event') { respond window.allocation.width; window_action = :exit }

		window.add(vb_main)
		window.show_all
		window.keep_above = true # On windows keep_above is required AFTER show_all
	}

	before_dying { Gtk.queue { window.destroy } }
	wait_while { window_action.nil? }
	undo_before_dying
	Gtk.queue { window.destroy }

	clean_entry = proc { |entry|
		entry.text = entry.text.strip
		if entry.text.empty?
			entry.text = ""
		end

		entry.text
	}

	if window_action == :save
		gtk_globals.each_pair { |option,widget|
			if widget.class == Gtk::CheckButton
				UserVars.change(option,widget.active?,:char)
			elsif widget.class == Gtk::Entry
				UserVars.change(option,clean_entry.call(widget),:char)
			else
				echo "error: unknown global widget #{option} [#{widget.class}]"
			end
		}

		gtk_locals.each_pair { |option,widget|
			if widget.class == Gtk::CheckButton
			#	UserVars.change(option,widget.active?,:char)
				settings[option] = widget.active?
			elsif widget.class == Gtk::Entry
				settings[option] = clean_entry.call(widget)
			else
				echo "error: unknown local widget #{option} [#{widget.class}]"
			end
		}

		echo 'settings saved'
	else
		echo 'closed without saving'
	end
}

if script.vars[1] =~  /^setup$/i
	setup.call
end

exit unless script.vars[1].nil?

### ORDER OF OPERATIONS ###

multifput"open my #{UserVars.mainforgebag}","open my #{UserVars.cutterbag}"
goto "CSTART"

CSTART:
if settings['docraft']
	goto "START"
else
	goto "DCRAFT"
end

DCRAFT:
if settings['fneedperfect']
	goto 'FSTART'
elsif settings['fneedhammer']
	goto "HSTART"
else
	goto "DHAMMER"
end

DHAMMER:
if settings['doohe']
	goto "ESTART"
else
	goto "DEDGED"
end

DEDGED:
if settings['doohb']
	goto "BSTART"
else
	goto "DBLUNT"
end

DBLUNT:
if settings['dobrawl']
	goto "TSTART"
else
	goto "DBRAWL"
end

DBRAWL:
if settings['dothw']
	goto "RSTART"
else
	goto "DTHW"
end

DTHW:
if settings['dopole']
	goto "PSTART"
else
	goto "DPOLE"
end

DPOLE:
respond(""); respond("Done with selected crafting.")
respond("")
exit

### CRAFTING SECTION START ###

START:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "APRCHECK"

APRCHECK:
	match "BUYAPRON", "for more options"
	match "STALLSTART", "leather crafter's apron"
	match "STALLSTART", "forging apron"
	fput "inventory"
		matchwait

BUYAPRON:
	multifput "order 1", "buy", "wear apron"
		goto "STALLSTART"

STALLSTART:
	fput "go workshop"
	match "NEEDSILVER1", "You don't have enough silver, rentals"
	match "WORKSTART", "the clerk collects 300 silvers"
	match "WORKSTART", "the clerk directs you to your rented"
	match "WORKSTART", "The clerk collects 300 silvers"
	match "WORKSTART", "The clerk directs you to your rented"
	match "STALLSTART", "...wait"
		matchwait

WORKSTART:
	fput "take block from my #{UserVars.mainforgebag}"
	match "GOTBLOCK", "You remove"
	match "GOTBLOCK", "You grab"
	match "NEEDBLOCK", "Get what?"
	match "WORKSTART", "...wait"
		matchwait

GOTBLOCK:
	fput "swap"
		goto "GLYPH"

GLYPH:
	match "MASTER", "crafting, you are a master"
	match "GLYPH2", "crafting, you are a novice"
	match "GLYPH2", "crafting, you are an apprentice"
	match "GLYPH2", "crafting, you are a journeyman"
	match "GLYPH2", "crafting, you are a skilled"
	match "GLYPH2", "crafting, you are a highly skilled"
	match "GLYPH2", "You rub your chin"
	match "GLYPH", "...wait"
	respond (""); respond ("If this is your first skill point in this skill, enter the THINK command to continue.")
	respond ("")
	fput "artisan skill"
		matchwait

GLYPH2:
	if(checkmind(UserVars.fmindstate))
		respond(""); respond("Waiting for mind to clear.")
		respond("")
		wait_while{checkmind(UserVars.fmindstate)}
		respond(""); respond("Mind is below threshold.  Resuming work.")
		respond("")
		goto "GLYPH2A"
	else
		goto "GLYPH2A"
	end

GLYPH2A:
	match "GLYPH3", "block in your left hand"
	match "SWAP", "block in your right hand"
	match "WORKSTART", "You glance down at your empty hands."
	fput "glance"
		matchwait

SWAP:
	fput "swap"
		goto "GLYPH3"

GLYPH3:
	match "TOOSMALL", "Before the design is complete"
	match "GRINDER", "Your material is marked with a pattern,"
	match "GLYPH3", "...wait"
	fput "stare handle-glyph"
		matchwait

TOOSMALL:
	waitrt?
	match "WORKSTART", "You put"
	match "WORKSTART", "You place"
	match "TOOSMALL", "...wait"
	fput "put my block in #{UserVars.trashtype}"
		matchwait

GRINDER:
	waitrt?
	match "TIMESUP", "The grinding wheel doesn't"
	match "GLYPH", "You decide the safest"
	match "TOOTHPICK", "Things seem to be going fine"
	match "HAMMER", "You finish your work and"
	match "OOPSGRIND", "The material you intend to shape"
	match "OOPSGRIND", "no one can shape materials at the grinder with both hands full"
	match "WORKSTART", "Your hands are empty"
	match "GRINDER", "...wait"
	fput "turn grinder"
		matchwait

OOPSGRIND:
	if GameObj.left_hand.nil?
		goto "OOPSGRIND2"
	else
		fput "put #{GameObj.left_hand} in #{UserVars.trashtype}"
		goto "OOPSGRIND2"
	end

OOPSGRIND2:
	if GameObj.right_hand.nil?
		goto "WORKSTART"
	else
		goto "GOTBLOCK"
	end

TIMESUP:
	fput "out"
	match "NEEDSILVER1", "You don't have enough silver, rentals"
	match "GRINDER", "the clerk collects 300 silvers"
	match "GRINDER", "The clerk collects 300 silvers"
	fput "go workshop"
		matchwait

TOOTHPICK:
	waitrt?
	match "WORKSTART", "You put"
	match "WORKSTART", "You place"
	match "TOOTHPICK", "...wait"
	fput "put my tooth in #{UserVars.trashtype}"
		matchwait

HAMMER:
	waitrt?
	match "GLYPH", "You put"
	match "GLYPH", "You place"
	match "HAMMER", "...wait"
	multifput "swap", "put my hammer in #{UserVars.trashtype}"
		matchwait

NEEDBLOCK:
	fput "out"
	goto "NEEDBLOCK2"

NEEDBLOCK2:
	match "NEEDSILVER2", "But you do not have enough silver!"
	match "PACKIT", "placed your purchases in this"
	multifput "order 3 of 3", "buy"
		matchwait

PACKIT:
	match "PACKIT2", "and everything falls in"
	match "PACKIT", "...wait"
	multifput "open my package", "empty my package in my #{UserVars.mainforgebag}"
		matchwait

PACKIT2:
	waitrt?
	match "FORGEBACKIN", "You throw"
	match "PACKIT2", "...wait"
	fput "throw my package"
		matchwait

FORGEBACKIN:
	match "NEEDSILVER1", "You don't have enough silver, rentals are"
	match "WORKSTART", "the clerk directs you to your rented"
	match "WORKSTART", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

NEEDSILVER1:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "STALLSTART"

NEEDSILVER2:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "NEEDBLOCK2"

MASTER:
	match "MASTER3", "Get what?"
	match "MASTER2", "You remove"
	match "MASTER2", "You grab"
	match "MASTER", "...wait"
	fput "get block from my #{UserVars.mainforgebag}"
		matchwait

MASTER2:
	put "put my block in #{UserVars.trashtype}"
		goto "MASTER"

MASTER3:
	multifput "put my block in #{UserVars.trashtype}","out"
	respond(""); respond("Congratulations! You have mastered crafting!")
	respond("")
	goto "DCRAFT"

### EDGED SECTION START ###

ESTART:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "EAPRCHECK"

EAPRCHECK:
	match "EBUYAPRON", "for more options"
	match "ESTALLSTART", "leather crafter's apron"
	match "ESTALLSTART", "forging apron"
	fput "inventory"
		matchwait

EBUYAPRON:
	multifput "order 1", "buy", "wear apron"
		goto "ESTALLSTART"

ESTALLSTART:
	fput "go workshop"
	match "ENEEDSILVER1", "You don't have enough silver, rentals"
	match "EWORKSTART", "the clerk collects 300 silvers"
	match "EWORKSTART", "the clerk directs you to your rented"
	match "EWORKSTART", "The clerk collects 300 silvers"
	match "EWORKSTART", "The clerk directs you to your rented"
	match "STALLSTART", "...wait"
		matchwait

EWORKSTART:
	match "ECUTTER1", "You remove"
	match "ECUTTER1", "You grab"
	match "EFORGE1", "Get what?"
	match "EWORKSTART", "...wait"
	fput "take bar from my #{UserVars.mainforgebag}"
		matchwait

ECUTTER1:
	match "ECUTTER15", "7lb. piece and a 8lb. piece"
	match "ECUTTER9", "4lb. piece and a 5lb. piece"
	match "ECUTTER6", "in half."
	multifput "swap", "poke slab"
		matchwait

ECUTTER15:
	multifput "push slab", "pull slab"
	waitrt?
	sleep 0.4
	multifput "put #{GameObj.right_hand} in my #{UserVars.mainforgebag}", "swap"
		goto "ECUTTER1"

ECUTTER9:
	multifput "push slab", "pull slab"
	waitrt?
	sleep 0.4
	multifput "put #{GameObj.right_hand} in my #{UserVars.mainforgebag}", "put my bar in my #{UserVars.cutterbag}"
		goto "EWORKSTART"

ECUTTER6:
	fput "pull slab"
	waitrt?
	sleep 0.4
	multifput "put my bar in my #{UserVars.cutterbag}", "put my bar in my #{UserVars.cutterbag}"
		goto "EWORKSTART"

EFORGE1:
	waitrt?
	fput "go door"
		goto "EFORGE2"

EFORGE2:
	match "ENEEDGLYPH", "Get what?"
	match "EFORGE3", "You remove"
	match "EFORGE3", "You grab"
	match "EFORGE2", "...wait"
	fput "take blade-glyph from my #{UserVars.mainforgebag}"
		matchwait

EFORGE3:
	match "EGETBAR", "Get what?"
	match "EGLYPH", "You remove"
	match "EGLYPH", "You grab"
	match "EFORGE3", "...wait"
	fput "take bar from my #{UserVars.cutterbag}"
		matchwait

EGLYPH:
	match "EMASTER", "one handed edged, you are a master"
	match "EGLYPH2", "one handed edged, you are a novice"
	match "EGLYPH2", "one handed edged, you are an apprentice"
	match "EGLYPH2", "one handed edged, you are a journeyman"
	match "EGLYPH2", "one handed edged, you are a skilled"
	match "EGLYPH2", "one handed edged, you are a highly skilled"
	match "EGLYPH2", "You rub your chin"
	match "EGLYPH", "...wait"
	respond (""); respond ("If this is your first skill point in this skill, enter the THINK command to continue.")
	respond ("")
	fput "artisan skill"
		matchwait

EGLYPH2:
	if(checkmind(UserVars.fmindstate))
		respond(""); respond("Waiting for mind to clear.")
		respond("")
		wait_while{checkmind(UserVars.fmindstate)}
		respond(""); respond("Mind is below threshold.  Resuming work.")
		respond("")
		goto "EGLYPH2A"
	else
		goto "EGLYPH2A"
	end

EGLYPH2A:
	match "EGLYPH3", "bar in your left hand"
	match "EGSWAP", "bar in your right hand"
	match "EWORKSTART", "You glance down at your empty hands."
	fput "glance"
		matchwait

EGSWAP:
	fput "swap"
		goto "EGLYPH3"

EGLYPH3:
	match "ETOOSMALL", "Before the design is complete"
	match "EGLYPH4", "Your material is marked with a pattern,"
	match "EGLYPH3", "...wait"
	fput "stare blade-glyph"
		matchwait

EGLYPH4:
	waitrt?
	fput "put my blade-glyph in my #{UserVars.mainforgebag}"
	match "ETONGS1", "You remove"
	match "ETONGS1", "You grab"
	match "EGLYPH4", "...wait"
	match "ENOHAMMER", "What were you referring to?"
	if settings['fstowhammer']
		fput "get forging-hammer from my #{UserVars.mainforgebag}"
	else
		fput "remove my forging-hammer"
	end
		matchwait

ETOOSMALL:
	waitrt?
	match "EWORKSTART", "You put"
	match "EWORKSTART", "You place"
	match "EWORKSTART", "You tuck"
	match "EWORKSTART", "I could not find"
	match "ETOOSMALL", "...wait"
	multifput "go door", "put my bar in #{UserVars.trashtype}", "put my blade-glyph in my #{UserVars.mainforgebag}"
		matchwait

ETONGS1:
	match "ETONGS1", "...wait"
	match "ETONGER", "Reassured that all is ready"
	match "EWATER", "The tempering trough is empty"
	match "ETIME", "The tongs don't budge"
	fput "get tongs"
		matchwait

ETONGER:
	match "ETONGS2", "realizing that there's more"
	match "EGLYPH5", "safest thing to do now"
	match "EDONE", "With a satisfying"
	match "EDONE", "With a brief"
	match "EBREAK", "With a single, faulty blow"
		matchwait

ETONGS2:
	waitrt?
	match "EMASTER", "one handed edged, you are a master"
	match "ETONGS3", "one handed edged, you are an apprentice"
	match "ETONGS3", "one handed edged, you are a novice"
	match "ETONGS3", "one handed edged, you are a journeyman"
	match "ETONGS3", "one handed edged, you are a skilled"
	match "ETONGS3", "one handed edged, you are a highly"
	fput "artisan skill"
		matchwait

ETONGS3:
	if(checkmind(UserVars.fmindstate))
		respond(""); respond("Waiting for mind to clear.")
		respond("")
		wait_while{checkmind(UserVars.fmindstate)}
		respond(""); respond("Mind is below threshold.  Resuming work.")
		respond("")
		goto "ETONGS1"
	else
		goto "ETONGS1"
	end

EGLYPH5:
	waitrt?
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "put my bar in my #{UserVars.cutterbag}"
	else
		multifput "wear my forging-hammer", "put my bar in my #{UserVars.cutterbag}"
	end
	goto "EFORGE2"

EDONE:
	waitrt?
	fput "go door"
	if settings['fstowhammer']
		multifput "put dagger-blade in #{UserVars.trashtype}", "put my forging-hammer in my #{UserVars.mainforgebag}"
	else
		multifput "put dagger-blade in #{UserVars.trashtype}", "wear my forging-hammer"
	end
		goto "EFORGE1"

EWATER:
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "get bucket"
	else
		multifput "wear my forging-hammer", "get bucket"
	end
		goto "EWATER2"

EWATER2:
	waitrt?
	if settings['fstowhammer']
		waitrt?
		pause 1
		fput "get forging-hammer from my #{UserVars.mainforgebag}"
	else
		waitrt?
		pause 1
		fput "remove my forging-hammer"
	end
		goto "ETONGS1"

EBREAK:
	waitrt?
	if settings['fstowhammer']
		fput "put my forging-hammer in my #{UserVars.mainforgebag}"
	else
		fput "wear my forging-hammer"
	end
		goto "EFORGE2"

ETIME:
	multifput "go door", "out"
		goto "ETIME2"

ETIME2:
	match "ENEEDSILVER3", "You don't have enough silver, rentals"
	match "EFORGE4", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

EFORGE4:
	fput "go door"
		goto "ETONGS1"

EGETBAR:
	multifput "put my blade-glyph in my #{UserVars.mainforgebag}", "go door", "out"
	goto "ENEEDBLOCK2"

ENEEDBLOCK2:
	match "ENEEDSILVER2", "But you do not have enough silver!"
	match "EPACKIT", "placed your purchases in this"
	multifput "order 3 of 2", "buy"
		matchwait

EPACKIT:
	match "EPACKIT2", "and everything falls in"
	match "EPACKIT", "...wait"
	multifput "open my package", "empty my package in my #{UserVars.mainforgebag}"
		matchwait

EPACKIT2:
	waitrt?
	match "EFORGEBACKIN", "You throw"
	match "EPACKIT2", "...wait"
	fput "throw my package"
		matchwait

EFORGEBACKIN:
	match "ENEEDSILVER1", "You don't have enough silver, rentals are"
	match "EWORKSTART", "the clerk directs you to your rented"
	match "EWORKSTART", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

ENEEDSILVER1:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "ESTALLSTART"

ENEEDSILVER2:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "ENEEDBLOCK2"

ENEEDSILVER3:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "ETIME2"

ENEEDSILVER4:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "ENEEDGLYPH2"

ENEEDSILVER5:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "EGLYPHIT2"

ENEEDGLYPH:
	multifput "go door", "out"
		goto "ENEEDGLYPH2"

ENEEDGLYPH2:
	match "ENEEDSILVER4", "But you do not have enough silver!"
	match "EGLYPHIT", "placed your purchases in this"
	multifput "order 3 of 14 material wax", "buy"
		matchwait

EGLYPHIT:
	match "EGLYPHIT2", "and everything falls in"
	match "EGLYPHIT", "...wait"
	multifput "open my package", "empty my package in my #{UserVars.mainforgebag}"
		matchwait

EGLYPHIT2:
	waitrt?
	match "EGLYPHIT3", "You throw"
	match "EGLYPHIT2", "...wait"
	fput "throw my package"
		matchwait

EGLYPHIT3:
	waitrt?
	match "ENEEDSILVER5", "You don't have enough silver, rentals are"
	match "EFORGE1", "the clerk directs you to your rented"
	match "EFORGE1", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

EMASTER:
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "put my bar in my #{UserVars.cutterbag}"
	else
		multifput "wear my forging-hammer", "put my bar in my #{UserVars.cutterbag}"
	end
	multifput "go door","put ##{GameObj.left_hand.id} in #{UserVars.trashtype}"
		goto "EMASTER2"

EMASTER2:
	match "EMASTER4", "Get what?"
	match "EMASTER3", "You remove"
	match "EMASTER3", "You grab"
	fput "get blade-glyph from my #{UserVars.mainforgebag}"
		matchwait

EMASTER3:
	fput "put my blade-glyph in #{UserVars.trashtype}"
		goto "EMASTER2"

EMASTER4:
	fput "out"
	respond(""); respond("Congratulations! You have mastered the art of forging one handed edged weapons!")
	respond("")
	goto "DEGDED"

ENOHAMMER:
	multifput "put my bar in my #{UserVars.cutterbag}", "go door", "out"
	respond(""); respond("You need a forging hammer to be able to run this script.  Making one now.")
	respond("")
	goto "HSTART"

### BLUNT SECTION START ###

BSTART:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "BAPRCHECK"

BAPRCHECK:
	match "BBUYAPRON", "for more options"
	match "BSTALLSTART", "leather crafter's apron"
	match "BSTALLSTART", "forging apron"
	fput "inventory"
		matchwait

BBUYAPRON:
	multifput "order 1", "buy", "wear apron"
		goto "BSTALLSTART"

BSTALLSTART:
	fput "go workshop"
	match "BNEEDSILVER1", "You don't have enough silver, rentals"
	match "BWORKSTART", "the clerk collects 300 silvers"
	match "BWORKSTART", "the clerk directs you to your rented"
	match "BWORKSTART", "The clerk collects 300 silvers"
	match "BWORKSTART", "The clerk directs you to your rented"
	match "BSTALLSTART", "...wait"
		matchwait

BWORKSTART:
	match "BCUTTER1", "You remove"
	match "BCUTTER1", "You grab"
	match "BFORGE1", "Get what?"
	match "BWORKSTART", "...wait"
	fput "take bar from my #{UserVars.mainforgebag}"
		matchwait

BCUTTER1:
	match "BCUTTER15", "7lb. piece and a 8lb. piece"
	match "BCUTTER7", "3lb. piece and a 4lb. piece"
	match "BCUTTER8", "in half."
	multifput "swap", "poke slab"
		matchwait

BCUTTER15:
	fput "pull slab"
	waitrt?
	sleep 0.4
	multifput "put #{GameObj.right_hand} in my #{UserVars.mainforgebag}", "swap"
		goto "BCUTTER1"

BCUTTER7:
	fput "pull slab"
	waitrt?
	sleep 0.4
	multifput "put my bar in my #{UserVars.cutterbag}", "put my bar in #{UserVars.trashtype}"
		goto "BWORKSTART"

BCUTTER8:
	fput "pull slab"
	waitrt?
	sleep 0.4
	multifput "put my bar in my #{UserVars.cutterbag}", "put my bar in my #{UserVars.cutterbag}"
		goto "BWORKSTART"

BFORGE1:
	waitrt?
	fput "go door"
		goto "BFORGE2"

BFORGE2:
	match "BNEEDGLYPH", "Get what?"
	match "BFORGE3", "You remove"
	match "BFORGE3", "You grab"
	match "BFORGE2", "...wait"
	fput "take head-glyph from my #{UserVars.mainforgebag}"
		matchwait

BFORGE3:
	match "BGETBAR", "Get what?"
	match "BGLYPH", "You remove"
	match "BGLYPH", "You grab"
	match "BFORGE3", "...wait"
	fput "take bar from my #{UserVars.cutterbag}"
	matchwait

BGLYPH:
	match "BMASTER", "one handed blunt, you are a master"
	match "BGLYPH2", "one handed blunt, you are a novice"
	match "BGLYPH2", "one handed blunt, you are an apprentice"
	match "BGLYPH2", "one handed blunt, you are a journeyman"
	match "BGLYPH2", "one handed blunt, you are a skilled"
	match "BGLYPH2", "one handed blunt, you are a highly skilled"
	match "BGLYPH2", "You rub your chin"
	match "BGLYPH", "...wait"
	respond (""); respond ("If this is your first skill point in this skill, enter the THINK command to continue.")
	respond ("")
	fput "artisan skill"
		matchwait

BGLYPH2:
	if(checkmind(UserVars.fmindstate))
		respond(""); respond("Waiting for mind to clear.")
		respond("")
		wait_while{checkmind(UserVars.fmindstate)}
		respond(""); respond("Mind is below threshold.  Resuming work.")
		respond("")
		goto "BGLYPH2A"
	else
		goto "BGLYPH2A"
	end

BGLYPH2A:
	match "BGLYPH3", "bar in your left hand"
	match "BGSWAP", "bar in your right hand"
	match "BWORKSTART", "You glance down at your empty hands."
	fput "glance"
		matchwait

BGSWAP:
	fput "swap"
		goto "BGLYPH3"

BGLYPH3:
	match "BTOOSMALL", "Before the design is complete"
	match "BGLYPH4", "Your material is marked with a pattern,"
	match "BGLYPH3", "...wait"
	fput "stare head-glyph"
		matchwait

BGLYPH4:
	waitrt?
	fput "put my head-glyph in my #{UserVars.mainforgebag}"
	match "BTONGS1", "You remove"
	match "BTONGS1", "You grab"
	match "BGLYPH4", "...wait"
	match "BNOHAMMER", "What were you referring to?"
	if settings['fstowhammer']
		fput "get forging-hammer from my #{UserVars.mainforgebag}"
	else
		fput "remove my forging-hammer"
	end
		matchwait

BTOOSMALL:
	waitrt?
	match "BWORKSTART", "You put"
	match "BWORKSTART", "You place"
	match "BWORKSTART", "You tuck"
	match "BWORKSTART", "I could not find"
	match "BTOOSMALL", "...wait"
	multifput "go door", "put my bar in #{UserVars.trashtype}", "put my head-glyph in my #{UserVars.mainforgebag}"
		matchwait

BTONGS1:
	match "BTONGS1", "...wait"
	match "BTONGER", "Reassured that all is ready"
	match "BWATER", "The tempering trough is empty"
	match "BTIME", "The tongs don't budge"
	fput "get tongs"
		matchwait

BTONGER:
	match "BTONGS2", "realizing that there's more"
	match "BGLYPH5", "safest thing to do now"
	match "BDONE", "With a satisfying"
	match "BDONE", "With a brief"
	match "BBREAK", "With a single, faulty blow"
		matchwait

BTONGS2:
	waitrt?
	match "BMASTER", "one handed blunt, you are a master"
	match "BTONGS3", "one handed blunt, you are an apprentice"
	match "BTONGS3", "one handed blunt, you are a novice"
	match "BTONGS3", "one handed blunt, you are a journeyman"
	match "BTONGS3", "one handed blunt, you are a skilled"
	match "BTONGS3", "one handed blunt, you are a highly"
	fput "artisan skill"
		matchwait

BTONGS3:
	if(checkmind(UserVars.fmindstate))
		respond(""); respond("Waiting for mind to clear.")
		respond("")
		wait_while{checkmind(UserVars.fmindstate)}
		respond(""); respond("Mind is below threshold.  Resuming work.")
		respond("")
		goto "BTONGS1"
	else
		goto "BTONGS1"
	end

BGLYPH5:
	waitrt?
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "put my bar in my #{UserVars.cutterbag}"
	else
		multifput "wear my forging-hammer", "put my bar in my #{UserVars.cutterbag}"
	end
		goto "BFORGE2"

BDONE:
	waitrt?
	fput "go door"
	if settings['fstowhammer']
		multifput "put cudgel-head in #{UserVars.trashtype}", "put my forging-hammer in my #{UserVars.mainforgebag}"
	else
		multifput "put cudgel-head in #{UserVars.trashtype}", "wear my forging-hammer"
	end
		goto "BFORGE1"

BWATER:
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "get bucket"
	else
		multifput "wear my forging-hammer", "get bucket"
	end
		goto "BWATER2"

BWATER2:
	waitrt?
	if settings['fstowhammer']
		waitrt?
		pause 1
		fput "get forging-hammer from my #{UserVars.mainforgebag}"
	else
		waitrt?
		pause 1
		fput "remove my forging-hammer"
	end
		goto "BTONGS1"

BBREAK:
	waitrt?
	if settings['fstowhammer']
		fput "put my forging-hammer in my #{UserVars.mainforgebag}"
	else
		fput "wear my forging-hammer"
	end
		goto "BFORGE2"

BTIME:
	multifput "go door", "out"
		goto "BTIME2"

BTIME2:
	match "BNEEDSILVER3", "You don't have enough silver, rentals"
	match "BFORGE4", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

BFORGE4:
	fput "go door"
		goto "BTONGS1"

BGETBAR:
	multifput "put my head-glyph in my #{UserVars.mainforgebag}", "go door", "out"
	goto "BNEEDBLOCK2"

BNEEDBLOCK2:
	match "BNEEDSILVER2", "But you do not have enough silver!"
	match "BPACKIT", "placed your purchases in this"
	multifput "order 3 of 2", "buy"
		matchwait

BPACKIT:
	match "BPACKIT2", "and everything falls in"
	match "BPACKIT", "...wait"
	multifput "open my package", "empty my package in my #{UserVars.mainforgebag}"
		matchwait

BPACKIT2:
	waitrt?
	match "BFORGEBACKIN", "You throw"
	match "BPACKIT2", "...wait"
	fput "throw my package"
		matchwait

BFORGEBACKIN:
	match "BNEEDSILVER1", "You don't have enough silver, rentals are"
	match "BWORKSTART", "the clerk directs you to your rented"
	match "BWORKSTART", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

BNEEDSILVER1:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "BSTALLSTART"

BNEEDSILVER2:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "BNEEDBLOCK2"

BNEEDSILVER3:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "BTIME2"

BNEEDSILVER4:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "BNEEDGLYPH2"

BNEEDSILVER5:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "BGLYPHIT2"

BNEEDGLYPH:
	multifput "go door", "out"
		goto "BNEEDGLYPH2"

BNEEDGLYPH2:
	match "BNEEDSILVER4", "But you do not have enough silver!"
	match "BGLYPHIT", "placed your purchases in this"
	multifput "order 3 of 20 material wax", "buy"
		matchwait

BGLYPHIT:
	match "BGLYPHIT2", "and everything falls in"
	match "BGLYPHIT", "...wait"
	multifput "open my package", "empty my package in my #{UserVars.mainforgebag}"
		matchwait

BGLYPHIT2:
	waitrt?
	match "BGLYPHIT3", "You throw"
	match "BGLYPHIT2", "...wait"
	fput "throw my package"
		matchwait

BGLYPHIT3:
	waitrt?
	match "BNEEDSILVER5", "You don't have enough silver, rentals are"
	match "BFORGE1", "the clerk directs you to your rented"
	match "BFORGE1", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

BMASTER:
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "put my bar in my #{UserVars.cutterbag}"
	else
		multifput "wear my forging-hammer", "put my bar in my #{UserVars.cutterbag}"
	end
	multifput "go door","put ##{GameObj.left_hand.id} in #{UserVars.trashtype}"
		goto "BMASTER2"

BMASTER2:
	match "BMASTER4", "Get what?"
	match "BMASTER3", "You remove"
	match "BMASTER3", "You grab"
	fput "get head-glyph from my #{UserVars.mainforgebag}"
		matchwait

BMASTER3:
	fput "put my head-glyph in #{UserVars.trashtype}"
		goto "BMASTER2"

BMASTER4:
	multifput "go door", "out"
	respond(""); respond("Congratulations! You have mastered the art of forging one handed blunt weapons!")
	respond("")
	goto "DBLUNT"

BNOHAMMER:
	multifput "put my bar in my #{UserVars.cutterbag}", "go door", "out"
	respond(""); respond("You need a forging hammer to be able to run this script.  Making one now.")
	respond("")
	goto "HSTART"

### THW SECTION START ###

RSTART:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "RAPRCHECK"

RAPRCHECK:
	match "RBUYAPRON", "for more options"
	match "RSTALLSTART", "leather crafter's apron"
	match "RSTALLSTART", "forging apron"
	fput "inventory"
		matchwait

RBUYAPRON:
	multifput "order 1", "buy", "wear apron"
		goto "RSTALLSTART"

RSTALLSTART:
	fput "go workshop"
	match "RNEEDSILVER1", "You don't have enough silver, rentals"
	match "RWORKSTART", "the clerk collects 300 silvers"
	match "RWORKSTART", "the clerk directs you to your rented"
	match "RWORKSTART", "The clerk collects 300 silvers"
	match "RWORKSTART", "The clerk directs you to your rented"
	match "RSTALLSTART", "...wait"
		matchwait

RWORKSTART:
	match "RCUTTER1", "You remove"
	match "RCUTTER1", "You grab"
	match "RFORGE1", "Get what?"
	match "RWORKSTART", "...wait"
	fput "take bar from my #{UserVars.mainforgebag}"
		matchwait

RCUTTER1:
	match "RCUTTER15", "7lb. piece and a 8lb. piece"
	match "RCUTTER9", "4lb. piece and a 5lb. piece"
	match "RCUTTER6", "in half."
	multifput "swap", "poke slab"
		matchwait

RCUTTER15:
	multifput "push slab", "pull slab"
	waitrt?
	sleep 0.4
	multifput "put #{GameObj.right_hand} in my #{UserVars.mainforgebag}", "swap"
		goto "RCUTTER1"

RCUTTER9:
	multifput "push slab", "pull slab"
	waitrt?
	sleep 0.4
	multifput "put #{GameObj.right_hand} in my #{UserVars.mainforgebag}", "put my bar in my #{UserVars.cutterbag}"
		goto "RWORKSTART"

RCUTTER6:
	fput "pull slab"
	waitrt?
	sleep 0.4
	multifput "put my bar in my #{UserVars.cutterbag}", "put my bar in my #{UserVars.cutterbag}"
		goto "RWORKSTART"

RFORGE1:
	waitrt?
	fput "go door"
		goto "RFORGE2"

RFORGE2:
	match "RNEEDGLYPH", "Get what?"
	match "RFORGE3", "You remove"
	match "RFORGE3", "You grab"
	match "RFORGE2", "...wait"
	fput "take endcap-glyph from my #{UserVars.mainforgebag}"
		matchwait

RFORGE3:
	match "RGETBAR", "Get what?"
	match "RGLYPH", "You remove"
	match "RGLYPH", "You grab"
	match "RFORGE3", "...wait"
	fput "take bar from my #{UserVars.cutterbag}"
		matchwait

RGLYPH:
	match "RMASTER", "two handed weapons, you are a master"
	match "RGLYPH2", "two handed weapons, you are a novice"
	match "RGLYPH2", "two handed weapons, you are an apprentice"
	match "RGLYPH2", "two handed weapons, you are a journeyman"
	match "RGLYPH2", "two handed weapons, you are a skilled"
	match "RGLYPH2", "two handed weapons, you are a highly skilled"
	match "RGLYPH2", "You rub your chin"
	match "RGLYPH", "...wait"
	respond (""); respond ("If this is your first skill point in this skill, enter the THINK command to continue.")
	respond ("")
	fput "artisan skill"
		matchwait

RGLYPH2:
	if(checkmind(UserVars.fmindstate))
		respond(""); respond("Waiting for mind to clear.")
		respond("")
		wait_while{checkmind(UserVars.fmindstate)}
		respond(""); respond("Mind is below threshold.  Resuming work.")
		respond("")
		goto "RGLYPH2A"
	else
		goto "RGLYPH2A"
	end

RGLYPH2A:
	match "RGLYPH3", "bar in your left hand"
	match "RGSWAP", "bar in your right hand"
	match "RWORKSTART", "You glance down at your empty hands."
	fput "glance"
		matchwait

RGSWAP:
	fput "swap"
		goto "RGLYPH3"

RGLYPH3:
	match "RTOOSMALL", "Before the design is complete"
	match "RGLYPH4", "Your material is marked with a pattern,"
	match "RGLYPH3", "...wait"
	fput "stare endcap-glyph"
		matchwait

RGLYPH4:
	waitrt?
	fput "put my endcap-glyph in my #{UserVars.mainforgebag}"
	match "RTONGS1", "You remove"
	match "RTONGS1", "You grab"
	match "RGLYPH4", "...wait"
	match "RNOHAMMER", "What were you referring to?"
	if settings['fstowhammer']
		fput "get forging-hammer from my #{UserVars.mainforgebag}"
	else
		fput "remove my forging-hammer"
	end
		matchwait

RTOOSMALL:
	waitrt?
	match "RWORKSTART", "You put"
	match "RWORKSTART", "You place"
	match "RWORKSTART", "You tuck"
	match "RWORKSTART", "I could not find"
	match "RTOOSMALL", "...wait"
	multifput "go door", "put my bar in #{UserVars.trashtype}", "put my endcap-glyph in my #{UserVars.mainforgebag}"
		matchwait

RTONGS1:
	match "RTONGS1", "...wait"
	match "RTONGER", "Reassured that all is ready"
	match "RWATER", "The tempering trough is empty"
	match "RTIME", "The tongs don't budge"
	fput "get tongs"
		matchwait

RTONGER:
	match "RTONGS2", "realizing that there's more"
	match "RGLYPH5", "safest thing to do now"
	match "RDONE", "With a satisfying"
	match "RDONE", "With a brief"
	match "RBREAK", "With a single, faulty blow"
		matchwait

RTONGS2:
	waitrt?
	match "RMASTER", "two handed weapons, you are a master"
	match "RTONGS3", "two handed weapons, you are an apprentice"
	match "RTONGS3", "two handed weapons, you are a novice"
	match "RTONGS3", "two handed weapons, you are a journeyman"
	match "RTONGS3", "two handed weapons, you are a skilled"
	match "RTONGS3", "two handed weapons, you are a highly"
	fput "artisan skill"
		matchwait

RTONGS3:
	if(checkmind(UserVars.fmindstate))
		respond(""); respond("Waiting for mind to clear.")
		respond("")
		wait_while{checkmind(UserVars.fmindstate)}
		respond(""); respond("Mind is below threshold.  Resuming work.")
		respond("")
		goto "RTONGS1"
	else
		goto "RTONGS1"
	end

RGLYPH5:
	waitrt?
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "put my bar in my #{UserVars.cutterbag}"
	else
		multifput "wear my forging-hammer", "put my bar in my #{UserVars.cutterbag}"
	end
		goto "RFORGE2"

RDONE:
	waitrt?
	fput "go door"
	if settings['fstowhammer']
		multifput "put staff-cap in #{UserVars.trashtype}", "put my forging-hammer in my #{UserVars.mainforgebag}"
	else
		multifput "put staff-cap in #{UserVars.trashtype}", "wear my forging-hammer"
	end
		goto "RFORGE1"

RWATER:
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "get bucket"
	else
		multifput "wear my forging-hammer", "get bucket"
	end
		goto "RWATER2"

RWATER2:
	waitrt?
	if settings['fstowhammer']
		waitrt?
		pause 1
		fput "get my forging-hammer from my #{UserVars.mainforgebag}"
	else
		waitrt?
		pause 1
		fput "remove my forging"
	end
		goto "RTONGS1"

RBREAK:
	waitrt?
	if settings['fstowhammer']
		fput "put my forging-hammer in my #{UserVars.mainforgebag}"
	else
		fput "wear my forging-hammer"
	end
		goto "RFORGE2"

RTIME:
	multifput "go door", "out"
		goto "RTIME2"

RTIME2:
	match "RNEEDSILVER3", "You don't have enough silver, rentals"
	match "RFORGE4", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

RFORGE4:
	fput "go door"
		goto "RTONGS1"

RGETBAR:
	multifput "put my endcap-glyph in my #{UserVars.mainforgebag}", "go door", "out"
	goto "RNEEDBLOCK2"

RNEEDBLOCK2:
	match "RNEEDSILVER2", "But you do not have enough silver!"
	match "RPACKIT", "placed your purchases in this"
	multifput "order 3 of 2", "buy"
		matchwait

RPACKIT:
	match "RPACKIT2", "and everything falls in"
	match "RPACKIT", "...wait"
	multifput "open my package", "empty my package in my #{UserVars.mainforgebag}"
		matchwait

RPACKIT2:
	waitrt?
	match "RFORGEBACKIN", "You throw"
	match "RAPRCHECKPACKIT2", "...wait"
	fput "throw my package"
		matchwait

RFORGEBACKIN:
	match "RNEEDSILVER1", "You don't have enough silver, rentals are"
	match "RWORKSTART", "the clerk directs you to your rented"
	match "RWORKSTART", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

RNEEDSILVER1:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "RSTALLSTART"

RNEEDSILVER2:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "RNEEDBLOCK2"

RNEEDSILVER3:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "RTIME2"

RNEEDSILVER4:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "RNEEDGLYPH2"

RNEEDSILVER5:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "RGLYPHIT2"

RNEEDGLYPH:
	multifput "go door", "out"
		goto "RNEEDGLYPH2"

RNEEDGLYPH2:
	match "RNEEDSILVER4", "But you do not have enough silver!"
	match "RGLYPHIT", "placed your purchases in this"
	multifput "order 3 of 26 material wax", "buy"
		matchwait

RGLYPHIT:
	match "RGLYPHIT2", "and everything falls in"
	match "RGLYPHIT", "...wait"
	multifput "open my package", "empty my package in my #{UserVars.mainforgebag}"
		matchwait

RGLYPHIT2:
	waitrt?
	match "RGLYPHIT3", "You throw"
	match "RGLYPHIT2", "...wait"
	fput "throw my package"
		matchwait

RGLYPHIT3:
	waitrt?
	match "RNEEDSILVER5", "You don't have enough silver, rentals are"
	match "RFORGE1", "the clerk directs you to your rented"
	match "RFORGE1", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

RMASTER:
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "put my bar in my #{UserVars.cutterbag}"
	else
		multifput "wear my forging-hammer", "put my bar in my #{UserVars.cutterbag}"
	end
	multifput "go door","put ##{GameObj.left_hand.id} in #{UserVars.trashtype}"
		goto "RMASTER2"

RMASTER2:
	match "RMASTER4", "Get what?"
	match "RMASTER3", "You remove"
	match "RMASTER3", "You grab"
	fput "get endcap-glyph from my #{UserVars.mainforgebag}"
		matchwait

RMASTER3:
	fput "put my endcap-glyph in #{UserVars.trashtype}"
		goto "RMASTER2"

RMASTER4:
	multifput "go door", "out"
	respond(""); respond("Congratulations! You have mastered the art of forging two handed weapons!")
	respond("")
	goto "DTHW"

RNOHAMMER:
	multifput "put my bar in my #{UserVars.cutterbag}", "go door", "out"
	respond(""); respond("You need a forging hammer to be able to run this script.  Making one now.")
	respond("")
	goto "HSTART"

### BRAWL SECTION START ###

TSTART:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "TAPRCHECK"

TAPRCHECK:
	match "TBUYAPRON", "for more options"
	match "TSTALLSTART", "leather crafter's apron"
	match "TSTALLSTART", "forging apron"
	fput "inventory"
		matchwait

TBUYAPRON:
	multifput "order 1", "buy", "wear apron"
		goto "TSTALLSTART"

TSTALLSTART:
	fput "go workshop"
	match "TNEEDSILVER1", "You don't have enough silver, rentals"
	match "TWORKSTART", "the clerk collects 300 silvers"
	match "TWORKSTART", "the clerk directs you to your rented"
	match "TWORKSTART", "The clerk collects 300 silvers"
	match "TWORKSTART", "The clerk directs you to your rented"
	match "TSTALLSTART", "...wait"
		matchwait

TWORKSTART:
	match "TCUTTER1", "You remove"
	match "TCUTTER1", "You grab"
	match "TFORGE1", "Get what?"
	match "TWORKSTART", "...wait"
	fput "take bar from my #{UserVars.mainforgebag}"
		matchwait

TCUTTER1:
	match "TCUTTER15", "7lb. piece and a 8lb. piece"
	match "TCUTTER9", "4lb. piece and a 5lb. piece"
	match "TCUTTER6", "in half."
	multifput "swap", "poke slab"
		matchwait

TCUTTER15:
	multifput "push slab", "pull slab"
	waitrt?
	sleep 0.4
	multifput "put #{GameObj.right_hand} in my #{UserVars.mainforgebag}", "swap"
		goto "TCUTTER1"

TCUTTER9:
	multifput "push slab", "pull slab"
	waitrt?
	sleep 0.4
	multifput "put #{GameObj.right_hand} in my #{UserVars.mainforgebag}", "put my bar in my #{UserVars.cutterbag}"
		goto "TWORKSTART"

TCUTTER6:
	fput "pull slab"
	waitrt?
	sleep 0.4
	multifput "put my bar in my #{UserVars.cutterbag}", "put my bar in my #{UserVars.cutterbag}"
		goto "TWORKSTART"

TFORGE1:
	waitrt?
	fput "go door"
		goto "TFORGE2"

TFORGE2:
	match "TNEEDGLYPH", "Get what?"
	match "TFORGE3", "You remove"
	match "TFORGE3", "You grab"
	match "TFORGE2", "...wait"
	fput "take blade-glyph from my #{UserVars.mainforgebag}"
		matchwait

TFORGE3:
	match "TGETBAR", "Get what?"
	match "TGLYPH", "You remove"
	match "TGLYPH", "You grab"
	match "TFORGE3", "...wait"
	fput "take bar from my #{UserVars.cutterbag}"
		matchwait

TGLYPH:
	match "TMASTER", "brawling weapons, you are a master"
	match "TGLYPH2", "brawling weapons, you are a novice"
	match "TGLYPH2", "brawling weapons, you are an apprentice"
	match "TGLYPH2", "brawling weapons, you are a journeyman"
	match "TGLYPH2", "brawling weapons, you are a skilled"
	match "TGLYPH2", "brawling weapons, you are a highly skilled"
	match "TGLYPH2", "You rub your chin"
	match "TGLYPH", "...wait"
	respond (""); respond ("If this is your first skill point in this skill, enter the THINK command to continue.")
	respond ("")
	fput "artisan skill"
		matchwait

TGLYPH2:
	if(checkmind(UserVars.fmindstate))
		respond(""); respond("Waiting for mind to clear.")
		respond("")
		wait_while{checkmind(UserVars.fmindstate)}
		respond(""); respond("Mind is below threshold.  Resuming work.")
		respond("")
		goto "TGLYPH2A"
	else
		goto "TGLYPH2A"
	end

TGLYPH2A:
	match "TGLYPH3", "bar in your left hand"
	match "TGSWAP", "bar in your right hand"
	match "TWORKSTART", "You glance down at your empty hands."
	fput "glance"
		matchwait

TGSWAP:
	fput "swap"
		goto "TGLYPH3"

TGLYPH3:
	match "TTOOSMALL", "Before the design is complete"
	match "TGLYPH4", "Your material is marked with a pattern,"
	match "TGLYPH3", "...wait"
	fput "stare blade-glyph"
		matchwait

TGLYPH4:
	waitrt?
	fput "put my blade-glyph in my #{UserVars.mainforgebag}"
	match "TTONGS1", "You remove"
	match "TTONGS1", "You grab"
	match "TGLYPH4", "...wait"
	match "TNOHAMMER", "What were you referring to?"
	if settings['fstowhammer']
		fput "get forging-hammer from my #{UserVars.mainforgebag}"
	else
		fput "remove my forging-hammer"
	end
		matchwait

TTOOSMALL:
	waitrt?
	match "TWORKSTART", "You put"
	match "TWORKSTART", "You place"
	match "TWORKSTART", "You tuck"
	match "TWORKSTART", "I could not find"
	match "TTOOSMALL", "...wait"
	multifput "go door", "put my bar in #{UserVars.trashtype}", "put my blade-glyph in my #{UserVars.mainforgebag}"
		matchwait

TTONGS1:
	match "TTONGS1", "...wait"
	match "TTONGER", "Reassured that all is ready"
	match "TWATER", "The tempering trough is empty"
	match "TTIME", "The tongs don't budge"
	fput "get tongs"
		matchwait

TTONGER:
	match "TTONGS2", "realizing that there's more"
	match "TGLYPH5", "safest thing to do now"
	match "TDONE", "With a satisfying"
	match "TDONE", "With a brief"
	match "TBREAK", "With a single, faulty blow"
		matchwait

TTONGS2:
	waitrt?
	match "TMASTER", "brawling weapons, you are a master"
	match "TTONGS3", "brawling weapons, you are an apprentice"
	match "TTONGS3", "brawling weapons, you are a novice"
	match "TTONGS3", "brawling weapons, you are a journeyman"
	match "TTONGS3", "brawling weapons, you are a skilled"
	match "TTONGS3", "brawling weapons, you are a highly"
	fput "artisan skill"
		matchwait

TTONGS3:
	if(checkmind(UserVars.fmindstate))
		respond(""); respond("Waiting for mind to clear.")
		respond("")
		wait_while{checkmind(UserVars.fmindstate)}
		respond(""); respond("Mind is below threshold.  Resuming work.")
		respond("")
		goto "TTONGS1"
	else
		goto "TTONGS1"
	end

TGLYPH5:
	waitrt?
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "put my bar in my #{UserVars.cutterbag}"
	else
		multifput "wear my forging-hammer", "put my bar in my #{UserVars.cutterbag}"
	end
		goto "TFORGE2"

TDONE:
	waitrt?
	fput "go door"
	if settings['fstowhammer']
		multifput "put duster in #{UserVars.trashtype}", "put my forging-hammer in my #{UserVars.mainforgebag}"
	else
		multifput "put duster in #{UserVars.trashtype}", "wear my forging-hammer"
	end
		goto "TFORGE1"

TWATER:
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "get bucket"
	else
		multifput "wear my forging-hammer", "get bucket"
	end
		goto "TWATER2"

TWATER2:
	waitrt?
	if settings['fstowhammer']
		waitrt?
		pause 1
		fput "get my forging-hammer from my #{UserVars.mainforgebag}"
	else
		waitrt?
		pause 1
		fput "remove my forging"
	end
		goto "TTONGS1"

TBREAK:
	waitrt?
	if settings['fstowhammer']
		fput "put my forging-hammer in my #{UserVars.mainforgebag}"
	else
		fput "wear my forging-hammer"
	end
		goto "TFORGE2"

TTIME:
	multifput "go door", "out"
		goto "TTIME2"

TTIME2:
	match "TNEEDSILVER3", "You don't have enough silver, rentals"
	match "TFORGE4", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

TFORGE4:
	fput "go door"
		goto "TTONGS1"

TGETBAR:
	multifput "put my blade-glyph in my #{UserVars.mainforgebag}", "go door", "out"
	goto "TNEEDBLOCK2"

TNEEDBLOCK2:
	match "TNEEDSILVER2", "But you do not have enough silver!"
	match "TPACKIT", "placed your purchases in this"
	multifput "order 3 of 2", "buy"
		matchwait

TPACKIT:
	match "TPACKIT2", "and everything falls in"
	match "TPACKIT", "...wait"
	multifput "open my package", "empty my package in my #{UserVars.mainforgebag}"
		matchwait

TPACKIT2:
	waitrt?
	match "TFORGEBACKIN", "You throw"
	match "TPACKIT2", "...wait"
	fput "throw my package"
		matchwait

TFORGEBACKIN:
	match "TNEEDSILVER1", "You don't have enough silver, rentals are"
	match "TWORKSTART", "the clerk directs you to your rented"
	match "TWORKSTART", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

TNEEDSILVER1:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "TSTALLSTART"

TNEEDSILVER2:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "TNEEDBLOCK2"

TNEEDSILVER3:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "TTIME2"

TNEEDSILVER4:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "TNEEDGLYPH2"

TNEEDSILVER5:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "TGLYPHIT2"

TNEEDGLYPH:
	multifput "go door", "out"
		goto "TNEEDGLYPH2"

TNEEDGLYPH2:
	match "TNEEDSILVER4", "But you do not have enough silver!"
	match "TGLYPHIT", "placed your purchases in this"
	multifput "order 3 of 38 material wax", "buy"
		matchwait

TGLYPHIT:
	match "TGLYPHIT2", "and everything falls in"
	match "TGLYPHIT", "...wait"
	multifput "open my package", "empty my package in my #{UserVars.mainforgebag}"
		matchwait

TGLYPHIT2:
	waitrt?
	match "TGLYPHIT3", "You throw"
	match "TGLYPHIT2", "...wait"
	fput "throw my package"
		matchwait

TGLYPHIT3:
	waitrt?
	match "TNEEDSILVER5", "You don't have enough silver, rentals are"
	match "TFORGE1", "the clerk directs you to your rented"
	match "TFORGE1", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

TMASTER:
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "put my bar in my #{UserVars.cutterbag}"
	else
		multifput "wear my forging-hammer", "put my bar in my #{UserVars.cutterbag}"
	end
	multifput "go door","put ##{GameObj.left_hand.id} in #{UserVars.trashtype}"
		goto "TMASTER2"

TMASTER2:
	match "TMASTER4", "Get what?"
	match "TMASTER3", "You remove"
	match "TMASTER3", "You grab"
	fput "get blade-glyph from my #{UserVars.mainforgebag}"
		matchwait

TMASTER3:
	fput "put my blade-glyph in #{UserVars.trashtype}"
		goto "TMASTER2"

TMASTER4:
	multifput "go door", "out"
	respond(""); respond("Congratulations! You have mastered the art of forging brawling weapons!")
	respond("")
	goto "DBRAWL"

TNOHAMMER:
	multifput "put my bar in my #{UserVars.cutterbag}", "go door", "out"
	respond(""); respond("You need a forging hammer to be able to run this script.  Making one now.")
	respond("")
	goto "HSTART"

### POLEARM SECTION START ###

PSTART:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "PAPRCHECK"

PAPRCHECK:
	match "PBUYAPRON", "for more options"
	match "PSTALLSTART", "leather crafter's apron"
	match "PSTALLSTART", "forging apron"
	fput "inventory"
		matchwait

PBUYAPRON:
	multifput "order 1", "buy", "wear apron"
		goto "PSTALLSTART"

PSTALLSTART:
	fput "go workshop"
	match "PNEEDSILVER1", "You don't have enough silver, rentals"
	match "PWORKSTART", "the clerk collects 300 silvers"
	match "PWORKSTART", "the clerk directs you to your rented"
	match "PWORKSTART", "The clerk collects 300 silvers"
	match "PWORKSTART", "The clerk directs you to your rented"
	match "PSTALLSTART", "...wait"
		matchwait

PWORKSTART:
	match "PCUTTER1", "You remove"
	match "PCUTTER1", "You grab"
	match "PFORGE1", "Get what?"
	match "PWORKSTART", "...wait"
	fput "take bar from my #{UserVars.mainforgebag}"
		matchwait

PCUTTER1:
	match "PCUTTER15", "7lb. piece and a 8lb. piece"
	match "PCUTTER9", "4lb. piece and a 5lb. piece"
	match "PCUTTER6", "in half."
	multifput "swap", "poke slab"
		matchwait

PCUTTER15:
	multifput "push slab", "pull slab"
	waitrt?
	sleep 0.4
	multifput "put #{GameObj.right_hand} in my #{UserVars.mainforgebag}", "swap"
		goto "PCUTTER1"

PCUTTER9:
	multifput "push slab", "pull slab"
	waitrt?
	sleep 0.4
	multifput "put #{GameObj.right_hand} in my #{UserVars.mainforgebag}", "put my bar in my #{UserVars.cutterbag}"
		goto "PWORKSTART"

PCUTTER6:
	fput "pull slab"
	waitrt?
	sleep 0.4
	multifput "put my bar in my #{UserVars.cutterbag}", "put my bar in my #{UserVars.cutterbag}"
		goto "PWORKSTART"

PFORGE1:
	waitrt?
	fput "go door"
		goto "PFORGE2"

PFORGE2:
	match "PNEEDGLYPH", "Get what?"
	match "PFORGE3", "You remove"
	match "PFORGE3", "You grab"
	match "PFORGE2", "...wait"
	fput "take head-glyph from my #{UserVars.mainforgebag}"
		matchwait

PFORGE3:
	match "PGETBAR", "Get what?"
	match "PGLYPH", "You remove"
	match "PGLYPH", "You grab"
	match "PFORGE3", "...wait"
	fput "take bar from my #{UserVars.cutterbag}"
		matchwait

PGLYPH:
	match "PMASTER", "pole arms, you are a master"
	match "PGLYPH2", "pole arms, you are a novice"
	match "PGLYPH2", "pole arms, you are an apprentice"
	match "PGLYPH2", "pole arms, you are a journeyman"
	match "PGLYPH2", "pole arms, you are a skilled"
	match "PGLYPH2", "pole arms, you are a highly skilled"
	match "PGLYPH2", "You rub your chin"
	match "PGLYPH", "...wait"
	respond (""); respond ("If this is your first skill point in this skill, enter the THINK command to continue.")
	respond ("")
	fput "artisan skill"
		matchwait

PGLYPH2:
	if(checkmind(UserVars.fmindstate))
		respond(""); respond("Waiting for mind to clear.")
		respond("")
		wait_while{checkmind(UserVars.fmindstate)}
		respond(""); respond("Mind is below threshold.  Resuming work.")
		respond("")
		goto "PGLYPH2A"
	else
		goto "PGLYPH2A"
	end

PGLYPH2A:
	match "PGLYPH3", "bar in your left hand"
	match "PGSWAP", "bar in your right hand"
	match "PWORKSTART", "You glance down at your empty hands."
	fput "glance"
		matchwait

PGSWAP:
	fput "swap"
		goto "PGLYPH3"

PGLYPH3:
	match "PTOOSMALL", "Before the design is complete"
	match "PGLYPH4", "Your material is marked with a pattern,"
	match "PGLYPH3", "...wait"
	fput "stare head-glyph"
		matchwait

PGLYPH4:
	waitrt?
	fput "put my head-glyph in my #{UserVars.mainforgebag}"
	match "PTONGS1", "You remove"
	match "PTONGS1", "You grab"
	match "PGLYPH4", "...wait"
	match "PNOHAMMER", "What were you referring to?"
	if settings['fstowhammer']
		fput "get forging-hammer from my #{UserVars.mainforgebag}"
	else
		fput "remove my forging-hammer"
	end
		matchwait

PTOOSMALL:
	waitrt?
	match "PWORKSTART", "You put"
	match "PWORKSTART", "You place"
	match "PWORKSTART", "You tuck"
	match "PWORKSTART", "I could not find"
	match "PTOOSMALL", "...wait"
	multifput "go door", "put my bar in #{UserVars.trashtype}", "put my head-glyph in my #{UserVars.mainforgebag}"
		matchwait

PTONGS1:
	match "PTONGS1", "...wait"
	match "PTONGER", "Reassured that all is ready"
	match "PWATER", "The tempering trough is empty"
	match "PTIME", "The tongs don't budge"
	fput "get tongs"
		matchwait

PTONGER:
	match "PTONGS2", "realizing that there's more"
	match "PGLYPH5", "safest thing to do now"
	match "PDONE", "With a satisfying"
	match "PDONE", "With a brief"
	match "PBREAK", "With a single, faulty blow"
		matchwait

PTONGS2:
	waitrt?
	match "PMASTER", "pole arms, you are a master"
	match "PTONGS3", "pole arms, you are an apprentice"
	match "PTONGS3", "pole arms, you are a novice"
	match "PTONGS3", "pole arms, you are a journeyman"
	match "PTONGS3", "pole arms, you are a skilled"
	match "PTONGS3", "pole arms, you are a highly"
	fput "artisan skill"
		matchwait

PTONGS3:
	if(checkmind(UserVars.fmindstate))
		respond(""); respond("Waiting for mind to clear.")
		respond("")
		wait_while{checkmind(UserVars.fmindstate)}
		respond(""); respond("Mind is below threshold.  Resuming work.")
		respond("")
		goto "PTONGS1"
	else
		goto "PTONGS1"
	end

PGLYPH5:
	waitrt?
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "put my bar in my #{UserVars.cutterbag}"
	else
		multifput "wear my forging-hammer", "put my bar in my #{UserVars.cutterbag}"
	end
		goto "PFORGE2"

PDONE:
	waitrt?
	fput "go door"
	if settings['fstowhammer']
		multifput "put spearhead in #{UserVars.trashtype}", "put my forging-hammer in my #{UserVars.mainforgebag}"
	else
		multifput "put spearhead in #{UserVars.trashtype}", "wear my forging-hammer"
	end
		goto "PFORGE1"

PWATER:
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "get bucket"
	else
		multifput "wear my forging-hammer", "get bucket"
	end
		goto "PWATER2"

PWATER2:
	waitrt?
	if settings['fstowhammer']
		waitrt?
		pause 1
		fput "get my forging-hammer from my #{UserVars.mainforgebag}"
	else
		waitrt?
		pause 1
		fput "remove my forging"
	end
		goto "PTONGS1"

PBREAK:
	waitrt?
	if settings['fstowhammer']
		fput "put my forging-hammer in my #{UserVars.mainforgebag}"
	else
		fput "wear my forging-hammer"
	end
		goto "PFORGE2"

PTIME:
	multifput "go door", "out"
		goto "PTIME2"

PTIME2:
	match "PNEEDSILVER3", "You don't have enough silver, rentals"
	match "PFORGE4", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

PFORGE4:
	fput "go door"
		goto "PTONGS1"

PGETBAR:
	multifput "put my head-glyph in my #{UserVars.mainforgebag}", "go door", "out"
	goto "PNEEDBLOCK2"

PNEEDBLOCK2:
	match "PNEEDSILVER2", "But you do not have enough silver!"
	match "PPACKIT", "placed your purchases in this"
	multifput "order 3 of 2", "buy"
		matchwait

PPACKIT:
	match "PPACKIT2", "and everything falls in"
	match "PPACKIT", "...wait"
	multifput "open my package", "empty my package in my #{UserVars.mainforgebag}"
		matchwait

PPACKIT2:
	waitrt?
	match "PFORGEBACKIN", "You throw"
	match "PPACKIT2", "...wait"
	fput "throw my package"
		matchwait

PFORGEBACKIN:
	match "PNEEDSILVER1", "You don't have enough silver, rentals are"
	match "PWORKSTART", "the clerk directs you to your rented"
	match "PWORKSTART", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

PNEEDSILVER1:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "PSTALLSTART"

PNEEDSILVER2:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "PNEEDBLOCK2"

PNEEDSILVER3:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "PTIME2"

PNEEDSILVER4:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "PNEEDGLYPH2"

PNEEDSILVER5:
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "PGLYPHIT2"

PNEEDGLYPH:
	multifput "go door", "out"
		goto "PNEEDGLYPH2"

PNEEDGLYPH2:
	match "PNEEDSILVER4", "But you do not have enough silver!"
	match "PGLYPHIT", "placed your purchases in this"
	multifput "order 3 of 32 material wax", "buy"
		matchwait

PGLYPHIT:
	match "PGLYPHIT2", "and everything falls in"
	match "PGLYPHIT", "...wait"
	multifput "open my package", "empty my package in my #{UserVars.mainforgebag}"
		matchwait

PGLYPHIT2:
	waitrt?
	match "PGLYPHIT3", "You throw"
	match "PGLYPHIT2", "...wait"
	fput "throw my package"
		matchwait

PGLYPHIT3:
	waitrt?
	match "PNEEDSILVER5", "You don't have enough silver, rentals are"
	match "PFORGE1", "the clerk directs you to your rented"
	match "PFORGE1", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

PMASTER:
	if settings['fstowhammer']
		multifput "put my forging-hammer in my #{UserVars.mainforgebag}", "put my bar in my #{UserVars.cutterbag}"
	else
		multifput "wear my forging-hammer", "put my bar in my #{UserVars.cutterbag}"
	end
	multifput "go door","put ##{GameObj.left_hand.id} in #{UserVars.trashtype}"
		goto "PMASTER2"

PMASTER2:
	match "PMASTER4", "Get what?"
	match "PMASTER3", "You remove"
	match "PMASTER3", "You grab"
	fput "get head-glyph from my #{UserVars.mainforgebag}"
		matchwait

PMASTER3:
	fput "put my head-glyph in #{UserVars.trashtype}"
		goto "PMASTER2"

PMASTER4:
	multifput "go door", "out"
	respond(""); respond("Congratulations! You have mastered the art of forging pole arm weapons!")
	respond("")
	goto "DPOLE"

PNOHAMMER:
	multifput "put my bar in my #{UserVars.cutterbag}", "go door", "out"
	respond(""); respond("You need a forging hammer to be able to run this script.  Making one now.")
	respond("")
	goto "HSTART"

### REGULAR HAMMER SECTION START ###

HSTART:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "HAPRCHECK"

HAPRCHECK:
	match "HBUYAPRON", "for more options"
	match "HSTALLSTART", "leather crafter's apron"
	match "HSTALLSTART", "forging apron"
	fput "inventory"
		matchwait

HBUYAPRON:
	multifput "order 1", "buy", "wear apron"
		goto "HSTALLSTART"

HSTALLSTART:
	fput "go workshop"
	match "HNEEDSILVER1", "You don't have enough silver, rentals"
	match "HWORKSTART", "the clerk collects 300 silvers"
	match "HWORKSTART", "the clerk directs you to your rented"
	match "HWORKSTART", "The clerk collects 300 silvers"
	match "HWORKSTART", "The clerk directs you to your rented"
	match "HSTALLSTART", "...wait"
		matchwait

HWORKSTART:
	fput "take block from my #{UserVars.mainforgebag}"
	match "HGOTBLOCK", "You remove"
	match "HGOTBLOCK", "You grab"
	match "HNEEDBLOCK", "Get what?"
	match "HWORKSTART", "...wait"
		matchwait

HGOTBLOCK:
	fput "swap"
		goto "HGLYPH"

HGLYPH:
	match "HGLYPH3", "block in your left hand"
	match "HSWAP", "block in your right hand"
	match "HWORKSTART", "You glance down at your empty hands."
	fput "glance"
		matchwait

HSWAP:
	fput "swap"
		goto "HGLYPH3"

HGLYPH3:
	match "HTOOSMALL", "Before the design is complete"
	match "HGRINDER", "Your material is marked with a pattern,"
	match "HGLYPH3", "...wait"
	fput "stare handle-glyph"
		matchwait

HTOOSMALL:
	waitrt?
	match "HWORKSTART", "You put"
	match "HWORKSTART", "You place"
	match "HTOOSMALL", "...wait"
	fput "put my block in #{UserVars.trashtype}"
		matchwait

HGRINDER:
	waitrt?
	match "HTIMESUP", "The grinding wheel doesn't"
	match "HGRINDER2", "You give the grinding wheel a powerful"
	match "HOOPSGRIND", "The material you intend to shape"
	match "HOOPSGRIND", "no one can shape materials at the grinder with both hands full"
	match "HWORKSTART", "Your hands are empty"
	match "HGRINDER", "...wait"
	fput "turn grinder"
		matchwait

HGRINDER2:
	match "HGLYPH", "You decide the safest"
	match "HTOOTHPICK", "Things seem to be going fine"
	match "HHAMMER", "satisfied with the piece"
	match "HHAMMER", "very best"
		matchwait

HOOPSGRIND:
	if GameObj.left_hand.nil?
		goto "HOOPSGRIND2"
	else
		fput "put #{GameObj.left_hand} in #{UserVars.trashtype}"
		goto "HOOPSGRIND2"
	end

HOOPSGRIND2:
	if GameObj.right_hand.nil?
		goto "HWORKSTART"
	else
		goto "HGOTBLOCK"
	end

HTIMESUP:
	fput "out"
	match "HNEEDSILVER1", "You don't have enough silver, rentals"
	match "HGRINDER", "the clerk collects 300 silvers"
	match "HGRINDER", "The clerk collects 300 silvers"
	fput "go workshop"
		matchwait

HTOOTHPICK:
	waitrt?
	match "HWORKSTART", "You put"
	match "HWORKSTART", "You place"
	match "HTOOTHPICK", "...wait"
	fput "put my tooth in #{UserVars.trashtype}"
		matchwait

HHAMMER:
	waitrt?
	match "HPOLITIME", "The polishing wheel doesn't budge"
	match "HHAMMER2", "You straighten up from working"
	match "HHAMMER", "...wait"
	multifput "put my block in #{UserVars.trashtype}", "lean polisher"
		matchwait

HPOLITIME:
	fput "out"
	match "HHAMMER", "The clerk collects 300 silvers"
	match "HPOLISILVER", "You don't have enough silver, rentals"
	fput "go workshop"
		matchwait

HPOLISILVER:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "HPOLITIME"

HHAMMER2:
	waitrt?
	fput "put hammer in my #{UserVars.cutterbag}"
		goto "HDUMPWOOD"

HDUMPWOOD:
	match "HDUMPWOOD2", "You remove"
	match "HDUMPWOOD2", "You grab"
	match "H1START", "Get what?"
	fput "get block from my #{UserVars.mainforgebag}"
		matchwait

HDUMPWOOD2:
	fput "put block in #{UserVars.trashtype}"
		goto "HDUMPWOOD"

HNEEDBLOCK:
	fput "out"
	goto "HNEEDBLOCK2"

HNEEDBLOCK2:
	match "HNEEDSILVER2", "But you do not have enough silver!"
	match "HPACKIT", "placed your purchases in this"
	multifput "order 3 of 3", "buy"
		matchwait

HPACKIT:
	match "HPACKIT2", "and everything falls in"
	match "HPACKIT", "...wait"
	multifput "open my package", "empty my package in my #{UserVars.mainforgebag}"
		matchwait

HPACKIT2:
	waitrt?
	match "HFORGEBACKIN", "You throw"
	match "HPACKIT2", "...wait"
	fput "throw my package"
		matchwait

HFORGEBACKIN:
	match "HNEEDSILVER1", "You don't have enough silver, rentals are"
	match "HWORKSTART", "the clerk directs you to your rented"
	match "HWORKSTART", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

HNEEDSILVER1:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "HSTALLSTART"

HNEEDSILVER2:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "HNEEDBLOCK2"

H1START:
	fput "out"
		goto "H1NEEDBLOCK2"

H1WORKSTART:
	fput "take slab from my #{UserVars.mainforgebag}"
	match "H1GOTBLOCK", "You remove"
	match "H1GOTBLOCK", "You grab"
	match "H1NEEDBLOCK", "Get what?"
	match "H1WORKSTART", "...wait"
		matchwait

H1GOTBLOCK:
	fput "swap"
		goto "H1GLYPH"

H1GLYPH:
	match "H1GLYPH3", "slab in your left hand"
	match "H1SWAP", "slab in your right hand"
	match "H1WORKSTART", "You glance down at your empty hands."
	fput "glance"
		matchwait

H1SWAP:
	fput "swap"
		goto "H1GLYPH3"

H1GLYPH3:
	match "H1TOOSMALL", "Before the design is complete"
	match "H1GRINDER", "Your material is marked with a pattern,"
	match "H1GLYPH3", "...wait"
	fput "stare head-glyph"
		matchwait

H1TOOSMALL:
	waitrt?
	match "H1WORKSTART", "You put"
	match "H1WORKSTART", "You place"
	match "H1TOOSMALL", "...wait"
	fput "put my slab in #{UserVars.trashtype}"
		matchwait

H1GRINDER:
	waitrt?
	match "H1TIMESUP", "The grinding wheel doesn't"
	match "H1GRINDER2", "You give the grinding wheel a powerful"
	match "H1OOPSGRIND", "The material you intend to shape"
	match "H1OOPSGRIND", "no one can shape materials at the grinder with both hands full"
	match "H1WORKSTART", "Your hands are empty"
	match "H1GRINDER", "...wait"
	fput "turn grinder"
		matchwait

H1GRINDER2:
	match "H1GLYPH", "You decide the safest"
	match "H1TOOTHPICK", "Things seem to be going fine"
	match "H1HAMMER", "satisfied with the piece"
	match "H1HAMMER", "very best"
		matchwait

H1OOPSGRIND:
	if GameObj.left_hand.nil?
		goto "H1OOPSGRIND2"
	else
		fput "put #{GameObj.left_hand} in #{UserVars.trashtype}"
		goto "H1OOPSGRIND2"
	end

H1OOPSGRIND2:
	if GameObj.right_hand.nil?
		goto "H1WORKSTART"
	else
		goto "H1GOTBLOCK"
	end

H1TIMESUP:
	fput "out"
	match "H1NEEDSILVER1", "You don't have enough silver, rentals"
	match "H1GRINDER", "the clerk collects 300 silvers"
	match "H1GRINDER", "The clerk collects 300 silvers"
	fput "go workshop"
		matchwait

H1TOOTHPICK:
	waitrt?
	match "H1WORKSTART", "You put"
	match "H1WORKSTART", "You place"
	match "H1TOOTHPICK", "...wait"
	fput "put my tooth in #{UserVars.trashtype}"
		matchwait

H1HAMMER:
	waitrt?
	match "HPOLITIME", "The polishing wheel doesn't budge"
	match "H1HAMMER2", "You straighten up from working"
	match "H1HAMMER", "...wait"
	multifput "put my slab in #{UserVars.trashtype}", "lean polisher"
		matchwait

H1POLITIME:
	fput "out"
	match "H1HAMMER", "The clerk collects 300 silvers"
	match "H1POLISILVER", "You don't have enough silver, rentals"
	fput "go workshop"
		matchwait

H1POLISILVER:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "H1POLITIME"

H1HAMMER2:
	waitrt?
	match "H1HAMMER2", "...wait"
	match "H1VISE", "You get"
	match "H1VISE", "You remove"
	match "H1VISE", "You grab"
	fput "get hammer from my #{UserVars.cutterbag}"
		matchwait

H1DUMPWOOD:
	match "H1DUMPWOOD2", "You remove"
	match "H1DUMPWOOD2", "You grab"
	match "H2DONE", "Get what?"
	fput "get slab from my #{UserVars.mainforgebag}"
		matchwait

H1DUMPWOOD2:
	fput "put slab in #{UserVars.trashtype}"
		goto "H1DUMPWOOD"

H1NEEDBLOCK:
	fput "out"
	goto "H1NEEDBLOCK2"

H1NEEDBLOCK2:
	match "H1NEEDSILVER2", "But you do not have enough silver!"
	match "H1PACKIT", "placed your purchases in this"
	multifput "order 3 of 4", "buy"
		matchwait

H1PACKIT:
	match "H1PACKIT2", "and everything falls in"
	match "H1PACKIT", "...wait"
	multifput "open my package", "empty my package in my #{UserVars.mainforgebag}"
		matchwait

H1PACKIT2:
	waitrt?
	match "H1FORGEBACKIN", "You throw"
	match "H1PACKIT2", "...wait"
	fput "throw my package"
		matchwait

H1FORGEBACKIN:
	match "H1NEEDSILVER1", "You don't have enough silver, rentals are"
	match "H1WORKSTART", "the clerk directs you to your rented"
	match "H1WORKSTART", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

H1NEEDSILVER1:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "H1STALLSTART"

H1NEEDSILVER2:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "H1NEEDBLOCK2"

H2DONE:
	waitrt?
	fput "out"
	goto "DHAMMER"

H1VISE:
	waitrt?
	match "H1WEAR", "You finish your work and step back"
	match "H1VISE", "...wait"
	match "H1VISE", "You decide the safest thing"
	fput "turn vise"
		matchwait

H1WEAR:
	waitrt?
	if settings['fstowhammer']
		fput "put my forging-hammer in my #{UserVars.mainforgebag}"
	else
		fput "wear my forging-hammer"
	end
	goto "H1DUMPWOOD"

### PERFECT HAMMER SECTION START ###

FSTART:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "FAPRCHECK"

FAPRCHECK:
	match "FBUYAPRON", "for more options"
	match "FSTALLSTART", "leather crafter's apron"
	match "FSTALLSTART", "forging apron"
	fput "inventory"
		matchwait

FBUYAPRON:
	multifput "order 1", "buy", "wear apron"
		goto "FSTALLSTART"

FSTALLSTART:
	fput "go workshop"
	match "FNEEDSILVER1", "You don't have enough silver, rentals"
	match "FWORKSTART", "the clerk collects 300 silvers"
	match "FWORKSTART", "the clerk directs you to your rented"
	match "FWORKSTART", "The clerk collects 300 silvers"
	match "FWORKSTART", "The clerk directs you to your rented"
	match "FSTALLSTART", "...wait"
		matchwait

FWORKSTART:
	fput "take block from my #{UserVars.mainforgebag}"
	match "FGOTBLOCK", "You remove"
	match "FGOTBLOCK", "You grab"
	match "FNEEDBLOCK", "Get what?"
	match "FWORKSTART", "...wait"
		matchwait

FGOTBLOCK:
	fput "swap"
		goto "FGLYPH"

FGLYPH:
	match "FGLYPH3", "block in your left hand"
	match "FSWAP", "block in your right hand"
	match "FWORKSTART", "You glance down at your empty hands."
	fput "glance"
		matchwait

FSWAP:
	fput "swap"
		goto "FGLYPH3"

FGLYPH3:
	match "FTOOSMALL", "Before the design is complete"
	match "FGRINDER", "Your material is marked with a pattern,"
	match "FGLYPH3", "...wait"
	fput "stare handle-glyph"
		matchwait

FTOOSMALL:
	waitrt?
	match "FWORKSTART", "You put"
	match "FWORKSTART", "You place"
	match "FTOOSMALL", "...wait"
	fput "put my block in #{UserVars.trashtype}"
		matchwait

FGRINDER:
	waitrt?
	match "FTIMESUP", "The grinding wheel doesn't"
	match "FGRINDER2", "You give the grinding wheel a powerful shove"
	match "FOOPSGRIND", "The material you intend to shape"
	match "FOOPSGRIND", "no one can shape materials at the grinder with both hands full"
	match "FWORKSTART", "Your hands are empty"
	match "FGRINDER", "...wait"
	fput "turn grinder"
		matchwait

FGRINDER2:
	match "FGLYPH", "You decide the safest"
	match "FTOOTHPICK", "Things seem to be going fine"
	match "FFAILHAMMER", "satisfied with the piece"
	match "FHAMMER", "You smile as you realize that this piece is the very best"
		matchwait

FOOPSGRIND:
	if GameObj.left_hand.nil?
		goto "FOOPSGRIND2"
	else
		fput "put #{GameObj.left_hand} in #{UserVars.trashtype}"
		goto "FOOPSGRIND2"
	end

FOOPSGRIND2:
	if GameObj.right_hand.nil?
		goto "FWORKSTART"
	else
		goto "FGOTBLOCK"
	end

FTIMESUP:
	fput "out"
	match "FNEEDSILVER1", "You don't have enough silver, rentals"
	match "FGRINDER", "the clerk collects 300 silvers"
	match "FGRINDER", "The clerk collects 300 silvers"
	fput "go workshop"
		matchwait

FTOOTHPICK:
	waitrt?
	match "FWORKSTART", "You put"
	match "FWORKSTART", "You place"
	match "FTOOTHPICK", "...wait"
	fput "put my tooth in #{UserVars.trashtype}"
		matchwait

FHAMMER:
	waitrt?
	match "FPOLITIME", "The polishing wheel doesn't budge"
	match "FHAMMER2", "You straighten up from working"
	match "FHAMMER", "...wait"
	multifput "put my block in #{UserVars.trashtype}", "lean polisher"
		matchwait

FPOLITIME:
	fput "out"
	match "FHAMMER", "The clerk collects 300 silvers"
	match "FPOLISILVER", "You don't have enough silver, rentals"
	fput "go workshop"
		matchwait

FPOLISILVER:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "FPOLITIME"

FHAMMER2:
	waitrt?
	fput "put hammer in my #{UserVars.cutterbag}"
		goto "FDUMPWOOD"

FDUMPWOOD:
	match "FDUMPWOOD2", "You remove"
	match "FDUMPWOOD2", "You grab"
	match "FESTART", "Get what?"
	fput "get block from my #{UserVars.mainforgebag}"
		matchwait

FDUMPWOOD2:
	fput "put block in #{UserVars.trashtype}"
		goto "FDUMPWOOD"

FNEEDBLOCK:
	fput "out"
	goto "FNEEDBLOCK2"

FNEEDBLOCK2:
	match "FNEEDSILVER2", "But you do not have enough silver!"
	match "FPACKIT", "placed your purchases in this"
	multifput "order 3 of 3", "buy"
		matchwait

FPACKIT:
	match "FPACKIT2", "and everything falls in"
	match "FPACKIT", "...wait"
	multifput "open my package", "empty my package in my #{UserVars.mainforgebag}"
		matchwait

FPACKIT2:
	waitrt?
	match "FFORGEBACKIN", "You throw"
	match "FPACKIT2", "...wait"
	fput "throw my package"
		matchwait

FFORGEBACKIN:
	match "FNEEDSILVER1", "You don't have enough silver, rentals are"
	match "FWORKSTART", "the clerk directs you to your rented"
	match "FWORKSTART", "the clerk collects 300 silvers"
	fput "go workshop"
		matchwait

FNEEDSILVER1:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "FSTALLSTART"

FNEEDSILVER2:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "FNEEDBLOCK2"

FESTART:
	fput "out"
		goto "FENEEDBLOCK2"

FEWORKSTART:
	fput "take slab from my #{UserVars.mainforgebag}"
	match "FEGOTBLOCK", "You remove"
	match "FEGOTBLOCK", "You grab"
	match "FENEEDBLOCK", "Get what?"
	match "FEWORKSTART", "...wait"
		matchwait

FEGOTBLOCK:
	fput "swap"
		goto "FEGLYPH"

FEGLYPH:
	match "FEGLYPH3", "slab in your left hand"
	match "FESWAP", "slab in your right hand"
	match "FEWORKSTART", "You glance down at your empty hands."
	fput "glance"
		matchwait

FESWAP:
	fput "swap"
		goto "FEGLYPH3"

FEGLYPH3:
	match "FETOOSMALL", "Before the design is complete"
	match "FEGRINDER", "Your material is marked with a pattern,"
	match "FEGLYPH3", "...wait"
	fput "stare head-glyph"
		matchwait

FETOOSMALL:
	waitrt?
	match "FEWORKSTART", "You put"
	match "FEWORKSTART", "You place"
	match "FETOOSMALL", "...wait"
	fput "put my slab in #{UserVars.trashtype}"
		matchwait

FEGRINDER:
	waitrt?
	match "FETIMESUP", "The grinding wheel doesn't"
	match "FEGRINDER2", "You give the grinding wheel a powerful shove"
	match "FEOOPSGRIND", "The material you intend to shape"
	match "FEOOPSGRIND", "no one can shape materials at the grinder with both hands full"
	match "FEWORKSTART", "Your hands are empty"
	match "FEGRINDER", "...wait"
	fput "turn grinder"
		matchwait

FEGRINDER2:
	match "FEGLYPH", "You decide the safest"
	match "FETOOTHPICK", "Things seem to be going fine"
	match "FEFAILHAMMER", "satisfied with the piece"
	match "FEHAMMER", "You smile as you realize that this piece is the very best"
		matchwait

FEOOPSGRIND:
	if GameObj.left_hand.nil?
		goto "FEOOPSGRIND2"
	else
		fput "put #{GameObj.left_hand} in #{UserVars.trashtype}"
		goto "FEOOPSGRIND2"
	end

FEOOPSGRIND2:
	if GameObj.right_hand.nil?
		goto "FEWORKSTART"
	else
		goto "FEGOTBLOCK"
	end

FETIMESUP:
	fput "out"
	match "FENEEDSILVER1", "You don't have enough silver, rentals"
	match "FEGRINDER", "the clerk collects 300 silvers"
	match "FEGRINDER", "The clerk collects 300 silvers"
	fput "go workshop"
		matchwait

FETOOTHPICK:
	waitrt?
	match "FEWORKSTART", "You put"
	match "FEWORKSTART", "You place"
	match "FETOOTHPICK", "...wait"
	fput "put my tooth in #{UserVars.trashtype}"
		matchwait

FEHAMMER:
	waitrt?
	match "FEPOLITIME", "The polishing wheel doesn't budge"
	match "FEHAMMER2", "You straighten up from working"
	match "FEHAMMER", "...wait"
	multifput "put my slab in #{UserVars.mainforgebag}", "lean polisher"
		matchwait

FEPOLITIME:
	fput "out"
	match "FEHAMMER", "The clerk collects 300 silvers"
	match "FEPOLISILVER", "You don't have enough silver, rentals"
	fput "go workshop"
		matchwait

FEPOLISILVER:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "FEPOLITIME"

FEHAMMER2:
	waitrt?
	match "FEHAMMER2", "...wait"
	match "FEVISE", "You get"
	match "FEVISE", "You remove"
	match "FEVISE", "You grab"
	fput "get hammer from my #{UserVars.cutterbag}"
		matchwait

FEDUMPWOOD:
	match "FEDUMPWOOD2", "You remove"
	match "FEDUMPWOOD2", "You grab"
	match "F2DONE", "Get what?"
	fput "get slab from my #{UserVars.mainforgebag}"
		matchwait

FEDUMPWOOD2:
	fput "put slab in #{UserVars.trashtype}"
		goto "FEDUMPWOOD"

FENEEDBLOCK:
	fput "out"
	goto "FENEEDBLOCK2"

FENEEDBLOCK2:
	match "FENEEDSILVER2", "But you do not have enough silver!"
	match "FEFORGEBACKIN", "Thanks for your patronage."
	multifput "order 9", "buy"
		matchwait

FEFORGEBACKIN:
	match "FENEEDSILVER1", "You don't have enough silver, rentals are"
	match "FEWORKSTART", "the clerk directs you to your rented"
	match "FEWORKSTART", "the clerk collects 300 silvers"
	multifput "put slab in my #{UserVars.mainforgebag}", "go workshop"
		matchwait

FENEEDSILVER1:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	fput "withdraw #{UserVars.fsilveramount} silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "FESTALLSTART"

FENEEDSILVER2:
	fput "stow all"
	start_script "go2", [ "bank", "_disable_confirm_" ]
		wait_while{running?("go2")}
	multifput "deposit all", "withdraw 18000 silver"
	start_script "go2", [ "forge", "_disable_confirm_" ]
		wait_while{running?("go2")}
	goto "FENEEDBLOCK2"

F2DONE:
	waitrt?
	fput "out"
	goto "DHAMMER"

FEVISE:
	waitrt?
	match "FENOPE", "satisfied with the piece"
	match "FEWEAR", "very best"
	match "FEVISE", "...wait"
	match "FEVISE", "You decide the safest thing"
	fput "turn vise"
		matchwait

FEWEAR:
	waitrt?
	if settings['fstowhammer']
		fput "put my forging-hammer in my #{UserVars.mainforgebag}"
	else
		fput "wear my forging-hammer"
	end
	goto "FEDUMPWOOD"

FENOPE:
	waitrt?
	match "FENOPE", "...wait"
	match "FWORKSTART", "You place"
	fput "put my forging in #{UserVars.trashtype}"
		matchwait

FFAILHAMMER:
	waitrt?
	match "FFAILHAMMER", "...wait"
	match "FWORKSTART", "You place"
	multifput "put block in my #{UserVars.mainforgebag}", "put my hammer in #{UserVars.trashtype}"
		matchwait

FEFAILHAMMER:
	waitrt?
	match "FEFAILHAMMER", "...wait"
	match "FEGOTBLOCK", "You place"
	multifput "put slab in my #{UserVars.mainforgebag}", "put my hammer in #{UserVars.trashtype}"
		matchwait
