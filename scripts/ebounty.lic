=begin

  An adventure's guild script to assist in various tasks assigned.
  Currently does not support grouping or gem hoarding.
  Currently relies on the following scripts for full utilization:
    - bigshot, echild, ego2, eherbs, eloot

        author: elanthia-online
  contributors: Deysh, Nisugi, Tysong, Rinualdo
          game: Gemstone
          tags: bounty, adventure's guild, advguild, bounties
       version: 1.5.3

  Version Control:
  Major_change.feature_addition.bugfix
  v1.5.3 (2025-03-08)
    - bugfix when counting bundled skins
  v1.5.2 (2025-02-09)
    - bugfix when only foraging and needing healed
  v1.5.1 (2025-01-07)
    - bugfix for forage turn-in
  v1.5.0 (2024-12-24)
    - added buffing option when resting
    - added using a script to handling resting location
    - added option to rest at nearest table
    - added remove bounty if heirloom item gets lost
    - bugfix for bounty eval not setting EBounty.data.complete_mind
    - bugfix for ask_guard in HW
  v1.4.5 (2024-11-26)
    - added option to use the bigshot setting for a resting location
    - bugfix for profile dropdown sorting
    - bugfix stop script from looping if started without child in room
  v1.4.4 (2024-11-22)
    - bugfix in should_hunt
  v1.4.3 (2024-11-18)
    - missing criteria in should_hunt?
    - bugfix in wait_for_bounty
    - removed EBounty.data.wait - no longer used
  v1.4.2 (2024-11-16)
    - bugfix for when to rest
  v1.4.1 (2024-11-07)
    - will continue hunting after bounty complete until Bigshot Should Rest? is met
    - bugfix in setup - prevent toggling both Rest when mind is full and Keep Hunting
    - bug fix for should_hunt? spamming an experience check
    - bug fix for should_hunt? exp_pause incorrectly included
  v1.4.0 (2024-08-23)
    - expanded resting options
    - added optional death recovery support
    - added spinbutton for room delay for bandit bounties
    - asks the alchemist in HW for bounties instead of the tavernkeeper since he keeps moving
    - bugfix in gem bounty running hording script with parameters
    - bugfix in bandit hunting variables
    - removed script change log before v1.3.0 - full log: https://gswiki.play.net/Lich:Script_Ebounty
  v1.3.11 (2024-09-24)
    - fix to allow for CLI foraging without setting Gem/Default profile
  v1.3.10 (2024-08-19)
    - bugfix for ask_guard response
  v1.3.9 (2024-08-14)
    - logic fix when once_and_done is set and rejected bounty not exiting (but going out to hunt instead)
  v1.3.8 (2024-07-12)
    - add timer to not spam INFO during should_hunt? method
  v1.3.7 (2024-07-08)
    - add quiet info command to should_hunt? method to refresh stats
  v1.3.6 (2024-06-23)
    - update ebounty fog routine to match bigshot
  v1.3.5 (2024-05-15)
    - add exit if gembounty complete but using eloot sell excludes gems
  v1.3.4 (2024-05-01)
    - Change Char.prof to Stats.prof
  v1.3.3 (2024-04-13)
    - bug in escort task acceptance
  v1.3.2 (2024-04-09)
    - bug in forage for 1011 song of peace usage
  v1.3.1 (2024-04-01)
    - updated keep_hunting not to run in bigshot bounty mode. Also, added better messaging for why
    - consolidated herbalist names and switched to ID for turnin
    - updated wiki changelog
    - removed change log before v1.1.14 - full log: https://gswiki.play.net/Lich:Script_Ebounty
  v1.3.0 (2024-03-17)
    - added exclusion options for individual gems and locations
    - added help section
    - bugfix for UI title
    - removed shattered specific actions not referenced in UI (requesting spells and healing in the nexus)
=end

require 'yaml'

begin
  require 'terminal-table' unless defined?(Terminal::Table)
rescue LoadError
  respond "You need to have the 'terminal-table' gem installed"
  respond "Please install it with the following command: gem install terminal-table"
  respond "Using your computer's local terminal/shell"
  exit
end

module EBounty
  @@data ||= nil

  ##### Data & Setup Start #####

  def self.version_check
    needs_exit = false
    fn = File.join(DATA_DIR, 'spell-list.xml')
    time = File.mtime(fn) if File.exist?(fn)

    if !File.exist?(File.join(DATA_DIR, 'effect-list.xml')) && time < Time.parse("2022-12-28")
      needs_exit = true
      if $frontend == 'stormfront' || $frontend == 'profanity'
        _respond "\<preset id=\"speech\"\>" + "########################################" + "\<\/preset\>"
        _respond "\<preset id=\"thought\"\>" + " Your spell-list.xml needs to be updated for ebounty to work" + "\<\/preset\>"
        _respond "\<preset id=\"thought\"\>" + " ;jinx data update spell-list.xml --repo=elanthia-online --force" + "\<\/preset\>"
        _respond "\<preset id=\"thought\"\>" + " ;e Spell.load" + "\<\/preset\>"
        _respond "\<preset id=\"speech\"\>" + "########################################" + "\<\/preset\>"
      else
        _respond "##" + "########################################"
        _respond ">" + " Your spell-list.xml needs to be updated for ebounty to work"
        _respond ">" + " ;jinx data update spell-list.xml --repo=elanthia-online --force"
        _respond ">" + " ;e Spell.load"
        _respond "##" + "########################################"
      end
    end

    scripts = {
      "bigshot" => '5.6.0',
      "infomon" => '1.18.18',
      "lich"    => '5.6.2'
    }

    versions = {}
    scripts.keys.each { |item|
      next if item == 'infomon' && defined?(Infomon)
      file_name = nil
      file_data = nil
      comments = nil

      if File.exist?(File.join(SCRIPT_DIR, "custom", "#{item}.lic"))
        file_name = File.join(SCRIPT_DIR, "custom", "#{item}.lic")
      elsif File.exist?(File.join(SCRIPT_DIR, "#{item}.lic"))
        file_name = File.join(SCRIPT_DIR, "#{item}.lic")
      end

      if item == "lich"
        versions[item] = LICH_VERSION
      elsif file_name.nil?
        versions[item] = "No file found"
      else
        file_data = File.open(file_name, 'r').read

        if file_data =~ /^=begin\r?\n?(.+?)^=end/m
          comments = $1.split("\n")
        else
          comments = []
          file_data.split("\n").each { |line|
            if line =~ /^[\t\s]*#/
              comments.push(line)
            elsif line !~ /^[\t\s]*$/
              break
            end
          }
        end
        for line in comments
          if line =~ /^[\s\t#]*version:[\s\t]*([\w,\s\.\d]+)/i
            versions[item] = $1.sub(/\s\(.*?\)/, '').strip
          end
        end
      end

      if versions[item] == "No file found"
        if $frontend == 'stormfront' || $frontend == 'profanity'
          _respond "\<preset id=\"speech\"\>" + "########################################" + "\<\/preset\>"
          _respond "\<preset id=\"thought\"\>" + " Required Script: #{item.capitalize} was not found!" + "\<\/preset\>"
          _respond "\<preset id=\"thought\"\>" + " Please download the latest version." + "\<\/preset\>"
          if item == "bigshot"
            _respond "\<preset id=\"thought\"\>" + " ;repository download bigshot" + "\<\/preset\>"
          elsif item == "infomon"
            _respond "\<preset id=\"thought\"\>" + " ;jinx script update infomon --repo=elanthia-online" + "\<\/preset\>"
          elsif item == "lich"
            _respond "\<preset id=\"thought\"\>" + " ;lich5-update --update" + "\<\/preset\>"
          end
          _respond "\<preset id=\"speech\"\>" + "########################################" + "\<\/preset\>"
        else
          _respond "##" + "########################################"
          _respond ">" + " Required Script: #{item} was not found!"
          _respond ">" + " Please download the latest version."
          if item == "bigshot"
            _respond ">" + " ;repository download bigshot"
          elsif item == "infomon"
            _respond ">" + " ;jinx script update infomon --repo=elanthia-online"
          elsif item == "lich"
            _respond ">" + " ;lich5-update --update"
          end
          _respond "##" + "########################################"
        end
        exit
      elsif Gem::Version.new(versions[item]) < Gem::Version.new(scripts[item])
        needs_exit = true
        if $frontend == 'stormfront' || $frontend == 'profanity'
          _respond
          _respond "\<preset id=\"thought\"\>" + "########################################" + "\<\/preset\>"
          _respond
          _respond "\<preset id=\"thought\"\>" + " Required Script: #{item.capitalize} needs version #{scripts[item]} to run." + "\<\/preset\>"
          _respond ""
          _respond "\<preset id=\"thought\"\>" + " Currently Running Version: #{versions[item]}" + "\<\/preset\>"
          _respond "\<preset id=\"thought\"\>" + " Please update to the latest version." + "\<\/preset\>"
          if item == "bigshot"
            _respond "\<preset id=\"thought\"\>" + " ;repository download bigshot" + "\<\/preset\>"
          elsif item == "infomon"
            _respond "\<preset id=\"thought\"\>" + " ;jinx script update infomon --repo=elanthia-online --force" + "\<\/preset\>"
            _respond "\<preset id=\"thought\"\>" + " then kill infomon and restart it" + "\<\/preset\>"
          elsif item == "lich"
            _respond "\<preset id=\"thought\"\>" + " ;lich5-update --update" + "\<\/preset\>"
          end
          _respond
          _respond "\<preset id=\"thought\"\>" + "########################################" + "\<\/preset\>"
          _respond
        else
          _respond "##" + "########################################"
          _respond ">" + " Required Script: #{item.capitalize} needs version #{scripts[item]} to run."
          _respond ">" + ""
          _respond ">" + " Currently Running Version: #{versions[item]}"
          _respond ">" + " Please update to the latest version."
          if item == "bigshot"
            _respond ">" + " ;repository download bigshot"
          elsif item == "infomon"
            _respond ">" + " ;jinx script update infomon --repo=elanthia-online --force"
            _respond ">" + " then kill infomon and restart it"
          elsif item == "lich"
            _respond ">" + " ;lich5-update --update"
          end
          _respond "##" + "########################################"
        end
      end
    }
    EBounty.msg("debug", "EBounty Version: #{EBounty.get_script_version}")
    exit if needs_exit
  end

  def self.help
    rows = []
    rows << ["#{$lich_char}#{Script.current.name} setup", "UI configuration tool"]
    rows << ["#{$lich_char}#{Script.current.name} remove", "Removes current bounty"]
    rows << ["#{$lich_char}#{Script.current.name} forage", "Forages requested herbs"]
    rows << ["#{$lich_char}#{Script.current.name} load", "Reloads all settings"]
    rows << ["#{$lich_char}#{Script.current.name} list", "Lists all settings"]
    rows << ["#{$lich_char}#{Script.current.name} location", "Lists the current bounty location"]
    rows << ["#{$lich_char}#{Script.current.name} creature", "Lists the current bounty creature"]
    rows << ["#{$lich_char}#{Script.current.name} bounty", "Lists the current bounty"]
    rows << [{ value: ' ', colspan: 2, alignment: :center }]
    rows << [{ value: "#{Script.current.name.capitalize} requires Bigshot", colspan: 2, alignment: :center }]
    rows << [{ value: 'Review each tab for options', colspan: 2, alignment: :center }]

    table = Terminal::Table.new :title => "#{Script.current.name.capitalize} Help", :rows => rows
    respond
    respond table
    respond
  end

  def self.load_defaults()
    default_hash = {
      :bounty_types    => ["boss_culling", "culling", "gem_collecting", "heirloom_loot", "skinning"],
      :selling_script  => "",
      :default_profile => ""
    }
    Dir.mkdir("#{$data_dir}#{XMLData.game}") unless File.exist?("#{$data_dir}#{XMLData.game}")
    Dir.mkdir("#{$data_dir}#{XMLData.game}/#{Char.name}") unless File.exist?("#{$data_dir}#{XMLData.game}/#{Char.name}")
    Dir.mkdir("#{$data_dir}#{XMLData.game}/#{Char.name}/bigshot_profiles") unless File.exist?("#{$data_dir}#{XMLData.game}/#{Char.name}/bigshot_profiles")

    File.write("#{$data_dir}#{XMLData.game}/#{Char.name}/ebounty.yaml", default_hash.to_yaml)

    default_hash
  end

  def self.load_default_profile
    profile = File.join(EBounty.data.dir, "#{EBounty.data.settings[:default_profile]}.yaml")
    UserVars.op = YAML.load_file(profile)
  end

  def self.load_profile(name: Char.name)
    if name != nil
      filename = "#{$data_dir}#{XMLData.game}/#{name}/ebounty.yaml"
      if File.exist?("#{filename}") && name == Char.name
        settings_hash = YAML.load_file(filename)
      elsif !File.exist?("#{filename}") && name != Char.name
        EBounty.msg("error", " EBounty.load_profile: Attempt to load a profile that does not exist.")
      elsif !File.exist?("#{filename}") && name == Char.name
        EBounty.msg("info", " No current settings found.  Loading defaults for configurtion.")
        EBounty.msg("info", " Suggest you configure to your needs with ;ebounty setup")
        settings_hash = EBounty.load_defaults()
      else
        EBounty.msg("error", " EBounty.load_profile: There was an unknown error with loading a profile")
      end
    else
      EBounty.msg("error", " EBounty.load_profile: name not defined")
    end

    settings_hash
  end

  def self.save_profile(name: Char.name)
    # This adds it to the profile for backward compatability
    if name != nil
      filename = "#{$data_dir}#{XMLData.game}/#{Char.name}/ebounty.yaml"
      if name == Char.name
        File.write(filename, EBounty.data.settings.to_yaml)
        EBounty.msg("info", " Settings saved to file: #{filename}.")
      elsif File.exist?("#{filename}") && name != Char.name
        EBounty.msg("info", " You are attempt to overwrite another profile!")
        EBounty.msg("info", " If you wish to overwrite, please ;unpause ebounty.")
        EBounty.msg("info", " Else ;kill ebounty and choose another filename.")
        pause_script
        File.write(filename, EBounty.data.settings.to_yaml)
        EBounty.msg("info", " Settings saved to file: #{filename}.")
      elsif !File.exist?("#{filename}") && name != Char.name
        File.write(filename, EBounty.data.settings.to_yaml)
        EBounty.msg("info", " Settings are being saved to another profile!")
        EBounty.msg("info", " Settings saved to file: #{filename}.")
      else
        EBounty.msg("error", " EBounty.save_profile: There was an unknown error with saving a profile")
      end
    end
  end

  def self.load(settings)
    @@data = Data.new(settings)
  end

  def self.update_setting(input)
    setting_to_update = normalize_setting_name(input.first)
    EBounty.msg("debug", "Normalized #{input.first} as #{setting_to_update}")

    if EBounty.data.settings.keys.include?(setting_to_update)
      default_value = EBounty.data.settings[setting_to_update].dup
      EBounty.msg("debug", "recognized #{setting_to_update} as as valid #{default_value.class} setting")
      new_value = coerce_setting_value(setting_to_update, default_value, input[1..-1])
      EBounty.msg("debug", "Normalized #{input[1..-1]} as #{new_value.inspect}")

      data.settings[setting_to_update] = new_value
      EBounty.msg("info", " Updated #{setting_to_update} to #{new_value}")
      EBounty.save_profile()
    else
      EBounty.msg("error", " #{setting_to_update} is not a recognized setting. Recognized setting names:")
      EBounty.msg("error", EBounty.data.settings.keys.sort.join("\n"))
    end
  end

  def self.coerce_setting_value(setting_name, default, input)
    case default
    when TrueClass, FalseClass
      fix_option = { 'on' => true, 'true' => true, 'yes' => true, 'off' => false, 'false' => false, 'no' => false }
      fix_option.fetch(input[0]) do |v|
        EBounty.msg("error", %{Expected a boolean (true/false/yes/no) value for "#{setting_name} but got "#{v}"})
        exit
      end
    when Array
      input
    when Integer
      v = input[0]
      if v =~ /\A[+-]?\d+\z/
        v.to_i
      else
        EBounty.msg("error", %{Expected an integer value for #{setting_name} value but got "#{v}"})
        exit
      end
    when String
      input.join(" ")
    else
      EBounty.msg("error", "Recognized #{setting_name} but don't know how to normalize a #{default.class} type setting")
      exit
    end
  end

  def self.normalize_setting_name(input)
    input.downcase.tr('-', '_').to_sym
  end

  def self.bounty_change(original_checkbounty)
    EBounty.msg("debug", " bounty_change | called by #{caller[0]}")
    # waits for checkbounty to change
    end_wait = Time.now + 3
    sleep 0.2 until checkbounty != original_checkbounty || Time.now > end_wait
  end

  def self.check_exp(need_percent = false)
    in_bucket = nil
    max_bucket = nil

    while (in_bucket.nil? || max_bucket.nil?)
      lines = EBounty.get_lines("experience", /<output class="mono"\/>/)

      if lines.any? { |l| l =~ /Field Exp\:\s*([0-9,]+)\/([0-9,]+)/i }
        in_bucket = $1.delete(",").to_f
        max_bucket = $2.delete(",").to_f
      end
    end

    if need_percent
      return (in_bucket / max_bucket) * 100
    end

    # how saturated are we?
    extra_exp = [in_bucket - max_bucket, 0].max

    # estimated absorption per pulse = 25 + log/5 + 2(supernode) + in_bucket/200(max 10) + 1(grouped)
    absorption = 25 + (Stats.enhanced_log[1] / 5) + 2 + [in_bucket / 200, 10].min + 1

    # estimated time to must rest in minutes = (extra_exp / absorption) * 2 mintes per pulse, round down? divided by 60 sec per minute
    return ((extra_exp / absorption) * 120) / 60
  end

  def self.check_health
    return if EBounty.data.settings[:skip_healing]

    if XMLData.injuries.any? { |_a, h| h['wound'] > 0 || h['scar'] > 1 } || (percenthealth < 95 && (checkhealth + 7) < maxhealth)
      Script.run(EBounty.data.healing_script)
    end
  end

  def self.over_watch
    current_script = Script.current.name
    ebo_vars = Script.current.vars[1]

    unless EBounty.data.settings[:death_script].to_s.empty?
      eof_string = <<-EOF
        while running?("#{current_script}")
          # Handle character death and try to recover
          if dead?
            stop_script("bigshot") if Script.running?("bigshot")
            stop_script("go2") if Script.running?("go2")
            stop_script("#{current_script}")

            EBounty.run_scripts(EBounty.data.settings[:death_script])
            start_script("#{current_script}", ["#{ebo_vars}"])
            Script.self.kill
          end

          sleep(1)
        end

        Script.self.kill
      EOF

      start_exec_script(eof_string, { :quiet => true, :name => 'ebo_watch' });
    else
      Thread.new { loop { Script.self.kill if dead?; sleep(5); } }
    end

    Thread.new do
      loop do
        if Script.running?("bigshot") && checkbounty =~ /suppress bandit activity/ && !$bigshot_bandits
          $bigshot_bandits = true
        end

        sleep(5)
      end
    end
  end

  def self.data
    @@data
  end

  def self.duration(elapsed)
    rest, secs = elapsed.divmod(60)
    rest, mins = rest.divmod(60)
    days, hours = rest.divmod(24)

    result = []
    result << "#{days} Days" if days > 0
    result << "#{hours} Hours" if hours > 0
    result << "#{mins} Minutes" if mins > 0
    result << "#{secs.round(0)} Seconds" if secs > 0
    return " #{result.join(' ')}"
  end

  def self.elapsed
    elapsed = Time.now - EBounty.data.elapsed_time
    duration(elapsed)
  end

  def self.exit_script
    EBounty.msg("debug", " exit | called by #{caller[0]}")
    before_dying { sleep 0.5 }
    exit
  end

  def self.fix_name(foragename)
    if foragename =~ /\w+ of (.*?)$/ then foragename = $1
    elsif foragename.include?('iceblossom') then foragename = 'iceblossom'
    elsif foragename.include?('stick') then foragename = 'stick'
    elsif foragename.include?('mold') then foragename = 'mold'
    elsif foragename == 'twisted black mawflower' then foragename = 'mawflower'
    elsif foragename == 'small green olive' then foragename = 'green olive'
    elsif foragename == 'oozing fleshsore bulb' then foragename = 'fleshsore bulb'
    elsif foragename == 'rotting bile green fleshbulb' then foragename = 'fleshbulb'
    elsif foragename == 'discolored fleshbinder bud' then foragename = 'fleshbinder bud'
    elsif foragename == 'slime-covered grave blossom' then foragename = 'grave blossom'
    elsif foragename == 'fragrant white lily' then foragename = 'white lily'
    elsif foragename == 'trollfear mushroom' then foragename = 'mushroom'
    elsif foragename == 'vermilion fire lily' then foragename = 'fire lily'
    elsif foragename == 'orange tiger lily' then foragename = 'tiger lily'
    elsif foragename == 'golden flaeshorn berry' then foragename = 'flaeshorn berry'
    elsif foragename == 'white alligator lily' then foragename = 'alligator lily'
    elsif foragename == 'dark pink rain lily' then foragename = 'pink rain lily'
    elsif foragename == 'white spider lily' then foragename = 'spider lily'
    elsif foragename == 'large black toadstool' then foragename = 'black toadstool'
    elsif foragename == 'glowing green lichen' then foragename = 'green lichen'
    elsif foragename == 'luminescent green fungus' then foragename = 'green fungus'
    elsif foragename == 'black-tipped wyrm thorn' then foragename = 'wyrm thorn'
    elsif foragename == 'fetid black slime' then foragename = 'black slime'
    elsif foragename == 'gnarled pandanus twig' then foragename = 'pandanus twig'
    elsif foragename == 'giant glowing toadstool' then foragename = 'glowing toadstool'
    elsif foragename == 'waxy banana leaf' then foragename = 'banana leaf'
    elsif foragename == 'heart-shaped red lychee' then foragename = 'red lychee'
    elsif foragename == 'oblong red onion' then foragename = 'red onion'
    end

    return foragename
  end

  def self.mana_pulse(spell_id)
    return unless Spell[spell_id].known? && !Spell[spell_id].affordable?

    mana_regex = Regexp.union(
      /An invigorating rush of mana pulses through you/i,
      /You are too mentally fatigued to attempt this ability/i,
      /You're already at full mana./i,
      /Your mana control skills are not yet advanced/i,
    )

    dothistimeout "mana pulse", 2, mana_regex
    sleep 0.2
  end

  def self.fog_return_spirit(from_voln = false)
    current_room = Room.current.id
    EBounty.mana_pulse(130)
    if Spell[130].known? && Spell[130].affordable?
      Spell[130].cast()
      sleep 0.5
      waitcastrt?
      if Room.current.id == 2635 && UserVars.op['fog_rift'] && UserVars.op['resting_room_id'].to_i != 2635 && current_room != Room.current.id
        mana_pulse(130)

        Spell[130].cast() if Spell[130].known? && Spell[130].affordable?
        sleep 0.5
        waitcastrt?
      end
    end

    # Something went wrong and 130 didn't work. Trying symbol of return
    if current_room == Room.current.id && Spell[9825].known? && !from_voln
      EBounty.fog_return_voln(true)
    end
  end

  def self.fog_return_voln(from_130 = false)
    current_room = Room.current.id
    if Spell[9825].known?
      fput 'symbol of return'
      sleep(0.5)

      if current_room != Room.current.id && Room.current.id == 2635 && UserVars.op['fog_rift'] && UserVars.op['resting_room_id'].to_i != 2635
        fput 'symbol of return'
        sleep 0.5
      end
    end

    # Something went wrong and sym of return didn't work. Trying 130
    if current_room == Room.current.id && Spell[130].known? && !from_130
      EBounty.fog_return_spirit(true)
    end
  end

  def self.fog
    return if UserVars.op['fog_return'].to_i.zero?
    return if UserVars.op['fog_optional'] && $rest_reason !~ /wounded|encumbered/

    sleep(0.5)
    waitcastrt?
    waitrt?

    case UserVars.op['fog_return'].to_i
    when 1 # Spirit Guide(130)
      EBounty.fog_return_spirit
    when 2 # Symbol of Return
      EBounty.fog_return_voln
    when 3 # Travelers Song(1020)
      EBounty.mana_pulse(1020)
      sleep(0.2)
      Spell[1020].cast() if Spell[1020].known? && Spell[1020].affordable?
    when 4 # GoS - Sigil of Escape
      if Spell[9720].known? && Spell[9720].affordable?
        Spell[9720].cast()
        sleep(0.5)
        waitcastrt?
        waitrt?
      end
    when 5 # Familiar Gate
      EBounty.mana_pulse(930)

      if Spell[930].known? && Spell[930].affordable?
        Spell[930].cast()
        fput 'go portal'
        sleep(0.5)
        waitcastrt?
        waitrt?
      end
    end
  end

  def self.issue_command(command, start_pattern, loud = true, end_pattern = /<prompt/, include_end = false, timeout = 5)
    result = []
    name = "Sell:: -#{Time.now.tv_sec}.#{Time.now.tv_usec}-#{Random.rand(10000)}"
    filter = false
    save_want_downstream = Script.current.want_downstream
    save_want_downstream_xml = Script.current.want_downstream_xml
    Script.current.want_downstream = false
    Script.current.want_downstream_xml = true

    begin
      Timeout::timeout(timeout, Interrupt) {
        DownstreamHook.add(name, proc { |xml|
          is_loud = loud ? xml : nil
          if filter
            if xml =~ end_pattern
              DownstreamHook.remove(name)
              filter = false
            else
              next(is_loud)
            end
          elsif xml =~ start_pattern
            filter = true
            next(is_loud)
          else
            # echo "xml: #{xml}"
            # xml
            next(is_loud)
          end
        })
        if loud
          fput command
        else
          $_SERVER_.puts command
        end
        until (xml = get) =~ start_pattern; end
        result << xml.rstrip
        until (xml = get) =~ end_pattern
          result << xml.rstrip
        end
        if include_end
          result << xml.rstrip
        end
      }
    rescue Interrupt
      nil
    ensure
      DownstreamHook.remove(name)
      Script.current.want_downstream_xml = save_want_downstream_xml
      Script.current.want_downstream = save_want_downstream
    end
    # echo result
    return result
  end

  def self.get_command(command, regex)
    lines = []
    regex = Regexp.union(regex, /(?:Roundtime:|\.\.\.wait) (\d+) [Ss]ec(?:onds)?\./)

    loop {
      lines = EBounty.issue_command(command, regex)
      EBounty.msg("debug", " get_command: command: #{command} | lines - #{lines}")
      if lines.any? { |l| l =~ /(?:Roundtime:|\.\.\.wait) (\d+) [Ss]ec(?:onds)?\./i }
        waitrt?
        next
      else
        break
      end
    }

    return lines
  end

  def self.get_lines(command, regex)
    lines = []
    regex = Regexp.union(regex, /(?:Roundtime:|\.\.\.wait) (\d+) [Ss]ec(?:onds)?\./)

    loop {
      lines = Lich::Util.quiet_command_xml(command, regex)
      EBounty.msg("debug", " get_lines: command: #{command} | lines - #{lines}")
      if lines.any? { |l| l =~ /(?:Roundtime:|\.\.\.wait) (\d+) [Ss]ec(?:onds)?\./i }
        waitrt?
        next
      else
        break
      end
    }

    return lines
  end

  def self.get_res(command, regex)
    regex = Regexp.union(regex, /(?:Roundtime:|\.\.\.wait) (\d+) [Ss]ec(?:onds)?\./)
    result = nil
    loop {
      result = dothistimeout(command, 3, regex)
      if result =~ /(?:Roundtime:|\.\.\.wait) (\d+) [Ss]ec(?:onds)?\./i
        waitrt?
        next
      else
        break
      end
    }

    return result
  end

  def self.get_script_version
    data = Script.list.find { |x| x.name == Script.current.name }.inspect
    return data[/version: (\d+\.\d+\.\d+)/i, 1]
  end

  def self.open_container(container)
    EBounty.msg("debug", "open_container | container: #{container.inspect}")
    return if GameObj.containers.keys.include?(container.id) && container.contents.is_a?(Array)
    return if container.name =~ /keyring/

    # Still here? Assume the container is closed and open it
    lines = EBounty.get_lines("open ##{container.id}", /You|<exposeContainer|The shard is open already|You must remove|You can't do that|That is already open|<container|There doesn't seem to be any way to do that.|You open|An <a exist=".*?" noun=".*?">.*?<\/a>.*?is already open.|You press your hand against your|You wave a hand across/i)
    return if lines.any? { |l| l =~ /There doesn't seem to be any way to do that|That is already open|is open already|You can't do that|You must remove|You wave a hand across|You glance/ }

    # check out whats inside
    lines = EBounty.get_lines("look in ##{container.id}", /<exposeContainer|<dialogData|<container|you glance|There is nothing|This <a exist=".*?" noun=".*?">.*?<\/a>.*?inside./i)

    return if lines.any? { |l| l =~ /This <a exist=".*?" noun=".*?">.*?<\/a>.*?inside.|In the <a exist=/ }

    EBounty.msg("debug", " look in open_container: lines - #{lines}")

    20.times {
      break if GameObj.containers.keys.include?(container.id) && container.contents.is_a?(Array)

      sleep 0.1
    }

    # If we open it, lets close it before script dies
    EBounty.data.close_containers.push(container.id) unless EBounty.data.close_containers.include?(container.id)
  end

  def self.set_variables(load_profile: true)
    EBounty.data.elapsed_time = Time.now

    unless EBounty.data.settings[:basic] || !load_profile
      # Check if a default profile was selected
      if EBounty.data.settings[:default_profile].to_s.empty?
        EBounty.msg "error", 'Please select a Gem/Default profile in "Profiles" tab. Ebounty needs this to work right.'
        EBounty.exit_script
      end

      # Load the default profile
      EBounty.load_default_profile
    end

    # Lets find the containers we need
    container_match = /<a exist="([^"]+)" noun="[^"]+">[^(.]+\(([a-z]+)\)/
    container_lines = Lich::Util.quiet_command_xml("stow list", /<output class="mono"\/>/)

    container_lines.each { |line|
      if line =~ container_match
        EBounty.data.sacks.store(Regexp.last_match(2), GameObj.inv.find { |i| i.id == Regexp.last_match(1) })
        EBounty.data.sacks.delete(Regexp.last_match(2)) unless EBounty.data.sacks[Regexp.last_match(2)]
      end
    }

    EBounty.data.containers = []
    exist = %r{<a exist=(?:'|")(?<id>.*?)(?:'|") noun=(?:'|")(?<noun>.*?)(?:'|")>(?<name>.*?)</a>}
    lines = Lich::Util.quiet_command_xml("inventory containers", /You are (wearing|holding)/)
    lines.delete_if { |l| l =~ /You are holding/ }
    lines.each do |line|
      line.scan(exist).each do |matches|
        EBounty.data.containers << GameObj.new(*matches) unless EBounty.data.containers.any? { |sack| sack.id == GameObj.new(*matches).id }
      end
    end
  end

  def self.run_scripts(scripts)
    scripts.split(/,\s*/).each do |i|
      tokens = i.split(/\s+/)
      if (tokens.size > 1)
        Script.run(tokens[0], tokens[1..-1].join(", "))
      else
        Script.run(tokens[0])
      end
    end
  end

  def self.msg(type = info, text)
    # color options - set type to use
    # yellow, orange, teal, green, plain

    return if type == "debug" && !EBounty.data.settings[:debug]

    if text.class == Hash
      text = text.inspect.gsub("#<", "#")
    elsif text.class == Array
      text = text.to_s
    elsif text.class == String
      text = text.gsub("#<", "#")
    end

    type = type == "debug" ? "speech" : type

    Lich::Messaging.msg(type, text)
  end

  def self.switch_profile(creature = nil)
    EBounty.data.creature = creature
    profile_letter = nil

    options = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j"]

    # Check for full name first
    options.each { |letter| profile_letter = letter if EBounty.data.settings["names_#{letter}".to_sym] =~ /#{creature}/i }

    if profile_letter != nil
      EBounty.data.settings[:only_required_creatures] = EBounty.data.settings["kill_#{profile_letter}".to_sym] ? true : false
      profile = File.join(EBounty.data.dir, "#{EBounty.data.settings["profile_#{profile_letter}".to_sym]}.yaml")
      UserVars.op = YAML.load_file(profile)
    elsif creature == "bandits" && !EBounty.data.settings[:bandits_profile].to_s.empty?
      EBounty.data.settings[:only_required_creatures] = EBounty.data.settings[:kill_bandits] ? true : false
      profile = File.join(EBounty.data.dir, "#{EBounty.data.settings[:bandits_profile]}.yaml")
      UserVars.op = YAML.load_file(profile)
    elsif EBounty.data.settings[:keep_hunting]
      Hunting.keep_hunting
    else
      EBounty.go2_rest
      EBounty.msg "info", " No Profile found for #{creature}. Please check the Profiles tab. Exiting..."
      EBounty.exit_script
    end
  end

  def self.test
    echo " Ebounty Version: #{EBounty.get_script_version}"
    echo ""
    echo "--------------- Settings ---------------"
    EBounty.data.settings.each { |item| echo item }
    echo "----------------------------------------"
    echo ""
  end

  def self.go2(place)
    EBounty.msg("debug", " go2(place) | place: #{place}| called by #{caller[0]}")

    fput('unhide') if (hidden? || invisible?)

    return if Room.current.id == place.to_i || Room.current.tags.include?(place)

    if Room.current.id.nil?
      if EBounty.data.settings[:debug]
        EBounty.msg "info", "unknown room location: hope you know what you're doing"
      else
        EBounty.msg "error", 'unknown room location'
      end
    end
    Script.run('go2', "#{place} --disable-confirm", { quiet: true })
  end

  def self.go2_rest
    town_id = Room[Room.current.find_nearest_by_tag("town")].id
    current_room = Room.current.id.to_s
    EBounty.msg("debug", "go2_rest | town_id: #{town_id} | called by #{caller[0]}")

    # town center => noded rooms
    resting_spots = {
      2300  => EBounty.data.settings[:icemule_resting].split(','),     # Icemule Trace
      1932  => EBounty.data.settings[:teras_resting].split(','),       # Kharam Dzu
      28813 => EBounty.data.settings[:kf_resting].split(','),          # Kraken's Fall
      3668  => EBounty.data.settings[:fwi_resting].split(','),         # Mist Harbor
      10861 => EBounty.data.settings[:rr_resting].split(','),          # River's Rest
      1438  => EBounty.data.settings[:solhaven_resting].split(','),    # Solhaven
      188   => EBounty.data.settings[:illy_resting].split(','),        # Ta'llistim
      3519  => EBounty.data.settings[:vaalor_resting].split(','),      # Ta'Vaalor
      228   => EBounty.data.settings[:landing_resting].split(','),     # Wehnimer's Landing
      1005  => EBounty.data.settings[:zul_resting].split(','),         # Zul Logoth
    }

    if EBounty.data.settings[:bigshot_rest]
      where_to = EBounty.uid_match(UserVars.op['resting_room_id'])
    elsif EBounty.data.settings[:custom_rest]
      where_to = EBounty.data.settings[:resting_room].include?(current_room) ? Room.current.id : EBounty.data.settings[:resting_room].split(',').sample
    elsif EBounty.data.settings[:rest_random]
      where_to = resting_spots[town_id].include?(current_room) ? Room.current.id : resting_spots[town_id].sample
    elsif EBounty.data.settings[:table_rest]
      where_to = 'table'
    elsif EBounty.data.settings[:use_script]
      where_to = 'script'
      EBounty.run_scripts(EBounty.data.settings[:use_script_name])
    elsif XMLData.game == "GSF"
      where_to = 'nexus'
    else
      where_to = town_id
    end

    # getting reports of where_to being nil for some reason
    where_to = where_to.nil? ? town_id : where_to

    EBounty.msg("debug", "go2_rest | current room: #{current_room} | where_to: #{where_to}")

    EBounty.go2(where_to) unless where_to == 'script'

    if where_to == 'table'
      fput 'go table'
    end

    EBounty.wait_rt

    if EBounty.data.settings[:join_player]
      EBounty.data.settings[:join_list].split(',').each { |pc|
        if checkpcs.include?(pc)
          fput "join #{pc}"
          break
        end
      }
    end

    if EBounty.data.settings[:use_buff_script]
      EBounty.run_scripts(EBounty.data.settings[:buff_script])
    end
  end

  def self.silver_check
    return Lich::Util.silver_count
  end

  def self.silver_deposit
    EBounty.msg("debug", " silver_deposit | called by #{caller[0]}")

    silvers = EBounty.silver_check

    return unless silvers.positive?

    keep_silver = defined?(ELoot) ? ELoot.data.settings[:sell_keep_silver].to_i : 0

    return if (silvers - keep_silver).zero?

    EBounty.go2('bank')

    if silvers > keep_silver
      amount = silvers - keep_silver
      fput("deposit #{amount}")
    elsif silvers < keep_silver
      amount = keep_silver - silvers
      fput("withdrawl #{amount}")
    end
  end

  def self.uid_match(room)
    uid_pattern = /u(?<uid>\d+)/
    if (m = uid_pattern.match(room))
      uid = m[:uid].to_i
      lookup_id = Map.ids_from_uid(uid)
      if lookup_id.size > 0
        room = lookup_id[0]
      else
        echo "Not able to find #{room} in the map database! Exiting..."
        EBounty.exit_script
      end
    end
    return room.to_i
  end

  def self.wait_rt
    sleep 0.2
    wait_while { checkrt > 0 }
    sleep 0.2
  end
  ##### Data & Setup End #####

  # Global data used by EBounty
  class Data
    attr_accessor  :settings, :reason, :rest_time, :rest_options, :hunting_spots, :herbalist_rooms, :remaining_skins, :skin, :remaining_gems, :gem, :dir,
                   :creature, :sacks, :start_room, :location_start, :location_boundaries, :guard_regex, :forage_result, :forage_injury, :elapsed_time, :bundle_skin,
                   :close_containers, :containers, :gambits_available, :get_regex, :put_regex, :bad_rooms, :loot_script, :healing_script, :crosswalk, :reject_bounties,
                   :bounty_towns_uid, :escort_script, :rescue_script, :herbalist_names, :info_time, :converted, :complete_mind

    def initialize(settings)
      @settings = settings
      @settings[:gems] ||= {}
      @elapsed_time = Time.now
      @reason = ''
      @rest_time = Time.now
      @info_time = Time.now
      @sacks = {}
      @containers = []
      @converted = 0
      @complete_mind = 0
      @rest_options = ["experience", "inventory", "health", "resources", "info"]
      @get_regex = /^You (?:shield the opening of .*? from view as you |discreetly |carefully |deftly )?(?:remove|draw|grab|reach|slip|tuck|retrieve|already have|unsheathe|detach|swap)|^Get what\?$|^Why don't you leave some for others\?$|^You need a free hand|^You already have that/
      @put_regex = /^You (?:put|(?:discreetly )?tuck|attach|toss|attempt to shield your|place|.* place|slip|wipe off the blade and sheathe|absent-mindedly drop|carefully add|find an incomplete bundle|untie your drawstring pouch)|^The .+ is already a bundle|^Your bundle would be too large if you if you tried to add that|^The .+ is too large to be bundled\.|^As you place your .+ inside your .+, you notice another .+ inside the .+ and carefully arrange the two .+ into a neat bundle\.|If you wish to continue, throw the item away again within fifteen seconds|you feel pleased with yourself at having cleaned up the surrounding area|over your shoulder|two items in that location|wear three functional items|^Your .*? won't fit in .*?\.$/

      @loot_script = @settings[:selling_script].to_s.empty? ? 'eloot' : @settings[:selling_script]
      @healing_script = @settings[:healing_script].to_s.empty? ? 'eherbs' : @settings[:healing_script]
      @escort_script = @settings[:escort_script].to_s.empty? ? 'ego2' : @settings[:escort_script]
      @rescue_script = @settings[:rescue_script].to_s.empty? ? 'echild' : @settings[:rescue_script]

      @crosswalk = {
        :bandit_assignment   => "kill_bandits",
        :bandit              => "kill_bandits",
        :creature_assignment => "kill_creatures",
        :cull                => "culling",
        :dangerous           => "boss_culling",
        :escort              => "escort",
        :gem_assignment      => "gem_collecting",
        :gem                 => "gem_collecting",
        :heirloom_assignment => "heirloom_both",
        :heirloom            => "heirloom_both",
        :herb_assignment     => "foraging",
        :herb                => "foraging",
        :rescue_assignment   => "rescue",
        :rescue              => "rescue",
        :skin_assignment     => "skinning",
        :skin                => "skinning"
      }

      @reject_bounties = ["boss_culling", "culling", "heirloom_loot", "skinning", "heirloom_search", "foraging", "rescue", "escort", "kill_bandits", "gem_collecting"] - @settings[:bounty_types]

      @herbalist_names = Regexp.union(
        /Akrash/i,
        /alchemist/i,
        /brother Barnstel/i,
        /famed baker Leaftoe/i,
        /healer/i,
        /herbalist/i,
        /Libram Greenleaf/i,
        /Maraene/i,
        /merchant Kelph/i,
        /old Mistress Lomara/i,
        /scarred Agarnil kris/i,
        /Sparkfinger/i,
      )

      herbalist_rooms_uid = [
        'u4043601',    # Icemule Trace
        'u1015',       # Wehnimer's Landing
        'u3003056',    # Kharam-Dzu
        'u14103400',   # Ta'Vaalor
        'u13104200',   # Ta'Illistim
        'u4740011',    # Solhaven
        'u2101052',    # River's Rest
        'u13010004',   # Zul Logoth
        'u7118358',    # Kraken's Fall
        'u7503253',    # Hinterwilds
        'u3201291',    # Mist Harbor
      ]

      @herbalist_rooms = []

      herbalist_rooms_uid.each { |room|
        @herbalist_rooms.push(Room[room].id) if Room[room].id.positive?
      }

      if @settings[:location1].empty? && @settings[:bad_room1].empty?
        @settings[:location1] = "Whistler's Pass"
        @settings[:bad_room1] = "37,38,39,40,41"
      end

      if @settings[:location2].empty? && @settings[:bad_room2].empty?
        @settings[:location2] = "Widowmaker's Road"
        @settings[:bad_room2] = "30609,30610,30611,30613,30614,30615,30616,30617,30618,30619,30811,30817,28918,28919,28920,28921,28922,28923,28929,28930,28931,28932,28978,29078,29079,29081,29089"
      end

      if @settings[:location3].empty? && @settings[:bad_room3].empty?
        @settings[:location3] = "Old Logging Road"
        @settings[:bad_room3] = "12532,12533,14729,3548,3762,3763"
      end

      @bad_rooms = []
      x = 1
      while x < 13
        bad_room = "bad_room#{x}".to_sym
        unless @settings[bad_room].empty?
          @settings[bad_room].split(/,\s?/).each { |room|
            @bad_rooms.push(EBounty.uid_match(room))
          }
        end
        x += 1
      end

      @remaining_skins = 0
      @skin = nil
      @remaining_gems = 0
      @gem = nil
      @dir = File.join($data_dir, XMLData.game, Char.name, "bigshot_profiles")
      @creature = nil
      @start_room = nil
      @location_start = nil
      @location_boundaries = nil
      @bundle_skin = nil
      @close_containers = []

      @gambits_available = false
      if @settings[:forage_options].include?("use_gambit") && Stats.prof == "Rogue"
        lines = EBounty.get_lines("gld", /<output class="mono"\/>/)
        if lines.any? { |l| l =~ /[put {item} [IN|ON|UNDER|BEHIND] {container}]/ }
          @gambits_available = true
        end
      end

      @guard_regex = Regexp.union(
        /suppress bandit activity|bandits you encounter/,
        /particularly dangerous|cull their numbers|(?!.*bandit)suppress .* activity/,
        /SEARCH the area|do a thorough SEARCH/,
        /LOOT the item from its corpse/,
        /I don't have any tasks for you right now/,
        /Try bugging me later/,
        /Ah, so you have returned/,
        /You have completed your task/
      )

      @forage_result = Regexp.union(
        /^You forage/,
        /^You make so much noise that only the dead would not notice you thrashing about in your unsuccessful search\.$/,
        /^You stumble about in a fruitless attempt at foraging\.$/,
        /you are unable to find anything useful/,
        /^As you carefully forage around you (can find no hint|see no evidence) of what you are looking for(?: right now, though you are fairly certain this is where it can be found)?\./,
        /^You begin to forage around when your hand comes into contact with something that stabs you in the finger\.$/,
        /^As you forage around you suddenly feel a sharp pain/,
        /^You begin to forage around when suddenly you feel a burning sensation in your hand\.$/,
        /^You fumble about so badly in your search that you can only hope no one was watching you\.$/
      )

      @forage_injury = Regexp.union(
        /^You begin to forage around when your hand comes into contact with something that stabs you in the finger./,
        /^As you forage around you suddenly feel a sharp pain in your/,
        /suddenly you feel a burning sensation in your hand/
      )

      @bounty_towns_uid = {
        'Icemule Trace'      => 'u4042150',
        'Kharam-Dzu'         => 'u3001025',
        "Kraken's Fall"      => 'u7118221',
        'Mist Harbor'        => 'u3201029',
        "River's Rest"       => 'u2101008',
        'Solhaven'           => 'u4209030',
        'Vornavis'           => 'u4209030',
        "Ta'Illistim"        => 'u13100042',
        "Ta'Vaalor"          => 'u14100047',
        "Wehnimer's Landing" => 'u7120',
        'Zul Logoth'         => 'u13006016',
        'Cold River'         => 'u7503205',
      }
    end
  end

  class Setup < Gtk::Builder
    @@categories = {
      general: {
        bounty_types: { default: [] },
        escort_types: { default: [] },
        forage_options: { default: [] },
        heirloom_options: { default: [] },
        creature_exclude: {
          default: [],
          load: proc do |store, setting|
            store.clear
            setting.each do |text|
              iter = store.append
              iter[0] = text
            end
          end,
          delete: proc do |_, selected, setting|
            setting.delete(selected.get_value(0))
            setting.uniq!.sort!
          end,
          set: proc do |_, text, setting|
            next if setting.include?(text)

            setting.push(text)
            setting.uniq!.sort!
          end
        },
        herb_exclude: {
          default: [],
          load: proc do |store, setting|
            store.clear
            setting.each do |text|
              iter = store.append
              iter[0] = text
            end
          end,
          delete: proc do |_, selected, setting|
            setting.delete(selected.get_value(0))
            setting.uniq!.sort!
          end,
          set: proc do |_, text, setting|
            next if setting.include?(text)

            setting.push(text)
            setting.uniq!.sort!
          end
        },
        gem_exclude: {
          default: [],
          load: proc do |store, setting|
            store.clear
            setting.each do |text|
              iter = store.append
              iter[0] = text
            end
          end,
          delete: proc do |_, selected, setting|
            setting.delete(selected.get_value(0))
            setting.uniq!.sort!
          end,
          set: proc do |_, text, setting|
            next if setting.include?(text)

            setting.push(text)
            setting.uniq!.sort!
          end
        },
        location_exclude: {
          default: [],
          load: proc do |store, setting|
            store.clear
            setting.each do |text|
              iter = store.append
              iter[0] = text
            end
          end,
          delete: proc do |_, selected, setting|
            setting.delete(selected.get_value(0))
            setting.uniq!.sort!
          end,
          set: proc do |_, text, setting|
            next if setting.include?(text)

            setting.push(text)
            setting.uniq!.sort!
          end
        },
        culling_max: { default: 30 },
        gem_max: { default: 30 },
        herb_max: { default: 30 },
        skin_max: { default: 30 },
        extra_skin: { default:  0 },
        exp_pause: { default: false },
        only_required_creatures: { default: false },
        use_boosts: { default: false },
        use_vouchers: { default: false },
        skip_healing: { default: false },
        remove_heirloom: { default: false },
        once_and_done: { default: false },
        keep_hunting: { default: false },
        basic: { default: false },
        selling_script: { default: 'eloot' },
        healing_script: { default: 'eherbs' },
        death_script: { default: '' },
        hording_script: { default: '' },
        escort_script: { default: 'ego2' },
        rescue_script: { default: 'echild' },
        gem_history: { default: '' },

        # Resting Tab
        table_rest: { default: false },
        bigshot_rest: { default: false },
        custom_rest: { default: false },
        resting_room: { default: '' },
        rest_random: { default: false },
        use_script: { default: false },
        use_script_name: { default: '' },
        join_player: { default: false },
        join_list: { default: '' },
        use_buff_script: { default: false },
        buff_script: { default: '' },

        # Foraging
        forage_prep_commands: { default: '' },
        forage_prep_scripts: { default: '' },
        forage_post_commands: { default: '' },
        forage_post_scripts: { default: '' },

        # Heirloom
        heirloom_prep_commands: { default: '' },
        heirloom_prep_scripts: { default: '' },
        heirloom_post_commands: { default: '' },
        heirloom_post_scripts: { default: '' },

        # Bandits - Location Labels
        wander_wait: { default:  0.5 },
        location1: { default: '' },
        location2: { default: '' },
        location3: { default: '' },
        location4: { default: '' },
        location5: { default: '' },
        location6: { default: '' },
        location7: { default: '' },
        location8: { default: '' },
        location9: { default: '' },
        location10: { default: '' },
        location11: { default: '' },
        location12: { default: '' },

        # Bandits - Bad Rooms
        bad_room1: { default: '' },
        bad_room2: { default: '' },
        bad_room3: { default: '' },
        bad_room4: { default: '' },
        bad_room5: { default: '' },
        bad_room6: { default: '' },
        bad_room7: { default: '' },
        bad_room8: { default: '' },
        bad_room9: { default: '' },
        bad_room10: { default: '' },
        bad_room11: { default: '' },
        bad_room12: { default: '' },

        # Escort
        escort_prep_commands: { default: '' },
        escort_prep_scripts: { default: '' },
        escort_post_commands: { default: '' },
        escort_post_scripts: { default: '' },

        # Profiles
        default_name: { default: '' },
        default_profile: { default: '' },
        profile_name_bandits: { default: '' },
        bandits_profile: { default: '' },
        kill_bandits: { default: false },
        names_a: { default: '' },
        profile_a: { default: '' },
        profile_name_a: { default: '' },
        kill_a: { default: false },
        names_b: { default: '' },
        profile_b: { default: '' },
        profile_name_b: { default: '' },
        kill_b: { default: false },
        names_c: { default: '' },
        profile_c: { default: '' },
        profile_name_c: { default: '' },
        kill_c: { default: false },
        names_d: { default: '' },
        profile_d: { default: '' },
        profile_name_d: { default: '' },
        kill_d: { default: false },
        names_e: { default: '' },
        profile_e: { default: '' },
        profile_name_e: { default: '' },
        kill_e: { default: false },
        names_f: { default: '' },
        profile_f: { default: '' },
        profile_name_f: { default: '' },
        kill_f: { default: false },
        names_g: { default: '' },
        profile_g: { default: '' },
        profile_name_g: { default: '' },
        kill_g: { default: false },
        names_h: { default: '' },
        profile_h: { default: '' },
        profile_name_h: { default: '' },
        kill_h: { default: false },
        names_i: { default: '' },
        profile_i: { default: '' },
        profile_name_i: { default: '' },
        kill_i: { default: false },
        names_j: { default: '' },
        profile_j: { default: '' },
        profile_name_j: { default: '' },
        kill_j: { default: false },
      },
      internal: {
        silence: { default: true },
        debug: { default: false },
      }
    }

    if XMLData.game == "GSF"
      @@categories[:general][:icemule_resting]  = { default: '2429, 2468, 3449, 3428, 2300, 3365' }
      @@categories[:general][:teras_resting]    = { default: '1844, 1932' }
      @@categories[:general][:kf_resting]       = { default: '28813, 21495, 21592' }
      @@categories[:general][:fwi_resting]      = { default: '3668' }
      @@categories[:general][:rr_resting]       = { default: '10861, 10855, 20964' }
      @@categories[:general][:solhaven_resting] = { default: '14234, 1481, 5732, 1438, 1572' }
      @@categories[:general][:illy_resting]     = { default: '156, 638, 728, 188, 13362, 601, 24555' }
      @@categories[:general][:vaalor_resting]   = { default: '3486, 10374, 3519, 3542' }
      @@categories[:general][:landing_resting]  = { default: '1263, 318, 477, 8859, 288, 228, 1259' }
      @@categories[:general][:zul_resting]      = { default: '1005, 5751' }
    else
      @@categories[:general][:icemule_resting]  = { default: '21689, 2468, 3449, 3428, 2300, 3365' }
      @@categories[:general][:teras_resting]    = { default: '1844, 1932' }
      @@categories[:general][:kf_resting]       = { default: '28813, 28950, 28916' }
      @@categories[:general][:fwi_resting]      = { default: '3668, 28742, 18258, 17587' }
      @@categories[:general][:rr_resting]       = { default: '10861, 10855, 28717' }
      @@categories[:general][:solhaven_resting] = { default: '14234, 1481, 5732, 1438, 1572' }
      @@categories[:general][:illy_resting]     = { default: '156, 638, 728, 188, 13362, 601, 24555' }
      @@categories[:general][:vaalor_resting]   = { default: '3486, 10374, 3519, 3542' }
      @@categories[:general][:landing_resting]  = { default: '1263, 318, 477, 8859, 288, 228, 1259' }
      @@categories[:general][:zul_resting]      = { default: '1005, 5751' }
    end

    def self.get_category(key)
      @@categories.each { |category, data| return category unless data[key].nil? }
      nil
    end

    def self.get_setting(key)
      cat = Setup.get_category(key)
      return nil if cat.nil?

      @@categories[cat].each { |setting, data| return data if setting == key }
      nil
    end

    def initialize(settings)
      super()

      @script_ver = EBounty.get_script_version
      @settings = settings

      # set default values if they don't exist
      @@categories.each do |_, data|
        data.each { |key, value| @settings[key] = value[:default] if @settings[key].to_s.empty? }
      end

      # remove settings that doesn't exist
      @settings.delete_if { |key, _| next Setup.get_category(key).nil? }

      # use a GTK Builder to setup all the basics of the window then expand on that base
      return unless defined?(Gtk) && Gtk::Version::MAJOR == 3

      Gtk.queue do
        # add_from_file("#{$data_dir}ebounty.ui")
        add_from_string(ui)
        load_settings

        self['main'].keep_above = true
        self['main'].set_title "EBounty Setup v#{@script_ver}"

        # connect signals after settings are loaded to a bunch of handlers don't trigger
        connect_signals { |handler| method(handler) }
      end
    end

    def ui
      '<?xml version="1.0" encoding="UTF-8"?><!-- Generated with glade 3.38.2 --><interface><requires lib="gtk+" version="3.20"/><object class="GtkListStore" id="creature_exclude_store"><columns><!-- column-name exclusion --><column type="gchararray"/></columns></object><object class="GtkAdjustment" id="culling_adjustment"><property name="upper">100</property><property name="step-increment">1</property><property name="page-increment">10</property>
      </object><object class="GtkAdjustment" id="extra_skin_adjustment"><property name="upper">100</property><property name="step-increment">1</property><property name="page-increment">10</property></object><object class="GtkAdjustment" id="gem_adjustment"><property name="upper">100</property><property name="step-increment">1</property><property name="page-increment">10</property></object><object class="GtkListStore" id="gem_exclude_store"><columns><!-- column-name exclusion --><column type="gchararray"/>
      </columns></object><object class="GtkAdjustment" id="herb_adjustment"><property name="upper">100</property><property name="step-increment">1</property><property name="page-increment">10</property></object><object class="GtkListStore" id="herb_exclude_store"><columns><!-- column-name exclusion --><column type="gchararray"/></columns></object><object class="GtkListStore" id="location_exclude_store"><columns><!-- column-name exclusion --><column type="gchararray"/></columns></object><object class="GtkAdjustment" id="skin_adjustment"><property name="upper">100</property><property name="step-increment">1</property><property name="page-increment">10</property>
      </object><object class="GtkAdjustment" id="wander_wait_adjustment"><property name="upper">100</property><property name="step-increment">0.10</property><property name="page-increment">10</property></object><object class="GtkWindow" id="main"><property name="width-request">850</property><property name="height-request">775</property><property name="can-focus">False</property><property name="title" translatable="yes">EBounty Setup</property><property name="modal">True</property><property name="default-width">850</property><property name="default-height">785</property><signal name="destroy" handler="on_destroy" swapped="no"/><child><object class="GtkBox"><property name="visible">True</property><property name="can-focus">False</property><property name="orientation">vertical</property><property name="spacing">5</property><child><object class="GtkNotebook"><property name="visible">True</property><property name="can-focus">True</property><property name="hexpand">True</property><property name="vexpand">True</property><child><object class="GtkScrolledWindow"><property name="visible">True</property><property name="can-focus">True</property><property name="shadow-type">in</property><child><object class="GtkViewport"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkBox"><property name="visible">True</property><property name="can-focus">False</property><property name="orientation">vertical</property><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=5 n-rows=2 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="row-spacing">2</property><property name="column-spacing">5</property><property name="column-homogeneous">True</property><child><object class="GtkCheckButton" id="bounty_types:boss_culling"><property name="label" translatable="yes">Boss Creature</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="bounty_types:culling"><property name="label" translatable="yes">Culling</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="bounty_types:escort"><property name="label" translatable="yes">Escort</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="bounty_types:foraging"><property name="label" translatable="yes">Foraging</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="bounty_types:gem_collecting"><property name="label" translatable="yes">Gem Collecting</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">4</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="bounty_types:heirloom_loot"><property name="label" translatable="yes">Heirloom (loot)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="bounty_types:heirloom_search"><property name="label" translatable="yes">Heirloom (search)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="bounty_types:kill_bandits"><property name="label" translatable="yes">Kill Bandits</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="bounty_types:rescue"><property name="label" translatable="yes">Rescue</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="bounty_types:skinning"><property name="label" translatable="yes">Skinning</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">4</property><property name="top-attach">1</property></packing></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Bounty Types</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">0</property></packing></child><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=6 n-rows=3 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="row-spacing">5</property><property name="column-spacing">5</property><child><object class="GtkCheckButton" id="exp_pause"><property name="label" translatable="yes">Rest when mind full</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-top">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="once_and_done"><property name="label" translatable="yes">Run one bounty and quit</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-start">50</property><property name="margin-top">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="use_vouchers"><property name="label" translatable="yes">Use Vouchers</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-start">50</property><property name="margin-top">5</property><property name="margin-bottom">15</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">2</property></packing></child><child><object class="GtkCheckButton" id="basic"><property name="label" translatable="yes">Just the Basics (?)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="tooltip-text" translatable="yes">Only pickup and return bounties based on settings. No automatic hunting or whatnot.
                  </property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-top">5</property><property name="margin-bottom">15</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">2</property></packing></child><child><object class="GtkCheckButton" id="use_boosts"><property name="label" translatable="yes">Use Bounty Boosts</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-start">50</property><property name="margin-top">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="keep_hunting"><property name="label" translatable="yes">Keep Hunting (?)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="tooltip-text" translatable="yes">When checked this will use your gem/default profile to keep hunting instead of exiting when no bounty profile is found.
                  </property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-top">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="skip_healing"><property name="label" translatable="yes">Skip Healing</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-start">50</property><property name="margin-top">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="remove_heirloom"><property name="label" translatable="yes">Remove Bounty if Heirloom Item is Missing</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-start">50</property><property name="margin-top">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">1</property></packing></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Misc</property>
      </object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">1</property></packing></child><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=4 n-rows=4 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkEntry" id="selling_script"><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="valign">start</property><property name="margin-end">5</property><property name="margin-top">5</property><property name="margin-bottom">10</property><property name="max-width-chars">35</property><property name="placeholder-text" translatable="yes">Defaults to eloot</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">2</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Selling Script:</property></object><packing><property name="left-attach">0</property><property name="top-attach">2</property>
      </packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-top">15</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Healing Script:</property></object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="healing_script"><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="valign">start</property><property name="margin-end">5</property><property name="margin-top">15</property><property name="margin-bottom">10</property><property name="max-width-chars">35</property><property name="placeholder-text" translatable="yes">Defaults to eherb</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="escort_script"><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="valign">start</property><property name="margin-end">5</property><property name="margin-top">15</property><property name="margin-bottom">10</property><property name="max-width-chars">35</property><property name="placeholder-text" translatable="yes">Defaults to ego</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="rescue_script"><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="valign">start</property><property name="margin-end">5</property><property name="margin-top">6</property><property name="margin-bottom">10</property><property name="max-width-chars">35</property><property name="placeholder-text" translatable="yes">Defaults to echild</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">1</property></packing></child><child><object class="GtkEntry" id="hording_script"><property name="visible">True</property><property name="can-focus">True</property><property name="tooltip-text" translatable="yes">This should be the script name then a comma then any necessary parameters. Like this:  hording script name, parameters </property><property name="halign">start</property><property name="valign">start</property><property name="margin-end">5</property><property name="margin-top">5</property><property name="margin-bottom">20</property><property name="max-width-chars">35</property><property name="placeholder-text" translatable="yes">Runs before gem bounty (optional)</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">3</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-top">15</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Escort Script:</property></object><packing><property name="left-attach">2</property><property name="top-attach">0</property>
      </packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">40</property><property name="margin-end">5</property><property name="margin-bottom">5</property><property name="label" translatable="yes">Rescue Script:</property></object><packing><property name="left-attach">2</property><property name="top-attach">1</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-bottom">20</property><property name="label" translatable="yes">Hording Script(?):</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">3</property></packing></child><child><object class="GtkEntry" id="death_script"><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="valign">start</property><property name="margin-end">5</property><property name="margin-top">15</property><property name="margin-bottom">10</property><property name="max-width-chars">35</property><property name="placeholder-text" translatable="yes">Will run if character dies (optional)</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">1</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">20</property><property name="margin-end">5</property><property name="margin-top">15</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Death Recovery Script:</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">1</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-bottom">5</property><property name="label" translatable="yes">Gem History:</property></object><packing><property name="left-attach">2</property><property name="top-attach">2</property>
      </packing></child><child><object class="GtkEntry" id="gem_history"><property name="visible">True</property><property name="can-focus">True</property><property name="tooltip-text" translatable="yes">This script will run after being given a gem bounty.
      Useful if you want to track frequency of different gems asked for.</property><property name="halign">start</property><property name="valign">start</property><property name="margin-end">5</property><property name="margin-top">6</property><property name="margin-bottom">10</property><property name="max-width-chars">35</property><property name="placeholder-text" translatable="yes">Tracks bounty gems (optional)</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">2</property></packing></child><child><placeholder/></child><child><placeholder/></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Support Scripts</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">2</property>
      </packing></child><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=6 n-rows=2 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-end">7</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="row-spacing">5</property><property name="column-spacing">5</property><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">5</property><property name="label" translatable="yes">  Max Culling Kills</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkSpinButton" id="culling_max"><property name="visible">True</property><property name="can-focus">True</property><property name="adjustment">culling_adjustment</property><property name="numeric">True</property><property name="value">30</property></object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Max Gems</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">1</property></packing></child><child><object class="GtkSpinButton" id="gem_max"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-bottom">10</property><property name="adjustment">gem_adjustment</property><property name="numeric">True</property><property name="value">30</property></object><packing><property name="left-attach">1</property><property name="top-attach">1</property>
      </packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes"></property></object><packing><property name="left-attach">2</property><property name="top-attach">1</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">20</property><property name="label" translatable="yes">Max Herbs</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">0</property></packing></child><child><object class="GtkSpinButton" id="herb_max"><property name="visible">True</property><property name="can-focus">True</property><property name="adjustment">herb_adjustment</property><property name="numeric">True</property><property name="value">30</property></object><packing><property name="left-attach">3</property><property name="top-attach">0</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Max Skins</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">1</property></packing></child><child><object class="GtkSpinButton" id="skin_max"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-bottom">10</property><property name="adjustment">skin_adjustment</property><property name="numeric">True</property><property name="value">30</property></object><packing><property name="left-attach">3</property><property name="top-attach">1</property>
      </packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="tooltip-text" translatable="yes">Number of extra skins before turn in.</property><property name="margin-start">20</property><property name="margin-bottom">10</property><property name="label" translatable="yes"># of extra skins (?)</property></object><packing><property name="left-attach">4</property><property name="top-attach">1</property></packing></child><child><object class="GtkSpinButton" id="extra_skin"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-bottom">10</property><property name="text" translatable="yes">30</property><property name="adjustment">extra_skin_adjustment</property><property name="numeric">True</property>
      </object><packing><property name="left-attach">5</property><property name="top-attach">1</property></packing></child><child><placeholder/></child><child><placeholder/></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Task Limits</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">3</property>
      </packing></child></object></child></object></child></object></child><child type="tab"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">General</property></object><packing><property name="tab-fill">False</property></packing></child><child><object class="GtkBox"><property name="visible">True</property><property name="can-focus">False</property><property name="orientation">vertical</property><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=6 n-rows=9 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkCheckButton" id="custom_rest"><property name="label" translatable="yes">Use Custom Resting Area(s)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">2</property><property name="width">2</property></packing></child><child><object class="GtkEntry" id="resting_room"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="tooltip-text" translatable="yes">Will randomly select from this list to rest from
      If only one location is listed it will always go there
      Needs to be a comma separated list</property><property name="halign">start</property><property name="margin-start">15</property><property name="margin-top">5</property><property name="placeholder-text" translatable="yes">Custom Resting Location(s)</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">3</property></packing></child><child><object class="GtkCheckButton" id="rest_random"><property name="label" translatable="yes">Use Random Resting Areas</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-start">10</property><property name="margin-top">20</property><property name="margin-bottom">10</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">6</property><property name="width">2</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-top">15</property><property name="margin-bottom">10</property><property name="label" translatable="yes">*** If no selections are made the script will rest in the nexus (if shattered) or town center ***</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">8</property><property name="width">6</property></packing></child><child><!-- n-columns=4 n-rows=5 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">15</property><property name="margin-end">5</property><property name="margin-top">5</property><property name="label" translatable="yes">Icemule Trace:</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="icemule_resting"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-start">10</property><property name="margin-top">5</property></object><packing><property name="left-attach">1</property><property name="top-attach">0</property>
      </packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-top">5</property><property name="label" translatable="yes">Kharam Dzu:</property></object><packing><property name="left-attach">0</property><property name="top-attach">1</property></packing></child><child><object class="GtkEntry" id="teras_resting"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-start">10</property><property name="margin-top">5</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">1</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-top">5</property><property name="label" translatable="yes">Kraken\'s Fall:</property></object><packing><property name="left-attach">0</property><property name="top-attach">2</property>
      </packing></child><child><object class="GtkEntry" id="kf_resting"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-start">10</property><property name="margin-top">5</property></object><packing><property name="left-attach">1</property><property name="top-attach">2</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-top">5</property><property name="label" translatable="yes">Mist Harbor:</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">3</property></packing></child><child><object class="GtkEntry" id="fwi_resting"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-start">10</property><property name="margin-top">5</property></object><packing><property name="left-attach">1</property><property name="top-attach">3</property>
      </packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-top">5</property><property name="label" translatable="yes">River\'s Rest:</property></object><packing><property name="left-attach">0</property><property name="top-attach">4</property></packing></child><child><object class="GtkEntry" id="rr_resting"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-start">10</property><property name="margin-top">5</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">4</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-top">5</property><property name="label" translatable="yes">Solhaven:</property></object><packing><property name="left-attach">2</property><property name="top-attach">0</property>
      </packing></child><child><object class="GtkEntry" id="solhaven_resting"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-start">10</property><property name="margin-top">5</property></object><packing><property name="left-attach">3</property><property name="top-attach">0</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-top">5</property><property name="label" translatable="yes">Ta\'llistim:</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">1</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-top">5</property><property name="label" translatable="yes">Ta\'Vaalor:</property></object><packing><property name="left-attach">2</property><property name="top-attach">2</property>
      </packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">40</property><property name="margin-end">5</property><property name="margin-top">5</property><property name="label" translatable="yes">Wehnimer\'s Landing:</property></object><packing><property name="left-attach">2</property><property name="top-attach">3</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-top">5</property><property name="label" translatable="yes">Zul Logoth:</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">4</property></packing></child><child><object class="GtkEntry" id="illy_resting"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property></object><packing><property name="left-attach">3</property><property name="top-attach">1</property>
      </packing></child><child><object class="GtkEntry" id="vaalor_resting"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property></object><packing><property name="left-attach">3</property><property name="top-attach">2</property></packing></child><child><object class="GtkEntry" id="landing_resting"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">3</property></packing></child><child><object class="GtkEntry" id="zul_resting"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property></object><packing><property name="left-attach">3</property><property name="top-attach">4</property>
      </packing></child></object><packing><property name="left-attach">0</property><property name="top-attach">7</property><property name="width">6</property></packing></child><child><object class="GtkEntry" id="join_list"><property name="width-request">425</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-top">5</property><property name="placeholder-text" translatable="yes">Will try to join in order listed</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">3</property><property name="width">3</property></packing></child><child><object class="GtkCheckButton" id="join_player"><property name="label" translatable="yes">Join Character(s)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-top">10</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">2</property></packing></child><child><object class="GtkCheckButton" id="bigshot_rest"><property name="label" translatable="yes">Use Bigshot Resting Room</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="table_rest"><property name="label" translatable="yes">Use Nearest Table</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="use_script"><property name="label" translatable="yes">Use Script to Handle Resting Location</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-top">10</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="use_script_name"><property name="width-request">425</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-top">5</property><property name="placeholder-text" translatable="yes">usage: script_name parameter1 parameter2</property></object><packing><property name="left-attach">3</property><property name="top-attach">1</property>
      </packing></child><child><object class="GtkCheckButton" id="use_buff_script"><property name="label" translatable="yes">Use Buff Script</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">start</property><property name="margin-top">10</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">3</property><property name="top-attach">4</property>
      </packing></child><child><object class="GtkEntry" id="buff_script"><property name="width-request">425</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-top">5</property><property name="placeholder-text" translatable="yes">usage: script_name parameter1 parameter2</property></object><packing><property name="left-attach">3</property><property name="top-attach">5</property></packing></child><child><placeholder/>
      </child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/>
      </child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Resting Options</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">0</property>
      </packing></child></object><packing><property name="position">1</property></packing></child><child type="tab"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Resting</property></object><packing><property name="position">1</property><property name="tab-fill">False</property></packing></child><child><object class="GtkScrolledWindow"><property name="visible">True</property><property name="can-focus">True</property><property name="shadow-type">in</property><child><object class="GtkViewport"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkBox"><property name="visible">True</property><property name="can-focus">False</property><property name="orientation">vertical</property><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=4 n-rows=5 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><property name="column-homogeneous">True</property><child><object class="GtkCheckButton" id="forage_options:hiding"><property name="label" translatable="yes">Hide when foraging</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="forage_options:use_608"><property name="label" translatable="yes">Camouflage (608)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">2</property></packing></child><child><object class="GtkCheckButton" id="forage_options:use_604"><property name="label" translatable="yes">Nature\'s Bounty (604)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="forage_options:use_619"><property name="label" translatable="yes">Mass Calm (619)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">3</property></packing></child><child><object class="GtkCheckButton" id="forage_options:use_506"><property name="label" translatable="yes">Celerity (506)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="forage_options:use_gambit"><property name="label" translatable="yes">Rogue Gambits: Stealth</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">2</property></packing></child><child><object class="GtkCheckButton" id="forage_options:use_213"><property name="label" translatable="yes">Minor Sanctuary (213)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-top">1</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="forage_options:use_1011"><property name="label" translatable="yes">Song of Peace (1011)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">2</property></packing></child><child><object class="GtkCheckButton" id="forage_options:use_650"><property name="label" translatable="yes">Assume Aspect (650) Yierka</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">4</property></packing></child><child><object class="GtkCheckButton" id="forage_options:use_709"><property name="label" translatable="yes">Grasp of the Grave (709)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">4</property></packing></child><child><object class="GtkCheckButton" id="forage_options:run"><property name="label" translatable="yes">Run from creatures</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="forage_options:use_919"><property name="label" translatable="yes">Wizard\'s Shield (919)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="forage_options:use_140"><property name="label" translatable="yes">Wall of Force (140)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="forage_options:use_604evoke"><property name="label" translatable="yes">Nature\'s Bounty Evoke (604)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="forage_options:use_1035"><property name="label" translatable="yes">Song of Tonis (1035)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">3</property></packing></child><child><object class="GtkCheckButton" id="forage_options:use_resolve"><property name="label" translatable="yes">Sigil of Resolve</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">3</property></packing></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Foraging Options</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">0</property>
      </packing></child><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=2 n-rows=2 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Pre-Foraging Commands:</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="forage_prep_commands"><property name="width-request">550</property><property name="visible">True</property><property name="can-focus">True</property><property name="valign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="max-width-chars">40</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Active Foraging Scripts:</property></object><packing><property name="left-attach">0</property><property name="top-attach">1</property>
      </packing></child><child><object class="GtkEntry" id="forage_prep_scripts"><property name="visible">True</property><property name="can-focus">True</property><property name="valign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="max-width-chars">40</property></object><packing><property name="left-attach">1</property><property name="top-attach">1</property>
      </packing></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Pre-Foraging</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">1</property></packing></child><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=2 n-rows=2 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Post-Foraging Commands:</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="forage_post_commands"><property name="width-request">550</property><property name="visible">True</property><property name="can-focus">True</property><property name="valign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="max-width-chars">40</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Post-Foraging Scripts:</property></object><packing><property name="left-attach">0</property><property name="top-attach">1</property>
      </packing></child><child><object class="GtkEntry" id="forage_post_scripts"><property name="visible">True</property><property name="can-focus">True</property><property name="valign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="max-width-chars">40</property></object><packing><property name="left-attach">1</property><property name="top-attach">1</property>
      </packing></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Post-Foraging</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">2</property></packing></child></object></child></object></child></object><packing><property name="position">2</property></packing></child><child type="tab"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Foraging</property>
      </object><packing><property name="position">2</property><property name="tab-fill">False</property></packing></child><child><object class="GtkScrolledWindow"><property name="visible">True</property><property name="can-focus">True</property><property name="shadow-type">in</property><child><object class="GtkViewport"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkBox"><property name="visible">True</property><property name="can-focus">False</property><property name="orientation">vertical</property><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=4 n-rows=4 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><property name="column-homogeneous">True</property><child><object class="GtkCheckButton" id="heirloom_options:use_619"><property name="label" translatable="yes">Mass Calm (619)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="heirloom_options:use_506"><property name="label" translatable="yes">Celerity (506)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="heirloom_options:use_213"><property name="label" translatable="yes">Minor Sanctuary (213)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="heirloom_options:use_1011"><property name="label" translatable="yes">Song of Peace (1011)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="heirloom_options:use_709"><property name="label" translatable="yes">Grasp of the Grave (709)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="heirloom_options:run"><property name="label" translatable="yes">Run from creatures</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="heirloom_options:use_919"><property name="label" translatable="yes">Wizard\'s Shield (919)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">2</property></packing></child><child><object class="GtkCheckButton" id="heirloom_options:use_140"><property name="label" translatable="yes">Wall of Force (140)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">2</property></packing></child><child><object class="GtkCheckButton" id="heirloom_options:use_402"><property name="label" translatable="yes">Presence (402)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="heirloom_options:use_1035"><property name="label" translatable="yes">Song of Tonis (1035)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="heirloom_options:use_right"><property name="label" translatable="yes">Flag right hand (?)</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="tooltip-text" translatable="yes">Heirloom will default to right hand instead of laying on the ground.</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-top">10</property><property name="margin-bottom">5</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">3</property><property name="width">4</property></packing></child><child><placeholder/></child><child><placeholder/></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Search Options</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">0</property>
      </packing></child><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=2 n-rows=2 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Pre-Searching Commands:</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="heirloom_prep_commands"><property name="width-request">550</property><property name="visible">True</property><property name="can-focus">True</property><property name="valign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="max-width-chars">40</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Active Searching Scripts:</property></object><packing><property name="left-attach">0</property><property name="top-attach">1</property>
      </packing></child><child><object class="GtkEntry" id="heirloom_prep_scripts"><property name="visible">True</property><property name="can-focus">True</property><property name="valign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="max-width-chars">40</property></object><packing><property name="left-attach">1</property><property name="top-attach">1</property>
      </packing></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Pre-Heirloom Searching</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">1</property></packing></child><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=2 n-rows=2 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Post-Searching Commands:</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="heirloom_post_commands"><property name="width-request">550</property><property name="visible">True</property><property name="can-focus">True</property><property name="valign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="max-width-chars">40</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Post-Searching Scripts:</property></object><packing><property name="left-attach">0</property><property name="top-attach">1</property>
      </packing></child><child><object class="GtkEntry" id="heirloom_post_scripts"><property name="visible">True</property><property name="can-focus">True</property><property name="valign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="max-width-chars">40</property></object><packing><property name="left-attach">1</property><property name="top-attach">1</property>
      </packing></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Post-Heirloom Searching</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">2</property></packing></child></object></child></object></child></object><packing><property name="position">3</property></packing>
      </child><child type="tab"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Heirloom</property></object><packing><property name="position">3</property><property name="tab-fill">False</property></packing></child><child><object class="GtkScrolledWindow"><property name="visible">True</property><property name="can-focus">True</property><property name="shadow-type">in</property><child><object class="GtkViewport"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkBox"><property name="visible">True</property><property name="can-focus">False</property><property name="orientation">vertical</property><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=3 n-rows=3 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkSpinButton" id="wander_wait"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-bottom">10</property><property name="text" translatable="yes">30</property><property name="adjustment">wander_wait_adjustment</property><property name="digits">1</property><property name="numeric">True</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-start">10</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Wait this long before moving rooms</property></object><packing><property name="left-attach">0</property><property name="top-attach">0</property>
      </packing></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Wander Timing</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">0</property>
      </packing></child><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=3 n-rows=25 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">1</property><property name="width">3</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="tooltip-text" translatable="yes">Reference only, doesn\'t need to be exact</property><property name="margin-top">5</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Location</property><property name="use-markup">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="tooltip-text" translatable="yes">Should be a comma seperated list (228, 188 ,u76564564)</property><property name="margin-top">5</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Bad Room Numbers (Supports UID\'s)</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property><property name="width">2</property></packing></child><child><object class="GtkEntry" id="location3"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">0</property><property name="top-attach">6</property>
      </packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">3</property><property name="width">3</property></packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">7</property><property name="width">3</property>
      </packing></child><child><object class="GtkEntry" id="location4"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">0</property><property name="top-attach">8</property></packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">9</property><property name="width">3</property></packing></child><child><object class="GtkEntry" id="location5"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">0</property><property name="top-attach">10</property>
      </packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">11</property><property name="width">3</property></packing></child><child><object class="GtkEntry" id="location6"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">12</property></packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">13</property><property name="width">3</property></packing></child><child><object class="GtkEntry" id="location7"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">14</property></packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">15</property><property name="width">3</property></packing></child><child><object class="GtkEntry" id="location8"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">16</property></packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">17</property><property name="width">3</property></packing></child><child><object class="GtkEntry" id="location9"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">18</property></packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">19</property><property name="width">3</property></packing></child><child><object class="GtkEntry" id="location10"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">20</property></packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">21</property><property name="width">3</property></packing></child><child><object class="GtkEntry" id="location11"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">22</property></packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">23</property><property name="width">3</property></packing></child><child><object class="GtkEntry" id="location12"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">24</property></packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">5</property><property name="width">3</property></packing></child><child><object class="GtkEntry" id="location2"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">4</property></packing></child><child><object class="GtkEntry" id="location1"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">0</property><property name="top-attach">2</property>
      </packing></child><child><object class="GtkEntry" id="bad_room1"><property name="width-request">400</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">1</property><property name="top-attach">2</property><property name="width">2</property>
      </packing></child><child><object class="GtkEntry" id="bad_room2"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">1</property><property name="top-attach">4</property><property name="width">2</property>
      </packing></child><child><object class="GtkEntry" id="bad_room3"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">1</property><property name="top-attach">6</property><property name="width">2</property>
      </packing></child><child><object class="GtkEntry" id="bad_room4"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">1</property><property name="top-attach">8</property><property name="width">2</property>
      </packing></child><child><object class="GtkEntry" id="bad_room5"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">1</property><property name="top-attach">10</property><property name="width">2</property>
      </packing></child><child><object class="GtkEntry" id="bad_room6"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">1</property><property name="top-attach">12</property><property name="width">2</property>
      </packing></child><child><object class="GtkEntry" id="bad_room7"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">1</property><property name="top-attach">14</property><property name="width">2</property>
      </packing></child><child><object class="GtkEntry" id="bad_room8"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">1</property><property name="top-attach">16</property><property name="width">2</property>
      </packing></child><child><object class="GtkEntry" id="bad_room9"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">1</property><property name="top-attach">18</property><property name="width">2</property>
      </packing></child><child><object class="GtkEntry" id="bad_room10"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">1</property><property name="top-attach">20</property><property name="width">2</property>
      </packing></child><child><object class="GtkEntry" id="bad_room11"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">1</property><property name="top-attach">22</property><property name="width">2</property>
      </packing></child><child><object class="GtkEntry" id="bad_room12"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">1</property><property name="top-attach">24</property><property name="width">2</property>
      </packing></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Bad Room List</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">1</property></packing></child></object></child></object></child></object><packing><property name="position">4</property></packing></child><child type="tab"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Bandits</property>
      </object><packing><property name="position">4</property><property name="tab-fill">False</property></packing></child><child><object class="GtkScrolledWindow"><property name="visible">True</property><property name="can-focus">True</property><property name="shadow-type">in</property><child><object class="GtkViewport"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkBox"><property name="visible">True</property><property name="can-focus">False</property><property name="orientation">vertical</property><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-top">6</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=9 n-rows=9 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="row-spacing">10</property><property name="column-spacing">5</property><property name="row-homogeneous">True</property><property name="column-homogeneous">True</property><child><object class="GtkCheckButton" id="escort_types:landing_to_illy"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">6</property><property name="top-attach">2</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Destination </property></object><packing><property name="left-attach">1</property><property name="top-attach">0</property><property name="width">7</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="label" translatable="yes">Icemule</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">4</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="label" translatable="yes">Solhaven</property></object><packing><property name="left-attach">1</property><property name="top-attach">3</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="label" translatable="yes">Wehnimer\'s</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">2</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Start From</property><property name="angle">90</property></object><packing><property name="left-attach">0</property><property name="top-attach">2</property><property name="height">7</property></packing></child><child><object class="GtkCheckButton" id="escort_types:vaalor_to_landing"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">7</property></packing></child><child><object class="GtkCheckButton" id="escort_types:illy_to_landing"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">2</property><property name="top-attach">6</property>
      </packing></child><child><object class="GtkCheckButton" id="escort_types:zul_to_landing"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">2</property><property name="top-attach">5</property></packing></child><child><object class="GtkCheckButton" id="escort_types:icemule_to_landing"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">4</property></packing></child><child><object class="GtkCheckButton" id="escort_types:solhaven_to_landing"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">2</property><property name="top-attach">3</property>
      </packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">--</property></object><packing><property name="left-attach">2</property><property name="top-attach">2</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="label" translatable="yes">Zul Logoth</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">5</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="label" translatable="yes">Ta\'llistim</property></object><packing><property name="left-attach">1</property><property name="top-attach">6</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="label" translatable="yes">Ta\'Vaalor</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">7</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="label" translatable="yes">Wehnimer\'s</property></object><packing><property name="left-attach">2</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="escort_types:vaalor_to_solhaven"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">7</property></packing></child><child><object class="GtkCheckButton" id="escort_types:illy_to_solhaven"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">3</property><property name="top-attach">6</property>
      </packing></child><child><object class="GtkCheckButton" id="escort_types:zul_to_solhaven"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">3</property><property name="top-attach">5</property></packing></child><child><object class="GtkCheckButton" id="escort_types:icemule_to_solhaven"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">4</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">--</property></object><packing><property name="left-attach">3</property><property name="top-attach">3</property></packing></child><child><object class="GtkCheckButton" id="escort_types:landing_to_solhaven"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">3</property><property name="top-attach">2</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="label" translatable="yes">Solhaven</property></object><packing><property name="left-attach">3</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="escort_types:vaalor_to_icemule"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">4</property><property name="top-attach">7</property></packing></child><child><object class="GtkCheckButton" id="escort_types:illy_to_icemule"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">4</property><property name="top-attach">6</property>
      </packing></child><child><object class="GtkCheckButton" id="escort_types:zul_to_icemule"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">4</property><property name="top-attach">5</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">--</property>
      </object><packing><property name="left-attach">4</property><property name="top-attach">4</property></packing></child><child><object class="GtkCheckButton" id="escort_types:solhaven_to_icemule"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">4</property><property name="top-attach">3</property>
      </packing></child><child><object class="GtkCheckButton" id="escort_types:landing_to_icemule"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">4</property><property name="top-attach">2</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="label" translatable="yes">Icemule</property>
      </object><packing><property name="left-attach">4</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="escort_types:vaalor_to_zul"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">5</property><property name="top-attach">7</property>
      </packing></child><child><object class="GtkCheckButton" id="escort_types:illy_to_zul"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">5</property><property name="top-attach">6</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">--</property>
      </object><packing><property name="left-attach">5</property><property name="top-attach">5</property></packing></child><child><object class="GtkCheckButton" id="escort_types:icemule_to_zul"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">5</property><property name="top-attach">4</property>
      </packing></child><child><object class="GtkCheckButton" id="escort_types:solhaven_to_zul"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">5</property><property name="top-attach">3</property></packing></child><child><object class="GtkCheckButton" id="escort_types:landing_to_zul"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">5</property><property name="top-attach">2</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="label" translatable="yes">Zul Logoth</property></object><packing><property name="left-attach">5</property><property name="top-attach">1</property></packing></child><child><object class="GtkCheckButton" id="escort_types:vaalor_to_illy"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">6</property><property name="top-attach">7</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">--</property></object><packing><property name="left-attach">6</property><property name="top-attach">6</property></packing></child><child><object class="GtkCheckButton" id="escort_types:zul_to_illy"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">6</property><property name="top-attach">5</property></packing></child><child><object class="GtkCheckButton" id="escort_types:icemule_to_illy"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">6</property><property name="top-attach">4</property>
      </packing></child><child><object class="GtkCheckButton" id="escort_types:solhaven_to_illy"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">6</property><property name="top-attach">3</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="label" translatable="yes">Ta\'llistim</property>
      </object><packing><property name="left-attach">6</property><property name="top-attach">1</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">--</property></object><packing><property name="left-attach">7</property><property name="top-attach">7</property></packing></child><child><object class="GtkCheckButton" id="escort_types:illy_to_vaalor"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">7</property><property name="top-attach">6</property></packing></child><child><object class="GtkCheckButton" id="escort_types:zul_to_vaalor"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">7</property><property name="top-attach">5</property>
      </packing></child><child><object class="GtkCheckButton" id="escort_types:icemule_to_vaalor"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">7</property><property name="top-attach">4</property></packing></child><child><object class="GtkCheckButton" id="escort_types:solhaven_to_vaalor"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">7</property><property name="top-attach">3</property></packing></child><child><object class="GtkCheckButton" id="escort_types:landing_to_vaalor"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">7</property><property name="top-attach">2</property>
      </packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="label" translatable="yes">Ta\'Vaalor</property></object><packing><property name="left-attach">7</property><property name="top-attach">1</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property></object><packing><property name="left-attach">8</property><property name="top-attach">1</property>
      </packing></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/></child><child><placeholder/>
      </child><child><placeholder/></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Travel Preferances</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">0</property></packing></child><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=2 n-rows=2 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Pre-Escort Commands:</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="escort_prep_commands"><property name="width-request">550</property><property name="visible">True</property><property name="can-focus">True</property><property name="valign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="max-width-chars">40</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Active Escort Scripts:</property></object><packing><property name="left-attach">0</property><property name="top-attach">1</property>
      </packing></child><child><object class="GtkEntry" id="escort_prep_scripts"><property name="visible">True</property><property name="can-focus">True</property><property name="valign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="max-width-chars">40</property></object><packing><property name="left-attach">1</property><property name="top-attach">1</property>
      </packing></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Pre-Escort</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">1</property></packing></child><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=2 n-rows=2 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Post-Escort Commands:</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="escort_post_commands"><property name="width-request">550</property><property name="visible">True</property><property name="can-focus">True</property><property name="valign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="max-width-chars">40</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">end</property><property name="margin-start">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Post-Escort Scripts:</property></object><packing><property name="left-attach">0</property><property name="top-attach">1</property>
      </packing></child><child><object class="GtkEntry" id="escort_post_scripts"><property name="visible">True</property><property name="can-focus">True</property><property name="valign">start</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">10</property><property name="margin-bottom">10</property><property name="max-width-chars">40</property></object><packing><property name="left-attach">1</property><property name="top-attach">1</property>
      </packing></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Post-Escort</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">2</property></packing></child></object></child></object></child></object><packing><property name="position">5</property></packing></child><child type="tab"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Escort</property>
      </object><packing><property name="position">5</property><property name="tab-fill">False</property></packing></child><child><object class="GtkScrolledWindow"><property name="visible">True</property><property name="can-focus">True</property><property name="shadow-type">in</property><child><object class="GtkViewport"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkBox"><property name="visible">True</property><property name="can-focus">False</property><property name="orientation">vertical</property><child><!-- n-columns=2 n-rows=2 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=3 n-rows=2 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="row-spacing">2</property><property name="column-spacing">5</property><child><object class="GtkButton" id="creature_exclude_add"><property name="label" translatable="yes">Add</property><property name="width-request">80</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkButton" id="creature_exclude_delete"><property name="label" translatable="yes">Delete</property><property name="width-request">80</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-bottom">5</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="creature_exclude_entry"><property name="width-request">218</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-bottom">5</property><property name="hexpand">True</property><property name="placeholder-text" translatable="yes">Creatures you don\'t want bounties for</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkScrolledWindow"><property name="height-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="hexpand">True</property><property name="border-width">5</property><property name="shadow-type">in</property><child><object class="GtkViewport"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkTreeView" id="creature_exclude"><property name="visible">True</property><property name="can-focus">True</property><property name="vexpand">False</property><property name="model">creature_exclude_store</property><property name="headers-visible">False</property><property name="search-column">0</property><property name="fixed-height-mode">True</property><child internal-child="selection"><object class="GtkTreeSelection"/>
      </child><child><object class="GtkTreeViewColumn"><property name="sizing">fixed</property><property name="title" translatable="yes">Exclusion</property><child><object class="GtkCellRendererText"/><attributes><attribute name="text">0</attribute></attributes></child></object></child></object></child></object></child></object><packing><property name="left-attach">0</property><property name="top-attach">1</property><property name="width">3</property></packing></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="tooltip-text" translatable="yes">Exclusions should be entered one line at a time. Regular expressions are supported.

                  </property><property name="label" translatable="yes">Creature Exclusions (?)</property>
      </object></child></object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=3 n-rows=2 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="row-spacing">2</property><property name="column-spacing">5</property><child><object class="GtkButton" id="herb_exclude_add"><property name="label" translatable="yes">Add</property><property name="width-request">80</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkButton" id="herb_exclude_delete"><property name="label" translatable="yes">Delete</property><property name="width-request">80</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-bottom">5</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="herb_exclude_entry"><property name="width-request">218</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-bottom">5</property><property name="hexpand">True</property><property name="placeholder-text" translatable="yes">Herbs you don\'t want bounties for</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkScrolledWindow"><property name="height-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="hexpand">True</property><property name="border-width">5</property><property name="shadow-type">in</property><child><object class="GtkViewport"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkTreeView" id="herb_exclude"><property name="visible">True</property><property name="can-focus">True</property><property name="vexpand">False</property><property name="model">herb_exclude_store</property><property name="headers-visible">False</property><property name="search-column">0</property><property name="fixed-height-mode">True</property><child internal-child="selection"><object class="GtkTreeSelection"/>
      </child><child><object class="GtkTreeViewColumn"><property name="sizing">fixed</property><property name="title" translatable="yes">Exclusion</property><child><object class="GtkCellRendererText"/><attributes><attribute name="text">0</attribute></attributes></child></object></child></object></child></object></child></object><packing><property name="left-attach">0</property><property name="top-attach">1</property><property name="width">3</property></packing></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="tooltip-text" translatable="yes">Exclusions should be entered one line at a time. Regular expressions are supported.

                  </property><property name="label" translatable="yes">Herb Exclusions (?)</property>
      </object></child></object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=3 n-rows=2 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="row-spacing">2</property><property name="column-spacing">5</property><child><object class="GtkButton" id="gem_exclude_add"><property name="label" translatable="yes">Add</property><property name="width-request">80</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkButton" id="gem_exclude_delete"><property name="label" translatable="yes">Delete</property><property name="width-request">80</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-bottom">5</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="gem_exclude_entry"><property name="width-request">218</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-bottom">5</property><property name="hexpand">True</property><property name="placeholder-text" translatable="yes">Gems you don\'t want bounties for</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkScrolledWindow"><property name="height-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="hexpand">True</property><property name="border-width">5</property><property name="shadow-type">in</property><child><object class="GtkViewport"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkTreeView" id="gem_exclude"><property name="visible">True</property><property name="can-focus">True</property><property name="vexpand">False</property><property name="model">gem_exclude_store</property><property name="headers-visible">False</property><property name="search-column">0</property><property name="fixed-height-mode">True</property><child internal-child="selection"><object class="GtkTreeSelection"/>
      </child><child><object class="GtkTreeViewColumn"><property name="sizing">fixed</property><property name="title" translatable="yes">Exclusion</property><child><object class="GtkCellRendererText"/><attributes><attribute name="text">0</attribute></attributes></child></object></child></object></child></object></child></object><packing><property name="left-attach">0</property><property name="top-attach">1</property><property name="width">3</property></packing></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="tooltip-text" translatable="yes">Exclusions should be entered one line at a time. Regular expressions are supported.

                  </property><property name="label" translatable="yes">Gem Exclusions (?)</property>
      </object></child></object><packing><property name="left-attach">0</property><property name="top-attach">1</property></packing></child><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=3 n-rows=2 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="row-spacing">2</property><property name="column-spacing">5</property><child><object class="GtkButton" id="location_exclude_add"><property name="label" translatable="yes">Add</property><property name="width-request">80</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">start</property><property name="margin-start">5</property><property name="margin-bottom">5</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkButton" id="location_exclude_delete"><property name="label" translatable="yes">Delete</property><property name="width-request">80</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">end</property><property name="margin-end">5</property><property name="margin-bottom">5</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="location_exclude_entry"><property name="width-request">218</property><property name="visible">True</property><property name="can-focus">True</property><property name="halign">start</property><property name="margin-bottom">5</property><property name="hexpand">True</property><property name="placeholder-text" translatable="yes">Locations you don\'t want bounties</property>
      </object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkScrolledWindow"><property name="height-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="hexpand">True</property><property name="border-width">5</property><property name="shadow-type">in</property><child><object class="GtkViewport"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkTreeView" id="location_exclude"><property name="visible">True</property><property name="can-focus">True</property><property name="vexpand">False</property><property name="model">location_exclude_store</property><property name="headers-visible">False</property><property name="search-column">0</property><property name="fixed-height-mode">True</property><child internal-child="selection"><object class="GtkTreeSelection"/>
      </child><child><object class="GtkTreeViewColumn"><property name="sizing">fixed</property><property name="title" translatable="yes">Exclusion</property><child><object class="GtkCellRendererText"/><attributes><attribute name="text">0</attribute></attributes></child></object></child></object></child></object></child></object><packing><property name="left-attach">0</property><property name="top-attach">1</property><property name="width">3</property></packing></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="tooltip-text" translatable="yes">Exclusions should be entered one line at a time. Regular expressions are supported.

                  </property><property name="label" translatable="yes">Location Exclusions (?)</property>
      </object></child></object><packing><property name="left-attach">1</property><property name="top-attach">1</property></packing></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">1</property></packing></child></object></child></object></child></object><packing><property name="position">6</property></packing></child><child type="tab"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Exclusions</property>
      </object><packing><property name="position">6</property><property name="tab-fill">False</property></packing></child><child><object class="GtkScrolledWindow"><property name="visible">True</property><property name="can-focus">True</property><property name="shadow-type">in</property><child><object class="GtkViewport"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkBox"><property name="visible">True</property><property name="can-focus">False</property><property name="orientation">vertical</property><child><object class="GtkFrame"><property name="visible">True</property><property name="can-focus">False</property><property name="border-width">10</property><property name="label-xalign">0</property><child><!-- n-columns=3 n-rows=25 --><object class="GtkGrid"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkComboBoxText" id="default_profile"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="hexpand">True</property><property name="has-entry">True</property><child internal-child="entry"><object class="GtkEntry" id="default_name"><property name="can-focus">True</property>
      </object></child></object><packing><property name="left-attach">1</property><property name="top-attach">2</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="margin-end">10</property><property name="margin-bottom">5</property><property name="label" translatable="yes">Gem/Default  Profile</property></object><packing><property name="left-attach">0</property><property name="top-attach">2</property>
      </packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">1</property><property name="width">3</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="tooltip-text" translatable="yes">Names should be seperated by commas.</property><property name="margin-top">5</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Creature Names (?)</property><property name="use-markup">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">0</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-top">5</property><property name="margin-bottom">10</property><property name="label" translatable="yes">Associated Profile</property></object><packing><property name="left-attach">1</property><property name="top-attach">0</property></packing></child><child><object class="GtkEntry" id="names_a"><property name="width-request">250</property><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">6</property></packing></child><child><object class="GtkComboBoxText" id="profile_a"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="has-entry">True</property><child internal-child="entry"><object class="GtkEntry" id="profile_name_a"><property name="can-focus">True</property>
      </object></child></object><packing><property name="left-attach">1</property><property name="top-attach">6</property></packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">3</property><property name="width">3</property></packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">7</property><property name="width">3</property></packing></child><child><object class="GtkComboBoxText" id="profile_b"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="has-entry">True</property><child internal-child="entry"><object class="GtkEntry" id="profile_name_b"><property name="can-focus">True</property>
      </object></child></object><packing><property name="left-attach">1</property><property name="top-attach">8</property></packing></child><child><object class="GtkEntry" id="names_b"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">0</property><property name="top-attach">8</property>
      </packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">9</property><property name="width">3</property></packing></child><child><object class="GtkComboBoxText" id="profile_c"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="has-entry">True</property><child internal-child="entry"><object class="GtkEntry" id="profile_name_c"><property name="can-focus">True</property>
      </object></child></object><packing><property name="left-attach">1</property><property name="top-attach">10</property></packing></child><child><object class="GtkEntry" id="names_c"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">0</property><property name="top-attach">10</property>
      </packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">11</property><property name="width">3</property></packing></child><child><object class="GtkComboBoxText" id="profile_d"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="has-entry">True</property><child internal-child="entry"><object class="GtkEntry" id="profile_name_d"><property name="can-focus">True</property>
      </object></child></object><packing><property name="left-attach">1</property><property name="top-attach">12</property></packing></child><child><object class="GtkEntry" id="names_d"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">0</property><property name="top-attach">12</property>
      </packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">13</property><property name="width">3</property></packing></child><child><object class="GtkComboBoxText" id="profile_e"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="has-entry">True</property><child internal-child="entry"><object class="GtkEntry" id="profile_name_e"><property name="can-focus">True</property>
      </object></child></object><packing><property name="left-attach">1</property><property name="top-attach">14</property></packing></child><child><object class="GtkEntry" id="names_e"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">0</property><property name="top-attach">14</property>
      </packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">15</property><property name="width">3</property></packing></child><child><object class="GtkComboBoxText" id="profile_f"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="has-entry">True</property><child internal-child="entry"><object class="GtkEntry" id="profile_name_f"><property name="can-focus">True</property>
      </object></child></object><packing><property name="left-attach">1</property><property name="top-attach">16</property></packing></child><child><object class="GtkEntry" id="names_f"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">0</property><property name="top-attach">16</property>
      </packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">17</property><property name="width">3</property></packing></child><child><object class="GtkComboBoxText" id="profile_g"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="has-entry">True</property><child internal-child="entry"><object class="GtkEntry" id="profile_name_g"><property name="can-focus">True</property>
      </object></child></object><packing><property name="left-attach">1</property><property name="top-attach">18</property></packing></child><child><object class="GtkEntry" id="names_g"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">0</property><property name="top-attach">18</property>
      </packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">19</property><property name="width">3</property></packing></child><child><object class="GtkComboBoxText" id="profile_h"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="has-entry">True</property><child internal-child="entry"><object class="GtkEntry" id="profile_name_h"><property name="can-focus">True</property>
      </object></child></object><packing><property name="left-attach">1</property><property name="top-attach">20</property></packing></child><child><object class="GtkEntry" id="names_h"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">0</property><property name="top-attach">20</property>
      </packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">21</property><property name="width">3</property></packing></child><child><object class="GtkComboBoxText" id="profile_i"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="has-entry">True</property><child internal-child="entry"><object class="GtkEntry" id="profile_name_i"><property name="can-focus">True</property>
      </object></child></object><packing><property name="left-attach">1</property><property name="top-attach">22</property></packing></child><child><object class="GtkEntry" id="names_i"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">0</property><property name="top-attach">22</property>
      </packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">23</property><property name="width">3</property></packing></child><child><object class="GtkComboBoxText" id="profile_j"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="has-entry">True</property><child internal-child="entry"><object class="GtkEntry" id="profile_name_j"><property name="can-focus">True</property>
      </object></child></object><packing><property name="left-attach">1</property><property name="top-attach">24</property></packing></child><child><object class="GtkEntry" id="names_j"><property name="visible">True</property><property name="can-focus">True</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="xalign">0.5</property></object><packing><property name="left-attach">0</property><property name="top-attach">24</property>
      </packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="valign">center</property><property name="margin-end">5</property><property name="label" translatable="yes">Only Kill Bounty
                        Creatures
                  </property></object><packing><property name="left-attach">2</property><property name="top-attach">0</property></packing></child><child><object class="GtkCheckButton" id="kill_a"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="valign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">6</property></packing></child><child><object class="GtkCheckButton" id="kill_b"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="valign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">2</property><property name="top-attach">8</property>
      </packing></child><child><object class="GtkCheckButton" id="kill_c"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="valign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">2</property><property name="top-attach">10</property></packing></child><child><object class="GtkCheckButton" id="kill_d"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="valign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">12</property></packing></child><child><object class="GtkCheckButton" id="kill_e"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="valign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">2</property><property name="top-attach">14</property>
      </packing></child><child><object class="GtkCheckButton" id="kill_f"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="valign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">2</property><property name="top-attach">16</property></packing></child><child><object class="GtkCheckButton" id="kill_g"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="valign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">18</property></packing></child><child><object class="GtkCheckButton" id="kill_h"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="valign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">2</property><property name="top-attach">20</property>
      </packing></child><child><object class="GtkCheckButton" id="kill_i"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="valign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">2</property><property name="top-attach">22</property></packing></child><child><object class="GtkCheckButton" id="kill_j"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="valign">center</property><property name="draw-indicator">True</property>
      </object><packing><property name="left-attach">2</property><property name="top-attach">24</property></packing></child><child><object class="GtkSeparator"><property name="visible">True</property><property name="can-focus">False</property><property name="hexpand">True</property></object><packing><property name="left-attach">0</property><property name="top-attach">5</property><property name="width">3</property></packing></child><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="halign">center</property><property name="margin-end">10</property><property name="margin-bottom">5</property><property name="label" translatable="yes">Bandits Profile</property>
      </object><packing><property name="left-attach">0</property><property name="top-attach">4</property></packing></child><child><object class="GtkComboBoxText" id="bandits_profile"><property name="visible">True</property><property name="can-focus">False</property><property name="valign">center</property><property name="margin-start">10</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="hexpand">True</property><property name="has-entry">True</property><child internal-child="entry"><object class="GtkEntry" id="profile_name_bandits"><property name="can-focus">True</property>
      </object></child></object><packing><property name="left-attach">1</property><property name="top-attach">4</property></packing></child><child><object class="GtkCheckButton" id="kill_bandits"><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">False</property><property name="halign">center</property><property name="valign">center</property><property name="draw-indicator">True</property></object><packing><property name="left-attach">2</property><property name="top-attach">4</property>
      </packing></child><child><placeholder/></child></object></child><child type="label"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Profiles</property></object></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">0</property></packing></child></object></child></object></child></object><packing><property name="position">7</property>
      </packing></child><child type="tab"><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="label" translatable="yes">Profiles</property></object><packing><property name="position">7</property><property name="tab-fill">False</property></packing></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">0</property></packing></child><child><object class="GtkBox"><property name="visible">True</property><property name="can-focus">False</property><child><object class="GtkLabel"><property name="visible">True</property><property name="can-focus">False</property><property name="margin-start">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="label" translatable="yes">Your changes are saved automatically.</property><attributes><attribute name="style" value="italic"/>
      </attributes></object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">0</property></packing></child><child><object class="GtkButton"><property name="label" translatable="yes">Close</property><property name="width-request">80</property><property name="visible">True</property><property name="can-focus">True</property><property name="receives-default">True</property><property name="halign">end</property><property name="margin-end">10</property><property name="margin-top">5</property><property name="margin-bottom">5</property><property name="hexpand">True</property><signal name="clicked" handler="on_close_clicked" swapped="no"/>
      </object><packing><property name="expand">False</property><property name="fill">True</property><property name="position">1</property></packing></child></object><packing><property name="expand">False</property><property name="fill">True</property><property name="pack-type">end</property><property name="position">2</property></packing></child></object></child></object></interface>'
    end

    # This is connected to automatically during load_settings and syncs data back to CharSettings.
    def on_update(obj)
      Gtk.queue do
        key = obj.builder_name.to_sym
        setting = Setup.get_setting(key)
        return if setting.nil?

        if obj.class == Gtk::CheckButton
          if obj.active?
            toggles = {
              :exp_pause    => [:keep_hunting],
              :keep_hunting => [:exp_pause],
              :bigshot_rest => [:custom_rest, :rest_random, :table_rest, :use_script],
              :custom_rest  => [:bigshot_rest, :rest_random, :table_rest, :use_script],
              :rest_random  => [:bigshot_rest, :custom_rest, :table_rest, :use_script],
              :table_rest   => [:bigshot_rest, :custom_rest, :rest_random, :use_script],
              :use_script   => [:bigshot_rest, :custom_rest, :rest_random, :table_rest]
            }

            toggles[key]&.each do |other_key|
              instance_variable_get("@#{other_key}").active = false
              @settings[other_key] = false
            end
          end

          @settings[key] = obj.active?
        elsif obj.class == Gtk::Entry
          @settings[key] = obj.text.strip
        elsif obj.class == Gtk::SpinButton
          # update from text entry
          obj.update

          @settings[key] = obj.adjustment.value
        elsif obj.class == Gtk::ComboBoxText
          @settings[key] = obj.active_text
        end
      end
    end

    def on_close_clicked
      EBounty.save_profile()
      self['main'].destroy
    end

    def on_destroy
      Gtk.queue { @running = false }
    end

    def on_drop_load(profile_name)
      dir = "#{$data_dir}#{XMLData.game}/#{Char.name}/bigshot_profiles"

      self[profile_name].remove_all
      self[profile_name].append_text('')

      names = Dir.children(dir).sort
      names.each { |filename|
        next unless filename =~ /.yaml/
        self[profile_name].append_text("#{filename.sub(".yaml", "")}")
      }
    end

    # iterate all objects and for any that match a setting name directly we set the default
    def load_settings
      Gtk.queue do
        # load up the generic settings which are just matching by name of the widget
        objects.each do |obj|
          next unless obj.methods.include?(:builder_name)

          key = obj.builder_name.to_sym
          next if (setting = Setup.get_setting(key)).nil?

          # set the default value
          if obj.class == Gtk::CheckButton
            instance_variable_set("@#{key}", obj) if %i[
              exp_pause
              keep_hunting
              bigshot_rest
              custom_rest
              rest_random
              table_rest
              use_script
            ].include?(key)

            obj.active = @settings[key]
            obj.signal_connect('toggled') { on_update(obj) }
          elsif obj.class == Gtk::Entry
            obj.text = @settings[key].strip

            profile_map = {
              "default_name"         => :default_profile,
              "profile_name_bandits" => :bandits_profile,
              "profile_name_a"       => :profile_a,
              "profile_name_b"       => :profile_b,
              "profile_name_c"       => :profile_c,
              "profile_name_d"       => :profile_d,
              "profile_name_e"       => :profile_e,
              "profile_name_f"       => :profile_f,
              "profile_name_g"       => :profile_g,
              "profile_name_h"       => :profile_h,
              "profile_name_i"       => :profile_i,
              "profile_name_j"       => :profile_j
            }

            key = profile_map[obj.builder_name.to_s]
            obj.text = @settings[key] if key

            obj.signal_connect('changed') { on_update(obj) }
          elsif obj.class == Gtk::SpinButton
            obj.value = @settings[key]
            obj.adjustment.value = @settings[key]
            obj.signal_connect('changed') { on_update(obj) }
          elsif obj.class == Gtk::ComboBoxText
            on_drop_load(obj.builder_name.to_s)
            obj.signal_connect('changed') { on_update(obj) }
          elsif obj.class == Gtk::TreeView
            if (store = self["#{key}_store"]).nil?
              respond "** failed to find store for treeview #{key}"
              next
            elsif setting[:load].nil?
              respond "** no :load defined #{key}"
              next
            end

            setting[:load].call(store, @settings[key])

            # setup the signals
            if (add = self["#{key}_add"]).nil?
              respond "** failed to find add for treeview #{key}"
              next
            elsif (delete = self["#{key}_delete"]).nil?
              respond "** failed to find delete for treeview #{key}"
              next
            elsif (entry = self["#{key}_entry"]).nil?
              respond "** failed to find entry for treeview #{key}"
              next
            end

            add.signal_connect('clicked') do
              if setting[:set].nil?
                respond "** no :set defined for #{key}"
                next
              elsif entry.text.empty?
                next
              end
              setting[:set].call(store, entry.text, @settings[key])
              setting[:load].call(store, @settings[key])
            end

            delete.signal_connect('clicked') do
              if setting[:delete].nil?
                respond "** no :delete defined for #{key}"
                next
              elsif (selected = obj.selection.selected).nil?
                next
              end
              setting[:delete].call(store, selected, @settings[key])
              setting[:load].call(store, @settings[key])
            end
          end
        end

        # checkboxes for array storage with id's <setting>:<value>
        # this is primarily used by the loot types
        objects.each do |obj|
          next unless obj.methods.include?(:builder_name)
          next unless obj.builder_name =~ /^([^:]+):(.*)$/i
          next unless obj.class == Gtk::CheckButton

          key = Regexp.last_match(1).to_sym
          value = Regexp.last_match(2).to_s
          next if Setup.get_setting(key).nil?

          # disable unless spell is known
          conditions = {
            "forage_options:use_506"      => Spell[506].known?,
            "forage_options:use_gambit"   => Stats.prof =~ /rogue/i,
            "forage_options:use_resolve"  => Spell[9704].known?,
            "forage_options:use_604"      => Spell[604].known?,
            "forage_options:use_604evoke" => Spell[604].known? && Skills.slblessings > 15,
            "forage_options:use_608"      => Spell[608].known?,
            "forage_options:use_619"      => Spell[619].known?,
            "forage_options:use_650"      => Spell[650].known?,
            "forage_options:use_213"      => Spell[213].known?,
            "forage_options:use_1011"     => Spell[1011].known?,
            "forage_options:use_709"      => Spell[709].known?,
            "forage_options:use_919"      => Spell[919].known?,
            "forage_options:use_140"      => Spell[140].known?,
            "forage_options:use_1035"     => Spell[1035].known?,
            "heirloom_options:use_709"    => Spell[709].known?,
            "heirloom_options:use_140"    => Spell[140].known?,
            "heirloom_options:use_402"    => Spell[402].known?,
            "heirloom_options:use_506"    => Spell[506].known?,
            "heirloom_options:use_919"    => Spell[919].known?,
            "heirloom_options:use_213"    => Spell[213].known?,
            "heirloom_options:use_619"    => Spell[619].known?,
            "heirloom_options:use_1011"   => Spell[1011].known?,
            "heirloom_options:use_1035"   => Spell[1035].known?
          }

          if conditions.key?(obj.builder_name.to_s)
            obj.set_sensitive(false) unless conditions[obj.builder_name.to_s]
          end

          obj.active = @settings[key].include?(value)
          # add in hook
          obj.signal_connect('toggled') do
            @settings[key].delete(value)
            if obj.active?
              @settings[key].push(value)
              @settings[key].uniq!.sort!
            end
          end
        end
      end
    end

    def start
      @running = true
      Gtk.queue { self['main'].show_all }
      wait_while { @running }
    end

    def list(cat_to_list: 'all')
      indent_size = 2
      print_array =
        proc do |key, value, indent|
          _respond("#{' ' * indent_size * indent.to_i}#{key}:")
          value.sort!.each { |entry| _respond("#{' ' * indent_size * (indent.to_i + 1)}#{value.index(entry) + 1}. #{entry}") }
        end

      print_value = proc { |key, value, indent| _respond("#{' ' * indent_size * indent.to_i}#{key}: #{value}") }

      categories = cat_to_list == 'all' ? %w[general] : [cat_to_list]
      if $frontend == 'stormfront'
        output = "<output class=\"mono\"/>\n"
      else
        output = String.new
      end
      categories.each do |opt|
        _respond("#{output}") if !output.empty?
        _respond("#{monsterbold_start}= #{opt.capitalize} =#{monsterbold_end}\n")
        @@categories[opt.to_sym].each do |id, _|
          value = @settings[id]
          value.class == Array ? print_array.call(id, value, 1) : print_value.call(id, value, 1)
        end
      end
      if $frontend == 'stormfront'
        output = "<output class=\"\"/>\n"
        _respond("#{output}")
      end
    end

    def self.update_setting(key, value)
      setting = Setup.get_setting(key)
      EBounty.msg("error", "** Setting \"#{key}\" does not exist") if setting.nil?

      action = nil

      if value.is_a?(String) && value =~ /^([+-])(.*)$/
        action = Regexp.last_match(1)
        value = Regexp.last_match(2).strip.downcase
      end

      if value == 'reset'
        @settings.delete(key)
        EBounty.msg("info", " Reset #{key}")
      elsif @settings[key].class == Array
        if value =~ /\d/ && @settings[key][value.to_i]
          @settings[key].delete_at(value.to_i)
        else
          @settings[key].delete(value)
        end

        if action == '-'
          EBounty.msg("info", " \"#{value}\" removed from \"#{key}\"")
        else
          @settings[key].push(value)
          EBounty.msg("info", " \"#{value}\" added to \"#{key}\"")
        end

        EBounty.msg("info", " \"#{key}\" is now \"#{@settings[key].join(', ')}\"")
      else
        if @settings[key].class == FalseClass || @settings[key].class == TrueClass
          value = value =~ /^true|1|yes|on/ ? true : false
        elsif @settings[key].class == Integer
          value = value.to_i
        end

        EBounty.msg("info", " \"#{key}\" has been set to \"#{value}\"")
        @settings[key] = value
      end
    end
  end

  class Parser
    LOCATION_REGEX ||= /(?:on|in|near) (?:the\s+)?(?<area>[^.]+?)(?:\s+(?:near|between|under) (?<town>[^.]+))?/
    GUARD_REGEX ||= Regexp.union(
      /one of the guardsmen just inside the (?<town>Ta'Illistim) City Gate/,
      /one of the guardsmen just inside the Sapphire Gate/,
      /one of the guardsmen just inside the gate/,
      /one of the (?<town>.*) (?:gate|tunnel) guards/,
      /one of the (?<town>Icemule Trace) gate guards or the halfing Belle at the Pinefar Trading Post/,
      /Quin Telaren of (?<town>Wehnimer's Landing)/,
      /the dwarven militia sergeant near the (?<town>Kharam-Dzu) town gates/,
      /the sentry just outside town/,
      /the sentry just outside (?<town>Kraken's Fall)/,
      /the purser of (?<town>River's Rest)/,
      /the tavernkeeper at Rawknuckle's Common House/,
    )

    TASK_MATCHERS ||= {
      :none                => /^You are not currently assigned a task/,
      :bandit_assignment   => /Hmm, I've got a task here from the (?:outpost|town) of (?<town>[^.]+?).  It appears they have a bandit problem they'd like you to solve/,
      :creature_assignment => /Hmm, I've got a task here from the (?:outpost|town) of (?<town>[^.]+?).  It appears they have a creature problem they'd like you to solve/,
      :gem_assignment      => /Hmm, I've got a task here from the (?:outpost|town) of (?<town>[^.]+?).  The local gem dealer, [^,]+, has an order to fill and wants our help/,
      :heirloom_assignment => /Hmm, I've got a task here from the (?:outpost|town) of (?<town>[^.]+?).  It appears they need your help in tracking down some kind of lost heirloom/,
      :herb_assignment     => /Hmm, I've got a task here from the (?:outpost|town) of (?<town>[^.]+?).  The local [^,]+?, [^,]+, has asked for our aid.  Head over there and see what you can do.  Be sure to ASK about BOUNTIES./,
      :rescue_assignment   => /Hmm, I've got a task here from the (?:outpost|town) of (?<town>[^.]+?).  It appears that a local resident urgently needs our help in some matter/,
      :skin_assignment     => /Hmm, I've got a task here from the (?:outpost|town) of (?<town>[^.]+?).  The local furrier .+ has an order to fill and wants our help/,
      :taskmaster          => /^You have succeeded in your task and can return to the Adventurer's Guild/,
      :heirloom_found      => /^You have located (?:an?|some) (?<item>.+) and should bring it back to #{GUARD_REGEX}\.$/,
      :guard               => /^You succeeded in your task and should report back to #{GUARD_REGEX}\.$/,
      :dangerous_spawned   => /^You have been tasked to hunt down and kill a particularly dangerous (?<creature>[^.]+) that has established a territory #{LOCATION_REGEX}\.  You have provoked (?:his|her|its) attention and now you must(?: return to where you left (?:him|her|it) and)? kill (?:him|her|it)!$/,
      :rescue_spawned      => /^You have made contact with the child you are to rescue and you must get (?:him|her) back alive to #{GUARD_REGEX}\.$/,
      :bandit              => /^You have been tasked to(?: help \w+)? suppress (?<creature>bandit) activity #{LOCATION_REGEX}\.  You need to kill (?<number>\d+) (?:more\s+)?of them to complete your task\.$/,
      :dangerous           => /^You have been tasked to hunt down and kill a (?:particularly )?dangerous (?<creature>[^.]+) that has established a territory #{LOCATION_REGEX}\.  You can get its attention by killing other creatures of the same type in its territory\.$/,
      :escort              => /^(?:The taskmaster told you:  ")?I've got a special mission for you\.  A certain client has hired us to provide a protective escort on (?:his|her) upcoming journey\.  Go to (?<start>[^.]+) and WAIT for (?:him|her) to meet you there\.  You must guarantee (?:his|her) safety to (?<destination>[^.]+) as soon as you can, being ready for any dangers that the two of you may face\.  Good luck!"?$/,
      :gem                 => /^The gem dealer in (?<town>[^,]+), [^,]+, has received orders from multiple customers requesting (?:an?|some) (?<gem>[^.]+)\.  You have been tasked to retrieve (?<number>\d+) (?:more\s+)?of them\.  You can SELL them to the gem dealer as you find them\.$/,
      :heirloom            => /^You have been tasked to recover (?:an?|some) (?<item>[^.]+) that an unfortunate citizen lost after being attacked by an? (?<creature>[^.]+?) #{LOCATION_REGEX}\.  The heirloom can be identified by the initials \w+ engraved upon it\.  [^.]*?(?<action>LOOT|SEARCH)[^.]+\.$/,
      :herb                => /^The .+? in (?<town>[^,]+?), [^,]+?, is working on a concoction that requires (?:an?|some|several) (?<herb>[^.]+?) found (?:near|[oi]n) (?:the\s+)?(?<area>[^.]+?)(?:\s+(?:near|under|between) [^.]+)?\.  These samples must be in pristine condition\.  You have been tasked to retrieve (?<number>\d+) (?:more\s+)?samples?\.$/,
      :rescue              => /^You have been tasked to rescue the young (?:runaway|kidnapped) (?:son|daughter) of a local citizen\.  A local divinist has had visions of the child fleeing from an? (?<creature>[^.]+?) #{LOCATION_REGEX}\.  Find the area where the child was last seen and clear out the creatures that have been tormenting (?:him|her) in order to bring (?:him|her) out of hiding\.$/,
      :skin                => /^You have been tasked to retrieve (?<number>\d+) (?<skin>[^.]+?)s? of at least (?<quality>[^.]+) quality for [^.]+ in (?<town>[^.]+?)\.  You can SKIN them off the corpse of an? (?<creature>[^.]+) or purchase them from another adventurer\./,
      :cull                => Regexp.union(
        /^You have been tasked to(?: help \w+)? suppress (?<creature>[^.]+) activity #{LOCATION_REGEX}\.  You need to kill (?<number>\d+) (?:more\s+)?of them to complete your task\.$/,
        /^You have been tasked to help \w+ rescue a missing child by suppressing (?<creature>[^.]+) activity #{LOCATION_REGEX} during the rescue attempt\.  You need to kill (?<number>\d+) (?:more\s+)?of them to complete your task\.$/,
        /^You have been tasked to help \w+ retrieve an heirloom by suppressing (?<creature>[^.]+) activity #{LOCATION_REGEX} during the retrieval effort\.  You need to kill (?<number>\d+) (?:more\s+)?of them to complete your task\.$/,
        /^You have been tasked to help \w+ kill a dangerous creature by suppressing (?<creature>[^.]+) activity #{LOCATION_REGEX} during the hunt\.  You need to kill (?<number>\d+) (?:more\s+)?of them to complete your task\.$/,
      ),
      :failed              => Regexp.union(
        /^You have failed in your task/,
        /^The child you were tasked to rescue is gone and your task is failed.  Report this failure to the Adventurer's Guild./,
      ),
    }

    def initialize(description)
      @description = description
    end

    attr_reader :description

    def parse
      TASK_MATCHERS.each do |(task_type, regex)|
        if (md = regex.match(description))
          return (
            {
              type: task_type,
            }.merge(
              task_details_from(md.named_captures)
            ).compact
          )
        end
      end
    end

    def task_details_from(captures)
      {
        requirements: {}
      }.tap do |task_details|
        if (town = determine_town(captures["town"]))
          task_details[:town] = town
          task_details[:requirements][:town] = town
        end

        captures.each do |(key, value)|
          task_details[:requirements][key.to_sym] =
            case key
            when "town"
              town
            when "number"
              value.to_i
            when "action"
              value.downcase
            when "creature"
              normalized_creature_name(value)
            else
              value
            end
        end
      end
    end

    def normalized_creature_name(raw_creature_name)
      case raw_creature_name
      when /^\w+ being$/
        'being'
      when /^\w+ magna vereri$/
        'magna vereri'
      else
        raw_creature_name
      end
    end

    def determine_town(captured_town)
      if description =~ /the sentry just outside town\.$/
        "Kraken's Fall"
      elsif description =~ /the tavernkeeper at Rawknuckle's Common House/
        "Cold River"
      else
        captured_town
      end
    end

    def self.parse(desc = XMLData.bounty_task)
      if desc&.empty?
        return
      else
        self.new(desc).parse
      end
    end
  end

  module Hunting
    def self.should_hunt?
      # Stat changes don't register until an info command is done
      if EBounty.data.info_time < Time.now
        EBounty.issue_command("info", /<dialogData id='expr'>/, false)
        EBounty.data.info_time = Time.now + 60
      end

      if percentmana() < UserVars.op['rest_till_mana'].to_i
        EBounty.data.reason = "Mana less than #{UserVars.op['rest_till_mana'].to_i}%"
        return false
      elsif checkspirit() < UserVars.op['rest_till_spirit'].to_i
        EBounty.data.reason = "Spirit less than #{UserVars.op['rest_till_spirit']}"
        return false
      elsif Stats.enhanced_aur[0].to_i < Stats.aur[0].to_i
        EBounty.data.reason = "Recovering from Death"
        return false
      elsif checkbounty =~ /^You are not currently assigned / && Effects::Cooldowns.time_left('Next Bounty') < 3 && !Effects::Cooldowns.time_left('Next Bounty').zero?
        minutes = Effects::Cooldowns.time_left('Next Bounty')
        minutes_part = minutes.to_i
        seconds_part = ((minutes - minutes_part) * 60).to_i

        EBounty.data.reason = "Next bounty available in #{minutes_part} minutes and #{seconds_part} seconds."
        return false
      elsif (percentmind > UserVars.op['rest_till_exp'].to_i) && EBounty.data.settings[:exp_pause]
        EBounty.data.reason = "Mind greater than #{UserVars.op['rest_till_exp'].to_i}%"
        return false
      elsif checkbounty =~ /^You are not currently assigned / && Effects::Cooldowns.time_left('Next Bounty').positive? && !EBounty.data.settings[:keep_hunting] && percentmind > UserVars.op['rest_till_exp'].to_i
        EBounty.data.reason = "Bounty cooldown active"
        return false
      elsif checkmind == 'saturated' && checkbounty =~ /You have succeeded/ && !EBounty.data.settings[:keep_hunting]
        EBounty.data.reason = "Bounty turn-in available but mind still saturated."
        return false
      elsif checkmind == 'saturated' && checkbounty =~ /You have succeeded/ && EBounty.data.settings[:keep_hunting]
        minutes = EBounty.check_exp
        minutes_part = minutes.to_i
        seconds_part = ((minutes - minutes_part) * 60).to_i
        if minutes < 4
          EBounty.data.reason = "Bounty turn-in available in #{minutes_part} minutes and #{seconds_part} seconds."
          sleep minutes * 60
          return false
        end
      end

      return true
    end

    def self.keep_hunting
      EBounty.msg("debug", "Hunting.keep_hunting | called by #{caller[0]}")

      original_bounty = checkbounty
      EBounty.load_default_profile

      loop do
        respond
        EBounty.msg "yellow", " No Profile found for current bounty and keep_hunting is toggled. Please check the Profiles tab."
        respond
        EBounty.msg "yellow", " Current bounty: #{checkbounty}"
        EBounty.data.rest_time = Time.now - 5

        EBounty.go2_rest if !Hunting.should_hunt?

        until Hunting.should_hunt?
          if EBounty.data.rest_time < Time.now
            respond ""
            EBounty.msg("yellow", " Not Hunting: #{EBounty.data.reason}")
            EBounty.msg("yellow", " Total Elapsed Time: #{EBounty.elapsed}")
            respond ""

            EBounty.data.rest_time = Time.now + 60
          end
          sleep 0.5
        end

        Script.run('bigshot', 'single')

        # If the bounty changed (dead child, boss kill etc.) then break out of loop and check Task.bounty_check
        break if original_bounty != checkbounty
      end

      Task.bounty_check
    end

    def self.set_eval
      if EBounty.data.settings[:keep_hunting] || (!EBounty.data.settings[:exp_pause] && checkbounty !~ /^You are not currently assigned /)
        UserVars.op['fried'] = "101"
      end

      EBounty.data.complete_mind = UserVars.op['fried'].to_i > 100 ? 100 : UserVars.op['fried'].to_i

      if EBounty.data.settings[:exp_pause]
        bounty_eval = %Q{!!(checkbounty =~ /^You.*?(succeeded|located|failed )|your task is failed/ && !$bigshot_bandits && @CORRECT_PERCENT_MIND >= UserVars.op['fried'].to_i)} # exp_pause non-bandit bounty complete
      elsif EBounty.data.settings[:keep_hunting]
        bounty_eval = %Q{!!(checkbounty =~ /^You.*?(succeeded|located|failed )|your task is failed/ && checkmind != 'saturated' && !$bigshot_bandits && @CORRECT_PERCENT_MIND >= 100)} # keep_hunting non-bandit bounty complete
      else
        bounty_eval = %Q{!!(checkbounty =~ /^You.*?(succeeded|located|failed )|your task is failed/ && !$bigshot_bandits && @CORRECT_PERCENT_MIND >= 100)} # neither non-bandit bounty complete
      end

      bounty_eval += %Q{ || !!(checkbounty =~ /^You.*?(succeeded|located|failed )|your task is failed/ && $bigshot_bandits)} # bandit bounty complete
      bounty_eval += %Q{ || !!(checkbounty =~ /^You are not currently assigned / && !Effects::Cooldowns.to_h.include?('Next Bounty'))} # bounty available

      if checkbounty =~ /A local divinist has had visions of the child fleeing/
        bounty_eval += %Q{ || !!(checkbounty =~ /^You have made contact with the child/ && GameObj.npcs.any? { |npc| npc.name =~ /\\bchild\\b/ })}
      elsif checkbounty =~ /You have been tasked to retrieve(.*)of at least/
        if checkbounty =~ /You have been tasked to retrieve (\d+) (.*?)(?:s)? of at/
          EBounty.data.remaining_skins = $1
          EBounty.data.bundle_skin = $2
        end
        EBounty.data.bundle_skin = EBounty.data.bundle_skin.match(/(\w+)\s+(\w+)\s*\Z/)

        bounty_eval += %Q{ || !!(count = 0;EBounty.data.containers.each{|i| i.contents.each{ |k| if k.name =~ /bundle of #{EBounty.data.bundle_skin}/ && !EBounty.data.bundle_skin.to_s.empty? && !hidden?; lines = Lich::Util.quiet_command_xml("measure #"+k.id.to_s, /You glance through/);count += lines.sum { |l| l.scan(/count a total of (\d+) <a exist/).flatten.map(&:to_i).sum };end;};};count >= EBounty.data.remaining_skins.to_i && @CORRECT_PERCENT_MIND >= EBounty.data.complete_mind)}
        bounty_eval += %Q{ || !!(j=0;EBounty.data.containers.each{|i| j += i.contents.count{|l| l.name =~ /#{EBounty.data.skin}/i && !EBounty.data.skin.to_s.empty?}.to_i }; j >= EBounty.data.remaining_skins.to_i && @CORRECT_PERCENT_MIND >= EBounty.data.complete_mind)}
      elsif checkbounty =~ /The gem dealer/
        bounty_eval += %Q{ || !!(t=0;EBounty.data.containers.each{|k| t += k.contents.count{|v| v.name =~ /#{EBounty.data.gem.strip}/i && !EBounty.data.gem.to_s.empty?}.to_i}; t>= EBounty.data.remaining_gems.to_i && @CORRECT_PERCENT_MIND >= EBounty.data.complete_mind)}
      end

      UserVars.op['bounty_eval'] = bounty_eval

      sleep 0.2
    end

    def self.pre_hunt(type)
      commands = nil
      scripts = nil

      case type
      when /forage/i
        commands = EBounty.data.settings[:forage_prep_commands]
        scripts = EBounty.data.settings[:forage_prep_scripts]
      when /heirloom/i
        commands = EBounty.data.settings[:heirloom_prep_commands]
        scripts = EBounty.data.settings[:heirloom_prep_scripts]
      when /escort/i
        commands = EBounty.data.settings[:escort_prep_commands]
        scripts = EBounty.data.settings[:escort_prep_scripts]
      else
        commands = UserVars.op['hunting_prep_commands']
        scripts = UserVars.op['hunting_scripts']
      end

      commands.split(",").each { |i|
        if i =~ /^script\s+(.*?)(\s|$)(.*)/i
          name = $1
          args = $3
          if (args == nil || args =~ /^\s*$/)
            start_script name
          else
            args = args.split(/ /)
            start_script name, args
          end
        else
          fput(i)
          sleep(0.3)
        end
      }

      scripts.split(/,\s*/).each do |i|
        tokens = i.split(/\s+/)
        if (tokens.size > 1)
          start_script tokens[0], tokens[1..-1]
        else
          start_script tokens[0]
        end
      end
    end

    def self.post_hunt(type)
      EBounty.msg("debug", "Start of post_hunt: #{type}")
      commands = nil
      kill_scripts = nil
      scripts = nil

      case type
      when /forage/i
        commands = EBounty.data.settings[:forage_post_commands]
        kill_scripts = EBounty.data.settings[:forage_prep_scripts]
        scripts = EBounty.data.settings[:forage_post_scripts]
      when /heirloom/i
        commands = EBounty.data.settings[:heirloom_post_commands]
        kill_scripts = EBounty.data.settings[:heirloom_prep_scripts]
        scripts = EBounty.data.settings[:heirloom_post_scripts]
      when /escort/i
        commands = EBounty.data.settings[:escort_post_commands]
        kill_scripts = EBounty.data.settings[:escort_prep_scripts]
        scripts = EBounty.data.settings[:escort_post_scripts]
      else
        commands = UserVars.op['resting_commands']
        kill_scripts = UserVars.op['hunting_scripts']
        scripts = UserVars.op['resting_scripts']
      end

      unless kill_scripts.to_s.empty?
        kill_scripts.split(/,\s*/).each do |i|
          tokens = i.split(/\s+/)
          kill_script(tokens[0]) if running?(tokens[0])
        end
      end

      unless commands.to_s.empty?
        commands.split(",").each { |i|
          EBounty.msg("debug", "commands: #{i}")
          if i =~ /^script\s+(.*?)(\s|$)(.*)/i
            name = $1
            args = $3
            if (args == nil || args =~ /^\s*$/)
              Script.run(name)
            else
              args = args.split(/ /)
              Script.run(name, args)
            end
          else
            fput(i)
            sleep(0.3)
          end
        }
        EBounty.msg("debug", "End of commands")
      end

      unless scripts.to_s.empty?
        scripts.split(/,\s*/).each do |i|
          EBounty.msg("debug", "scripts: #{i}")
          tokens = i.split(/\s+/)
          if (tokens.size > 1)
            Script.run(tokens[0], tokens[1..-1].join(", "))
          else
            Script.run(tokens[0])
          end
        end
        EBounty.msg("debug", "End of scripts")
      end

      EBounty.msg("debug", "End of post_hunt: #{type}")
    end

    def self.go_hunting
      EBounty.data.rest_time = Time.now

      EBounty.go2_rest if !Hunting.should_hunt?

      until Hunting.should_hunt?
        EBounty.check_health

        if EBounty.data.rest_time < Time.now
          respond
          if EBounty.data.converted != 0
            EBounty.msg("yellow", " Last Hunt: #{EBounty.data.converted}")
          end

          EBounty.msg("yellow", " Not Hunting: #{EBounty.data.reason}")
          EBounty.msg("yellow", " Total Elapsed Time: #{EBounty.elapsed}")
          respond

          EBounty.data.rest_time = Time.now + 60
        end
        sleep 0.5
      end

      return if checkbounty =~ /^You are not currently assigned / && !Effects::Cooldowns.to_h.include?('Next Bounty')
      return if !checkmind('saturated') && checkbounty =~ /You have succeeded/

      original_op = UserVars.op

      unless EBounty.data.creature.nil?
        if EBounty.data.creature == "bandits"
          new_target = "(?:thief|rogue|bandit|mugger|outlaw|highwayman|marauder|brigand|thug|robber)"
          UserVars.op['hunting_room_id'] = UserVars.op['rallypoint_room_ids'] = EBounty.data.location_start
          UserVars.op['hunting_boundaries'] = EBounty.data.location_boundaries
          UserVars.op['wander_wait'] = EBounty.data.settings[:wander_wait]
        else
          new_target = EBounty.data.creature.split.last + UserVars.op['targets'].match(/#{EBounty.data.creature.split.last}(\([a-j]\))/)[1].to_s
        end

        if EBounty.data.settings[:only_required_creatures]
          UserVars.op['targets'] = new_target
        else
          UserVars.op['targets'] += ",#{new_target}" if EBounty.data.creature == "bandits"
        end
      end

      Hunting.set_eval

      # Still here go hunting
      hunt_start = Process.clock_gettime(Process::CLOCK_MONOTONIC)
      Script.run('bigshot', 'bounty')
      hunt_end = Process.clock_gettime(Process::CLOCK_MONOTONIC)
      elapsed = hunt_end - hunt_start
      EBounty.data.converted = Time.at(elapsed).utc.strftime("%H:%M:%S")

      UserVars.op = original_op
    end
  end

  module Task
    def self.bounty_check(repeat: false)
      EBounty.msg("debug", "Task.bounty_check | called by #{caller[0]} | checkbounty: #{checkbounty}")
      EBounty.data.creature = nil

      Task.check_removal

      status = Parser.parse

      if EBounty.data.settings[:basic] && status[:type] !~ /guard|taskmaster|none|assignment|found|escort|failed/
        EBounty.exit_script
        sleep 0.5
      end

      case status[:type]
      when :none
        Effects::Cooldowns.active?("Next Bounty") ? Task.wait_for_bounty : Task.bounty_get
      when :taskmaster
        # Fixme: go2 location first
        Task.bounty_complete
      when :guard, :bandit_assignment, :creature_assignment, :heirloom_assignment, :rescue_assignment, :heirloom_found
        # Fixme: go2 location first
        Task.ask_guard
      when :herb_assignment
        Task.forage_ask
      when :gem_assignment
        Task.gem_ask
      when :skin_assignment
        Task.skin_ask
      when :rescue
        Task.child_bounty(status[:requirements][:creature])
      when :rescue_spawned
        Task.child_found
      when :bandit
        Task.bandit_bounty(status[:requirements][:area])
      when :dangerous, :cull, :dangerous_spawned
        Task.creature_culling(status[:requirements][:creature])
      when :herb
        Task.forage_bounty(status[:requirements][:herb], status[:requirements][:number], status[:requirements][:area])
      when :gem
        Task.gem_bounty(status[:requirements][:gem], status[:requirements][:number])
      when :skin
        Task.skin_bounty(status[:requirements][:creature], status[:requirements][:skin], status[:requirements][:number])
      when :heirloom
        Task.heirloom_bounty(status[:requirements][:item], status[:requirements][:creature], status[:requirements][:area], status[:requirements][:action])
      when :escort
        Task.escort(status[:requirements][:start], status[:requirements][:destination])
      when :failed
        Task.task_failed
      else
        if repeat
          EBounty.msg("warn", "Unknown Result: Unable to match bounty_check.")
          EBounty.msg("warn", "checkbounty: #{checkbounty}")
          EBounty.exit_script
        else
          # in case checkbounty not populated...
          EBounty.get_lines("bounty", /<a exist=".*?your Adventurer's Guild information is as follows/i)
          Task.bounty_check(repeat: true)
        end
      end

      Task.bounty_check
    end

    def self.check_boost
      return false unless EBounty.data.settings[:use_boosts]

      lines = EBounty.get_lines("boost info", /<a exist=".*?" noun=".*?">.*?<\/a>, your Login Rewards information is as follows/)

      if lines.any? { |l| l =~ /<d cmd='boost bounty'>Bounty Boosts<\/d>:\s+([0-9,]+)/ }
        boost = $1.delete(",").to_i
      end

      return true if boost.positive?

      return false
    end

    def self.check_removal
      remove = false
      status = Parser.parse

      EBounty.msg("debug", "check_removal | status: #{status}")

      if EBounty.data.settings[:creature_exclude].length.positive? && status[:requirements][:creature].downcase =~ Regexp.union(EBounty.data.settings[:creature_exclude].map!(&:downcase))
        echo "#{status[:requirements][:creature]} is in the excluded list. Turning in bounty!"
        remove = true
      elsif EBounty.data.settings[:herb_exclude].length.positive? && status[:requirements][:herb].downcase =~ Regexp.union(EBounty.data.settings[:herb_exclude].map!(&:downcase))
        echo "#{status[:requirements][:herb]} is in the excluded list. Turning in bounty!"
        remove = true
      elsif EBounty.data.settings[:gem_exclude].length.positive? && status[:requirements][:gem].downcase =~ Regexp.union(EBounty.data.settings[:gem_exclude].map!(&:downcase))
        unless EBounty.data.settings[:gem_history].to_s.empty?
          EBounty.run_scripts(EBounty.data.settings[:gem_history])
        end
        echo "#{status[:requirements][:gem]} is in the excluded list. Turning in bounty!"
        remove = true
      elsif EBounty.data.settings[:location_exclude].length.positive? && status[:requirements][:area].downcase =~ Regexp.union(EBounty.data.settings[:location_exclude].map!(&:downcase))
        echo "#{status[:requirements][:area]} is in the excluded list. Turning in bounty!"
        remove = true
      elsif EBounty.data.crosswalk[status[:type]] == "kill_creatures" && !EBounty.data.settings[:bounty_types].grep(/culling/).any?
        remove = true
      elsif status[:requirements][:action] == 'search' && status[:type] == :heirloom && !EBounty.data.settings[:bounty_types].include?("heirloom_search")
        remove = true
      elsif status[:requirements][:action] == 'loot' && status[:type] == :heirloom && !EBounty.data.settings[:bounty_types].include?("heirloom_loot")
        remove = true
      elsif EBounty.data.reject_bounties.grep(EBounty.data.crosswalk[status[:type]]).any?
        remove = true
      end

      if remove
        if status[:type] == :gem_assignment && !EBounty.data.settings[:gem_history].to_s.empty?
          Task.gem_ask
        end
        Task.bounty_remove
        if EBounty.data.settings[:once_and_done] && Effects::Cooldowns.active?("Next Bounty")
          EBounty.go2_rest
          EBounty.exit_script
        end
      end
    end

    def self.guard_list
      town = Room[EBounty.data.bounty_towns_uid[Parser.parse[:town]]]
      places = Room.list.find_all { |r| r.tags.any? { |tag| tag =~ /advguard/ } && !r.tags.to_s.empty? && Room[r.find_nearest_by_tag("town")] == town && !town.path_to(r).nil? }.map(&:id)

      EBounty.msg("debug", "town: #{town} | guard_list places: #{places}")

      return places
    end

    def self.ask_guard
      EBounty.msg("debug", "ask_guard")
      location_list = Task.guard_list
      original_checkbounty = checkbounty
      guards = []
      need_fill_hands = false

      location_list.each { |room|
        # Hinterwilds Tavernkeeper moves so using alchemist instead
        if Room[room].uid.first.to_s =~ /7503252|7503251/
          room = 'u7503253'
        end

        EBounty.go2(room)

        if Room.current.location =~ /the town of River's Rest/
          guards.push("purser")
        else
          guards = GameObj.npcs.find_all { |npc| npc.name =~ /(?:guard|sergeant|guardsman|sentry|tavernkeeper|alchemist)/i }
        end

        if Room.current.uid.to_s =~ /7503252|7503251/ && guards.to_s.empty?
          loop do
            move checkpaths[0]
            guards = GameObj.npcs.find_all { |npc| npc.name =~ /(?:guard|sergeant|guardsman|sentry|tavernkeeper)/i }
            break unless guards.to_s.empty?

            echo "Looking for the lousy tavernkeeper"
            sleep 10
          end
        end

        next unless guards.length.positive?

        if checkbounty =~ /You have located (?:a |an )?(.*?) and should bring it back/i
          requested_item = $1
          found_item = nil
          EBounty.data.containers.each { |container|
            EBounty.open_container(container)
            container.contents.each { |item|
              if item.name =~ /#{requested_item}/
                found_item = item
                break
              end
            }
            break if found_item
          }

          if found_item
            empty_hands
            need_fill_hands = true
            fput "get ##{found_item.id}"
          elsif EBounty.data.settings[:remove_heirloom]
            Task.bounty_remove
            return false
          elsif EBounty.data.settings[:keep_hunting]
            EBounty.go2_rest
            Hunting.keep_hunting
          else
            EBounty.go2_rest
            EBounty.exit_script
          end
        end

        got_response = false
        guards.each { |guard|
          result = dothistimeout "ask #{guard} about bounty", 3, EBounty.data.guard_regex
          unless result =~ /I don't have any tasks for you right now|Try bugging me later|Who are you trying to ask\?/
            got_response = true
            break
          end
        }

        break if got_response
        fput "stow right" if checkright
      }

      fill_hands if need_fill_hands

      EBounty.bounty_change(original_checkbounty)
    end

    def self.find_location(location)
      boundary_list = []
      location_list = []

      Room.list.find_all { |r|
        if !r.location.to_s.empty? && (location.to_s =~ /#{r.location}/i || r.location.to_s =~ /#{location}/i) && !EBounty.data.bad_rooms.include?(r.id)
          location_list.push(r.id)
        end
      }

      if location_list.empty?
        EBounty.msg("warn", "The bandit location list is empty: Please report this to EO.")
        EBounty.msg("warn", "checkbounty: #{checkbounty}")
        EBounty.exit_script
      end

      EBounty.msg("debug", " find_location: location_list - #{location_list}")
      location_list.each { |id|
        Room[id].wayto.keys.each { |room|
          next if location_list.include?(room.to_i)

          boundary_list.push(room.to_s)
        }
      }
      EBounty.msg("debug", "Bandits: boundary_list - #{boundary_list}")
      EBounty.data.location_start = Room.current.find_nearest(location_list).to_s
      EBounty.data.location_boundaries = boundary_list.join(",")
    end

    def self.bandit_bounty(location)
      EBounty.msg("debug", "bandit_bounty | location: #{location}")

      EBounty.switch_profile("bandits")
      Task.find_location(location)
      before_dying { $bigshot_bandits = false }
      Hunting.go_hunting
    end

    def self.bounty_complete
      EBounty.msg("debug", "bounty_complete")

      original_checkbounty = checkbounty

      unless EBounty.data.settings[:basic]
        # Make sure the default profile is loaded
        EBounty.load_default_profile
      end

      if checkmind("saturated")
        EBounty.go2_rest
        EBounty.exit_script if EBounty.data.settings[:basic] || EBounty.data.settings[:once_and_done]
        Task.prep
      end

      # Hang out until not satuarated
      until !checkmind("saturated")
        EBounty.exit_script if (EBounty.data.settings[:basic] || EBounty.data.settings[:once_and_done])
        sleep 0.5
        Hunting.go_hunting if EBounty.data.settings[:keep_hunting]
      end

      # Go over to the adventure guild
      EBounty.go2('advguild')

      # Turn in the bounty
      npc = Room.current.uid.first == 7503207 ? "Halfwhistle" : "Taskmaster"
      fput "ask #{npc} about bounty"

      EBounty.bounty_change(original_checkbounty)

      if EBounty.data.settings[:basic]
        EBounty.silver_deposit
        return
      end

      if EBounty.data.settings[:once_and_done]
        EBounty.silver_deposit
        EBounty.go2_rest
        EBounty.exit_script
      end

      Task.prep
    end

    def self.bounty_get
      EBounty.msg("debug", "bounty_get")

      EBounty.go2('advguild')

      original_checkbounty = checkbounty
      npc = GameObj.npcs.find { |npcs| npcs.name =~ /(?:taskmaster|Halfwhistle)/i }
      dothistimeout "ask #{npc} about bounty", 3, Regexp.union(
        /The local gem dealer, .*, has an order to fill and wants our help./,
        /The local furrier .* has an order to fill and wants our help./,
        /It appears they have a .* problem they'd like you to solve./,
        /It appears that a local resident urgently needs our help in some matter.  Go report to .* to find out more./,
        /The local (healer|herbalist), .*, has asked for our aid./,
        /You have already been assigned a task, \w+./,
        /It appears they need your help in tracking down some kind of lost heirloom.  Go report to .* to find out more./,
        /Come back in about .* (?:minute|minutes) if you want another task./
      )

      EBounty.bounty_change(original_checkbounty)
    end

    def self.bounty_remove(just_remove = false)
      EBounty.msg("debug", "Task.bounty_remove")

      EBounty.go2('advguild')
      npc = GameObj.npcs.find { |npcs| npcs.name =~ /(?:taskmaster|Halfwhistle)/i }
      until checkbounty =~ /You are not currently assigned a task/
        fput "ask #{npc} about removal"
        EBounty.wait_rt
      end

      return if just_remove

      if EBounty.data.settings[:use_vouchers] && !Effects::Buffs.active?("Bounty Boost")
        fput "ask ##{npc.id} about expediting"
        EBounty.wait_rt
      end
    end

    def self.child_found
      EBounty.msg("debug", "Task.child_found | caller: #{caller[0]}")
      if GameObj.npcs.find { |n| n.name =~ /child/i }
        Script.run(EBounty.data.rescue_script)
        sleep 2
        kill_script("go2") if running?("go2")

        EBounty.go2_rest

        Hunting.post_hunt("child")
      else
        EBounty.msg("yellow", "Child not found. Please go to the room the child is in and restart the script.")
        EBounty.exit_script
      end
    end

    def self.child_bounty(creature)
      EBounty.msg("debug", "child_bounty | creature: #{creature}")

      if running? "child-bigshot"
        kill_script("child-bigshot")
        before_dying { Script.start('child-bigshot') }
      end

      EBounty.switch_profile(creature)

      EBounty.go2_rest

      Hunting.go_hunting

      if GameObj.npcs.find { |n| n.name =~ /child/i } && checkbounty =~ /^You have made contact with the child you are to rescue/
        Script.run(EBounty.data.rescue_script)
        sleep 2
        kill_script("go2") if running?("go2")

        # Just in case we are garrotted
        if GameObj.npcs.find { |n| n.name =~ /child/i } && cutthroat?
          room = Room.current.id
          EBounty.check_health
          EBounty.go2(room)
          Script.run(EBounty.data.rescue_script)
          sleep 2
        end

        if Stats.prof == "Bard"
          lines = EBounty.get_lines("spell active", /<dialogData id='Active Spells'/)

          if lines.any? { |l| l =~ /Song of Peace/ }
            fput "stop 1011"
          end
        end

        EBounty.go2_rest

        Hunting.post_hunt("child")
      end
    end

    def self.creature_culling(creature)
      EBounty.msg("debug", "creature_culling | creature: #{creature}")

      EBounty.switch_profile(creature)
      Hunting.go_hunting
    end

    def self.escort(pickup, dropoff)
      EBounty.msg("debug", "escort | pickup: #{pickup} dropoff: #{dropoff}")

      escort_pickup = {
        "the area just inside the Sapphire Gate"                   => "illy",
        "the area just inside the North Gate"                      => "landing",
        "the south end of North Market"                            => "solhaven",
        "the area just north of the South Gate, past the barbican" => "icemule",
        "the Kresh'ar Deep monument"                               => "zul",
        "the area just inside the Amaranth Gate"                   => "vaalor",
      }

      escort_dropoff = {
        "Wehnimer's Landing" => "landing",
        "Icemule Trace"      => "icemule",
        "Zul Logoth"         => "zul",
        "Solhaven"           => "solhaven",
        "Ta'Vaalor"          => "vaalor",
        "Ta'Illistim"        => "illy",
      }

      trip = "#{escort_pickup[pickup]}_to_#{escort_dropoff[dropoff]}"

      unless EBounty.data.settings[:escort_types].include?(trip) && EBounty.data.settings[:bounty_types].include?("escort")
        Task.bounty_remove
        return
      end

      EBounty.exit_script if EBounty.data.settings[:basic]

      Hunting.pre_hunt("escort")

      # Turn off portals
      use_portals = UserVars.mapdb_use_portals
      UserVars.mapdb_use_portals = 'no'
      before_dying { UserVars.mapdb_use_portals = use_portals }

      Script.run(EBounty.data.escort_script)
      sleep 2

      # Reset original portal value
      UserVars.mapdb_use_portals = use_portals

      EBounty.go2_rest

      Hunting.post_hunt("escort")
    end

    def self.forage_ask
      EBounty.msg("debug", "forage_ask")

      town = Room[EBounty.data.bounty_towns_uid[Parser.parse[:town]]]
      room = town.find_nearest(EBounty.data.herbalist_rooms)

      EBounty.go2(room)

      EBounty.wait_rt
      herbalist = GameObj.npcs.find { |t| t.name =~ EBounty.data.herbalist_names }

      original_checkbounty = checkbounty
      dothistimeout("ask ##{herbalist.id} about bounty", 5, /Yes, I do have a task for you/)

      EBounty.bounty_change(original_checkbounty)
    end

    def self.forage_find(herb, herb_fix, location)
      herb = 'ayana leaf' if herb =~ /ayana (weed|lichen|berry|root)/
      herb = "ayana'al leaf" if herb =~ /ayana'al (weed|lichen|berry|root)/
      herb = herb == "trollear mushroom" ? "trollfear mushroom" : herb

      herb_alt = herb.gsub(/^some /, "")
      # herb_fix = forage_item.gsub(/^forage /, "").strip

      # Grab all the rooms that mostly match.
      location_list = []
      Room.list.find_all do |r|
        if r.tags.any? { |tag| (tag.end_with? herb) || ((herb.start_with? tag) && herb =~ /ayana/) || (herb.end_with? tag) }
          location_list.push(r.id)
        end
      end

      # Reject the rooms with herbs that don't match
      location_list = location_list.reject { |room|
        !Room[room].tags.any? { |tag| tag =~ /#{herb}|#{herb_alt}|#{herb_fix}/ }
      }

      # This is for CLI herb foraging
      # ;ebounty forage "<type of herb>" <number to find>  for example ;ebounty forage "some acantha leaf" 3
      if location == "nearest"
        _previous, shortest_distances = Room.current.dijkstra
        location_list.delete_if { |room_id| shortest_distances[room_id].nil? }
        location_list = location_list.sort { |a, b| shortest_distances[a] <=> shortest_distances[b] }

        location_list = location_list.first(10)

        location_list.each { |room|
          if Room.current.path_to(room) == nil
            location_list.delete(room)
          else
            travel = Map.estimate_time(Room.current.path_to(room))
            location_list.delete(room) if travel.to_i > 90
          end
        }

        return location_list
      end

      # Reject the locations that don't match
      location_list = location_list.reject { |room|
        Room[room].location.to_s !~ /#{location.strip}/
      }

      _previous, shortest_distances = Room.current.dijkstra
      location_list.delete_if { |room_id| shortest_distances[room_id].nil? }
      location_list = location_list.sort { |a, b| shortest_distances[a] <=> shortest_distances[b] }

      location_list.each { |room|
        travel = Map.estimate_time(Room.current.path_to(room))
        location_list.delete(room) if travel.to_i > 90
      }

      return location_list
    end

    def self.forage_bounty(herb, quantity, location = "nearest")
      herb = herb == "trollear mushroom" ? "trollfear mushroom" : herb
      EBounty.msg("debug", "forage_bounty: herb - #{herb} | location - #{location} | quantity - #{quantity}")

      creatures = []

      current_room = Room.current.id
      amount = EBounty.data.sacks["default"].contents.find_all { |i| i.name =~ /#{herb}/ }.length

      if location == "nearest"
        forage_item = herb
        if (amount >= quantity.to_i)
          EBounty.msg("yellow", " Default container has #{amount} #{amount > 1 ? forage_item + 's' : forage_item}. Quantity requested: #{quantity.to_i}")
          EBounty.exit_script
        end
      else
        Task.forage_return if amount >= quantity.to_i
        Task.bounty_check if Task.forage_turnin(herb)
        lines = EBounty.get_lines("bounty", /<a exist=".*?" noun="#{Char.name}"/)
        forage_link = Regexp.last_match(1) if lines.any? { |l| l =~ /concoction that requires <d cmd=\"(.*?)\">/ }
        forage_item = forage_link.gsub(/^forage /, "").strip
      end

      location_list = Task.forage_find(herb, forage_item, location)

      unless location_list.length.positive?
        echo "No #{herb} found at #{location}" if location != "nearest"
        echo "No #{herb} found" if location == "nearest"
        EBounty.exit_script
      end

      Hunting.pre_hunt("forage")

      EBounty.wait_rt
      fput "stance defensive" unless stance =~ /defensive|guarded/

      location_list.each { |room|
        EBounty.go2(room)

        unless (GameObj.targets.count.positive? && EBounty.data.settings[:forage_options].include?("run")) || checkpcs || GameObj.loot.any? { |i| i.name =~ /black void/ }

          empty_hands

          loop {
            unless Map.current.tags.include?("meta:nomagic")
              # Cast any helper spells before kneeling
              if Stats.prof =~ /Cleric|Empath/i && EBounty.data.settings[:forage_options].include?("use_213")
                lines = EBounty.get_lines("sense", /You open your soul to the lesser/)
                unless lines.any? { |l| l =~ /An obvious presence of peace saturates the area and a feeling of safety overwhelms you/ }
                  Spell[213].cast if Spell[213].known? && Spell[213].affordable?
                end
              end

              if EBounty.data.settings[:forage_options].include?("use_1011")
                lines = EBounty.get_lines("spell active", /<dialogData id='Active Spells'/)
                Spell[1011].cast if Spell[1011].known? && Spell[1011].affordable? unless lines.grep(/Song of Peace/).any?
              end

              if EBounty.data.settings[:forage_options].include?("use_709") && !GameObj.targets.any? { |c| c.name =~ /arm/ } && !GameObj.targets.empty?
                Spell[709].cast if Spell[709].known? && Spell[709].affordable?
              end

              Spell[604].cast if Spell[604].known? && Spell[604].affordable? && !Effects::Spells.active?("Nature's Bounty") && EBounty.data.settings[:forage_options].include?("use_604")
              Spell[506].cast if Spell[506].known? && Spell[506].affordable? && !Effects::Buffs.active?("Celerity") && !Effects::Cooldowns.active?("Celerity") && EBounty.data.settings[:forage_options].include?("use_506")
              Spell[919].cast if Spell[919].known? && Spell[919].affordable? && !Effects::Buffs.active?("Wizard's Shield") && !Effects::Cooldowns.active?("Wizard's Shield") && EBounty.data.settings[:forage_options].include?("use_919")
              Spell[140].cast if Spell[140].known? && Spell[140].affordable? && !Effects::Buffs.active?("Wall of Force") && !Effects::Cooldowns.active?("Wall of Force") && EBounty.data.settings[:forage_options].include?("use_140")
              Spell[1035].cast if Spell[1035].known? && Spell[1035].affordable? && !Effects::Buffs.active?("Song of Tonis") && EBounty.data.settings[:forage_options].include?("use_1035")
              Spell[9704].cast if Spell[9704].known? && Spell[9704].affordable? && !Effects::Buffs.active?("Sigil of Resolve") && EBounty.data.settings[:forage_options].include?("use_resolve")

              if !GameObj.targets.empty? && EBounty.data.settings[:forage_options].include?("use_619")
                targets = GameObj.targets.reject { |w| creatures.any? { |c| c.id == w.id } }
                Spell[619].cast if Spell[619].known? && Spell[619].affordable? && targets.length.positive? && !Map.current.tags.include?("meta:nomagic")
                creatures.concat(targets)
                sleep 0.5
                waitcastrt?
              end
            end

            until kneeling?
              fput 'kneel'
              sleep 0.2
            end

            if EBounty.data.settings[:forage_options].include?("use_650") && !Map.current.tags.include?("meta:nomagic")
              if Spell[650].known? && Spell[650].affordable? && !Spell[650].active? && !Spell[9039].active?
                multifput("prep 650", "assume yierka")
              elsif Spell[650].active? && !Spell[9039].active?
                waitcastrt?
                fput "assume yierka"
              end
            end

            if (EBounty.data.settings[:forage_options].include?("hiding") && !EBounty.data.settings[:forage_options].include?("use_608")) || EBounty.data.settings[:forage_options].include?("use_gambit")
              fput "hide" unless hidden?
            elsif EBounty.data.settings[:forage_options].include?("use_608")
              unless Map.current.tags.include?("meta:nomagic")
                Spell[608].cast if Spell[608].known? && Spell[608].affordable?
              else
                fput "hide" if !(hidden?) && EBounty.data.settings[:forage_options].include?("hiding")
              end
            end

            forage_result = dothistimeout "forage for #{forage_item}", 2, EBounty.data.forage_result
            EBounty.wait_rt
            if forage_result =~ /^You forage briefly and manage to find/
              item = [GameObj.right_hand, GameObj.left_hand].find { |i| i.noun != nil }

              if EBounty.data.gambits_available
                5.times {
                  fput "rgambit stealth put my #{item} in my #{EBounty.data.sacks["default"]}"
                  EBounty.wait_rt
                  break if (![GameObj.right_hand, GameObj.left_hand].map(&:id).compact.include?(item.id) && EBounty.data.sacks["default"].contents.to_a.map(&:id).include?(item.id))
                }
              end
              fput "stow left" if checkleft
              fput "stow right" if checkright

              EBounty.msg("debug", "forage_bounty: herb - #{herb} | location - #{location} | quantity - #{quantity} | Default sack: #{EBounty.data.sacks["default"].inspect} | contents: #{EBounty.data.sacks["default"].contents}")

              amount = EBounty.data.sacks["default"].contents.find_all { |i| i.name =~ /#{forage_item}/ }.length
              EBounty.msg("yellow", " #{amount} of #{quantity.to_i} #{amount > 1 ? forage_item + 's' : forage_item} foraged")
              break if amount >= quantity.to_i

            elsif forage_result =~ EBounty.data.forage_injury
              EBounty.wait_rt
              Spell[114].cast if Spell[114].known? and Spell[114].affordable? && !Map.current.tags.include?("meta:nomagic")
            elsif forage_result.nil? || (forage_result =~ /^As you carefully forage around you (can find no hint|see no evidence) of what you are looking for(?: right now, though you are fairly certain this is where it can be found)?\./)
              break
            elsif forage_result =~ /^As you forage around, you notice that someone has been foraging here recently and you are unable to find anything useful\./
              unless Effects::Cooldowns.active?("Nature's Bounty Foraging") || Skills.slblessings < 15 || !Spell[604].affordable? || !Spell[604].known? || !EBounty.data.settings[:forage_options].include?("use_604evoke") || Map.current.tags.include?("meta:nomagic")
                Spell[604].force_evoke
                next
              end
              break
            end

            if (XMLData.injuries.any? { |_a, h| h['wound'] > 1 || h['scar'] > 1 } || percenthealth < 70) && !EBounty.data.settings[:skip_healing]
              return_room = Room.current.id
              EBounty.go2_rest
              if location == 'nearest'
                EBounty.check_health
              else
                Task.prep
              end
              EBounty.go2(return_room)
            end

            break if (!GameObj.targets.empty? && EBounty.data.settings[:forage_options].include?("run"))
          }

          fput 'stand' until standing?

          fill_hands

          if Stats.prof =~ /Cleric|Empath/i && EBounty.data.settings[:forage_options].include?("use_213")
            lines = EBounty.get_lines("sense", /You open your soul to the lesser/)
            if lines.any? { |l| l =~ /An obvious presence of peace saturates the area and a feeling of safety overwhelms you/ }
              fput "stop 213"
            end
          end

          break if EBounty.data.sacks["default"].contents.find_all { |i| i.name =~ /#{forage_item}/ }.length >= quantity.to_i

        end
      }

      lines = EBounty.get_lines("spell active", /<dialogData id='Active Spells'/)

      if EBounty.data.settings[:forage_options].include?("use_1011")
        lines = EBounty.get_lines("spell active", /<dialogData id='Active Spells'/)
        fput "stop 1011" if lines.grep(/Song of Peace/).any?
      end

      if location != "nearest"
        Task.forage_return
      else
        EBounty.go2(current_room)
      end
    end

    def self.forage_turnin(herb)
      herb = herb == "trollfear mushroom" ? "trollear mushroom" : herb
      # Only turn in if we are close. If out in the field its a waste of time
      town = Room[EBounty.data.bounty_towns_uid[Parser.parse[:town]]]
      room = town.find_nearest(EBounty.data.herbalist_rooms)

      _previous_var, shortest_distances_var = Room.current.dijkstra
      if shortest_distances_var[room] > 2
        return false
      end

      herb = herb.gsub(/^some /, "")

      EBounty.open_container(EBounty.data.sacks["default"])
      herbs = EBounty.data.sacks["default"].contents.find_all { |i| (i.name.end_with? herb) || ((herb.start_with? i.name) && (herb =~ /ayana/)) }

      if herbs.length.positive?
        EBounty.go2(room)

        herbalist = GameObj.npcs.find { |t| t.name =~ EBounty.data.herbalist_names }

        empty_hands

        original_checkbounty = checkbounty
        herbs.each do |h|
          original_checkbounty = checkbounty

          EBounty.get_res("_drag ##{h.id} right", EBounty.data.get_regex)
          res = EBounty.get_res("give ##{h.id} to #{herbalist}", /This looks perfect|That looks like it has been partially used up/)

          # Fixme - check if hand empty before stowing
          if res !~ /perfect/
            fput "stow ##{h.id}"
            break
          end
        end

        fill_hands

        EBounty.bounty_change(original_checkbounty)

        return true
      end

      return false
    end

    def self.forage_return(recover_room: true)
      EBounty.msg("debug", "forage_return")

      EBounty.fog

      EBounty.go2_rest

      if checkbounty =~ /The.*is working on a concoction that requires (?:a|an|some) (.*) found/
        herb = $1
      end

      herb = herb.gsub(/^some /, "")

      EBounty.open_container(EBounty.data.sacks["default"])
      herbs = EBounty.data.sacks["default"].contents.find_all { |i| (i.name.end_with? herb) || ((herb.start_with? i.name) && (herb =~ /ayana/)) }

      if herbs.length.positive?

        town = Room[EBounty.data.bounty_towns_uid[Parser.parse[:town]]]
        room = town.find_nearest(EBounty.data.herbalist_rooms)
        EBounty.go2(room)

        EBounty.wait_rt
        herbalist = GameObj.npcs.find { |t| t.name =~ EBounty.data.herbalist_names }

        empty_hands

        original_checkbounty = checkbounty
        herbs.each do |h|
          original_checkbounty = checkbounty

          EBounty.get_res("_drag ##{h.id} right", EBounty.data.get_regex)
          res = EBounty.get_res("give ##{h.id} to ##{herbalist.id}", /This looks perfect|That looks like it has been partially used up/)

          # Fixme - check if hand empty before stowing
          if res !~ /perfect/
            fput "stow ##{h.id}"
          end
        end

        EBounty.bounty_change(original_checkbounty)
      end

      fill_hands

      Hunting.post_hunt("forage")

      if checkbounty =~ /The.*is working on a concoction that requires (?:a|an|some) (.*) found/ && recover_room
        EBounty.go2_rest
        EBounty.msg("yellow", " Didn't finish foraging task. Sleeping 3 minutes to let the room recover")
        sleep 180
      end
    end

    def self.gem_ask
      EBounty.msg("debug", "gem_ask")

      town = Room[EBounty.data.bounty_towns_uid[Parser.parse[:town]]]
      room = town.find_nearest_by_tag('gemshop')
      EBounty.go2(room)

      npc = GameObj.npcs.find { |t| t.name =~ /areacne|dwarven clerk|gem dealer|jeweler|Zirconia|Brindlestoat/i }.noun

      original_checkbounty = checkbounty
      dothistimeout("ask #{npc} about bounty", 5, /Yes, I do have a task for you/)

      EBounty.bounty_change(original_checkbounty)

      unless EBounty.data.settings[:gem_history].to_s.empty?
        EBounty.run_scripts(EBounty.data.settings[:gem_history])
      end
    end

    def self.gem_bounty(kind = nil, amount = nil)
      EBounty.msg("debug", "gem_bounty")

      EBounty.data.remaining_gems = amount.to_i
      EBounty.data.gem = kind.gsub(/^a/, "")

      # Run bounty script here
      unless EBounty.data.settings[:hording_script].to_s.empty?
        EBounty.data.settings[:hording_script].split(/,\s*/).each do |i|
          tokens = i.split(/\s+/)
          if (tokens.size > 1)
            Script.run(tokens[0], tokens[1..-1].to_s)
          else
            Script.run(tokens[0])
          end
        end
      end

      # the hoarding script may have handled selling the gems
      if checkbounty =~ /succeeded in your task/
        return
      end

      # Lets check if we have enough gems to turn in already
      count = 0
      EBounty.data.containers.each { |container|
        EBounty.open_container(container)
        container.contents.each { |item|
          if item.name =~ /#{EBounty.data.gem}/
            count += 1
          end
        }
      }

      if count >= EBounty.data.remaining_gems
        if EBounty.data.loot_script == 'eloot' && defined?(ELoot) && !ELoot.data.settings[:sell_loot_types].include?("gem")
          EBounty.msg("error", " You've choosen to not sell gems via ;eloot sell! Please handle gem bounty manually!")
          exit
        else
          Task.prep(no_check: true)
        end
      else
        EBounty.load_default_profile
        Hunting.go_hunting
      end
    end

    def self.heirloom_bounty(item = nil, critter = nil, location = nil, type = nil)
      EBounty.msg("debug", "heirloom_bounty | item: #{item} | critter: #{critter} | location: #{location} | type: #{type}")

      case type
      when /loot/i
        EBounty.switch_profile(critter)
        Hunting.go_hunting
      when /search/i
        Task.heirloom_search(critter, item)
      end
    end

    def self.heirloom_search(critter, item)
      EBounty.msg("debug", "heirloom_search | item: #{item} | critter: #{critter}")
      creatures = []

      EBounty.switch_profile(critter)

      Hunting.pre_hunt("heirloom")

      if EBounty.data.settings[:heirloom_options].include?("use_right")
        fput "flag righthand on"
        before_dying { EBounty.get_lines("flag righthand off", /You will not attempt to pickup treasure using your right hand./) }
      end

      EBounty.go2(UserVars.op['hunting_room_id'])
      wander_rooms ||= Array.new

      # fixme: need to support uid
      boundaries = UserVars.op['hunting_boundaries'].split(",")
      EBounty.msg("debug", "heirloom_search | boundaries: #{boundaries}")

      wander = proc {
        room = Room.current
        next_room_options = room.wayto.keys - boundaries
        next_room_options.delete_if { |room_id| (room.timeto[room_id].class == Proc) and room.timeto[room_id].call.nil? }
        next_room = next_room_options.find_all { |r| not wander_rooms.include?(r) }
        if next_room.empty?
          next_room = wander_rooms.find { |r| next_room_options.include?(r) }
        else
          next_room = next_room[rand(next_room.length)]
        end
        wander_rooms.delete(next_room)
        wander_rooms.push(next_room)
        way = room.wayto[next_room]
        if way.class == String
          move(way)
        else
          way.call
        end
      }

      fput "stance defensive"

      loop {
        unless (GameObj.targets.count.positive? && EBounty.data.settings[:heirloom_options].include?("run")) || checkpcs || GameObj.loot.each { |i| i.name =~ /black void/ }
          unless Map.current.tags.include?("meta:nomagic")
            if Stats.prof =~ /Cleric|Empath/i && EBounty.data.settings[:heirloom_options].include?("use_213")
              lines = EBounty.get_lines("sense", /You open your soul to the lesser/)
              unless lines.any? { |l| l =~ /An obvious presence of peace saturates the area and a feeling of safety overwhelms you/ }
                Spell[213].cast if Spell[213].known? && Spell[213].affordable?
              end
            end

            if EBounty.data.settings[:heirloom_options].include?("use_1011")
              lines = EBounty.get_lines("spell active", /<dialogData id='Active Spells'/)
              Spell[1011].cast if Spell[1011].known? && Spell[1011].affordable? unless lines.grep(/Song of Peace/).any?
            end

            if EBounty.data.settings[:heirloom_options].include?("use_709") && !GameObj.targets.any? { |c| c.name =~ /arm/ } && !GameObj.targets.empty?
              Spell[709].cast if Spell[709].known? && Spell[709].affordable?
            end

            # Cast any helper spells before kneeling
            Spell[402].cast if Spell[402].known? && Spell[402].affordable? && !Effects::Buffs.active?("Presence") && EBounty.data.settings[:heirloom_options].include?("use_402")
            Spell[506].cast if Spell[506].known? && Spell[506].affordable? && !Effects::Buffs.active?("Celerity") && !Effects::Cooldowns.active?("Celerity") && EBounty.data.settings[:heirloom_options].include?("use_506")
            Spell[919].cast if Spell[919].known? && Spell[919].affordable? && !Effects::Buffs.active?("Wizard's Shield") && !Effects::Cooldowns.active?("Wizard's Shield") && EBounty.data.settings[:heirloom_options].include?("use_919")
            Spell[140].cast if Spell[140].known? && Spell[140].affordable? && !Effects::Buffs.active?("Wall of Force") && !Effects::Cooldowns.active?("Wall of Force") && EBounty.data.settings[:heirloom_options].include?("use_140")
            Spell[1035].cast if Spell[1035].known? && Spell[1035].affordable? && !Effects::Buffs.active?("Song of Tonis") && EBounty.data.settings[:heirloom_options].include?("use_1035")

            if !GameObj.targets.empty? && EBounty.data.settings[:heirloom_options].include?("use_619")
              targets = GameObj.targets.reject { |w| creatures.any? { |c| c.id == w.id } }
              Spell[619].cast if Spell[619].known? && Spell[619].affordable? && targets.length.positive?
              creatures.concat(targets)
              sleep 0.5
              waitcastrt?
            end
          end

          until kneeling?
            fput 'kneel'
            sleep 0.2
          end

          empty_hands if checkleft || checkright

          fput "search"
          EBounty.wait_rt

          fput "stand" until standing?
          EBounty.wait_rt

          if checkright
            EBounty.get_res("stow ##{GameObj.right_hand.id}", EBounty.data.put_regex)
          else
            heirloom = GameObj.loot.find { |obj| obj.name =~ /#{item}/ }

            if heirloom
              EBounty.get_res("_drag ##{heirloom.id} right", EBounty.data.get_regex)
              EBounty.get_res("stow ##{heirloom.id}", EBounty.data.put_regex)
            end
          end

          Script.run(EBounty.data.loot_script) if GameObj.loot.length.positive?

          fill_hands
        end

        if Stats.prof =~ /Cleric|Empath/i && EBounty.data.settings[:forage_options].include?("use_213")
          lines = EBounty.get_lines("sense", /You open your soul to the lesser/)
          if lines.grep(/An obvious presence of peace saturates the area and a feeling of safety overwhelms you/).any?
            fput "stop 213"
          end
        end

        break if checkbounty =~ /You have located/

        wander.call
      }

      if EBounty.data.settings[:heirloom_options].include?("use_1011")
        lines = EBounty.get_lines("spell active", /<dialogData id='Active Spells'/)
        fput "stop 1011" if lines.grep(/Song of Peace/).any?
      end

      town = Room[EBounty.data.bounty_towns_uid[Parser.parse[:town]]]
      EBounty.go2(town.id)

      Hunting.post_hunt("heirloom")

      fput "flag righthand off" if EBounty.data.settings[:heirloom_options].include?("use_right")
    end

    def self.skin_ask
      EBounty.msg("debug", "skin_ask")

      town = Room[EBounty.data.bounty_towns_uid[Parser.parse[:town]]]
      room = town.find_nearest_by_tag('furrier')
      EBounty.go2(room)

      npc = GameObj.npcs.find { |t| t.name =~ /dwarven clerk|furrier|Delosa|Bramblefist/i }
      dothistimeout("ask #{npc} about bounty", 5, /Yes, I do have a task for you/)
      sleep 2
    end

    def self.skin_bounty(creature, skin, quantity)
      EBounty.msg("debug", "skin_bounty")

      EBounty.data.bundle_skin = skin.match(/(\w+)\s+(\w+)\s*\Z/)

      skin = skin.strip.downcase
                 .gsub(/s$/, "")
                 .gsub(/teeth/, "tooth")
                 .gsub(/hooves?/, "hoof")
                 .gsub(/ruffs?/, "ruff")

      EBounty.data.remaining_skins = quantity.to_i + EBounty.data.settings[:extra_skin].to_i
      EBounty.msg("debug", "EBounty.data.remaining_skins: #{EBounty.data.remaining_skins}")
      EBounty.data.skin = skin

      # Lets check if we have enough skins to turn in already
      count = 0
      EBounty.data.containers.each { |container|
        EBounty.open_container(container)
        container.contents.each { |item|
          if item.name =~ /bundle of #{EBounty.data.bundle_skin}/
            lines = EBounty.issue_command("measure ##{item.id}", /You glance through/)
            lines.each do |l|
              if l =~ /count a total of (\d+) <a exist/
                count += $1.to_i
              end
            end
          elsif item.name =~ /#{EBounty.data.skin}/
            count += 1
          end
        }
      }

      if count >= EBounty.data.remaining_skins
        if EBounty.data.loot_script == 'eloot' && defined?(ELoot) && !ELoot.data.settings[:sell_loot_types].include?("skin")
          EBounty.msg("error", " You've choosen to not sell skins via ;eloot sell! Please handle skin bounty manually!")
          exit
        else
          Task.prep(no_check: true)
        end
      else
        EBounty.switch_profile(creature)
        Hunting.go_hunting
      end
    end

    def self.task_failed
      EBounty.msg("debug", "task_failed")

      EBounty.go2('advguild')

      # Turn in the bounty - Fixme: dothistimeout
      npc = GameObj.npcs.find { |npcs| npcs.name =~ /(?:taskmaster|Halfwhistle)/i }
      fput "ask #{npc} about bounty"
      sleep 3
    end

    def self.prep(no_check: false)
      EBounty.msg("debug", "Task.prep | caller: #{caller[0]}")
      # lets make sure we are healed up - Need support for empaths
      EBounty.check_health

      start_room = Room.current.id

      # Sell stuff
      if EBounty.data.sacks["default"].contents.any? { |item| !item.sellable.nil? || item.type =~ /box/ } || no_check
        Script.run(EBounty.data.loot_script, 'sell')
      end

      EBounty.silver_deposit
      EBounty.go2(start_room)
    end

    def self.wait_for_bounty
      EBounty.msg("debug", "wait_for_bounty")

      EBounty.exit_script if EBounty.data.settings[:basic]

      EBounty.load_default_profile

      if Task.check_boost && !Effects::Buffs.active?("Bounty Boost")
        fput "boost bounty"
        sleep 4
      elsif Effects::Buffs.active?("Bounty Boost")
        sleep 4
      else
        Hunting.go_hunting
      end
    end
  end
end

EBounty.version_check

current_op = UserVars.op

before_dying {
  Script.kill("bigshot") if Script.running?("bigshot")
  UserVars.op = current_op
}

if Script.current.vars[1] =~ /ver/i
  echo "EBounty Version: #{EBounty.get_script_version}"
  exit
end

# Initialize default settings
unless EBounty.data
  EBounty.load(EBounty.load_profile())
end

unless EBounty.data.settings[:basic]
  required_scripts = %w(bigshot)
  required_scripts.push("eherbs") if EBounty.data.settings[:healing_script].to_s.empty? && !EBounty.data.settings[:skip_healing]
  required_scripts.push("eloot")  if EBounty.data.settings[:selling_script].to_s.empty?
  required_scripts.push("echild") if EBounty.data.settings[:rescue_script].to_s.empty? && EBounty.data.settings[:bounty_types].include?("rescue")
  required_scripts.push("ego2")   if EBounty.data.settings[:escort_script].to_s.empty? && EBounty.data.settings[:bounty_types].include?("escort")
  required_scripts_missing = required_scripts.select { |s| !Script.exists?(s) }
  if required_scripts_missing.count > 0
    echo("You must also download the following script#{required_scripts_missing.count > 1 ? 's' : ''} to use ebounty:  " + required_scripts_missing.join(', '))
    exit
  end
end

case Script.current.vars[1]
when nil, /once/
  if Script.current.vars[1] =~ /once/
    basic_setting = EBounty.data.settings[:basic]
    EBounty.data.settings[:basic] = false

    once_settings = EBounty.data.settings[:once_and_done]
    EBounty.data.settings[:once_and_done] = true

    before_dying {
      EBounty.data.settings[:basic] = basic_setting
      EBounty.data.settings[:once_and_done] = once_settings
    }
  end

  if Room.current.id.nil?
    EBounty.msg "error", 'Please start ebounty in a mapped room.'
    exit
  else
    EBounty.data.start_room = Room.current.id
  end

  current_settings = UserVars.op
  EBounty.over_watch
  EBounty.set_variables
  EBounty.data.close_containers = []

  before_dying {
    UserVars.op = current_settings
    EBounty.go2(EBounty.data.start_room) if EBounty.data.settings[:basic]

    # Close any containers we had to open
    EBounty.msg("debug", "before_dying | EBounty.data.close_containers: #{EBounty.data.close_containers}")
    EBounty.data.close_containers.each { |bag_id|
      close_regex = /You close .*|That is already closed|What were you referring to|seem to be any way to do that|You tie|You fold the/
      EBounty.get_lines("close ##{bag_id}", close_regex)
    }
  }

  EBounty::Task.bounty_check
when 'debug'
  respond
  EBounty::Setup.update_setting(:debug, !EBounty.data.settings[:debug])
  EBounty.data.settings[:debug] = !EBounty.data.settings[:debug]
  EBounty.save_profile()
  respond
when 'list'
  EBounty::Setup.new(EBounty.data.settings).list
when 'settings'
  if Script.current.vars[2]
    EBounty.update_setting(Script.current.vars[2..-1])
  else
    EBounty::Setup.new(EBounty.data.settings).start
    EBounty.load(EBounty.load_profile())
    EBounty.set_variables
  end
when 'setup'
  EBounty::Setup.new(EBounty.data.settings).start
  EBounty.load(EBounty.load_profile())
  EBounty.set_variables
when 'load'
  EBounty.load(EBounty.load_profile)
  EBounty.set_variables
when 'remove'
  if Room.current.id.nil?
    EBounty.msg "error", 'Please start ebounty in mapped room.'
    exit
  else
    EBounty.data.start_room = Room.current.id
  end
  EBounty::Task.bounty_remove(true)
  EBounty.go2(EBounty.data.start_room)
when 'forage'
  if Script.current.vars[2].nil? || Script.current.vars[3].nil?
    EBounty.msg "error", ' Proper syntax: ;ebounty forage "herb to find" <how many>'
    exit
  end
  return_room = Room.current.id
  EBounty.load(EBounty.load_profile)
  EBounty.set_variables(load_profile: false)
  EBounty::Task.forage_bounty(Script.current.vars[2], Script.current.vars[3].to_i)
  EBounty.go2(return_room)
when /location/i
  if EBounty::Parser.parse[:requirements][:area].nil?
    respond
    EBounty.msg "yellow", " No location specified for the current bounty. | Bounty: #{EBounty::Parser.parse}"
    respond
  else
    respond
    EBounty.msg "yellow", " Bounty Location: #{EBounty::Parser.parse[:requirements][:area]}"
    respond
  end
when /creature/i
  if EBounty::Parser.parse[:requirements][:creature].nil?
    respond
    EBounty.msg "yellow", " No creature specified for the current bounty. | Bounty: #{EBounty::Parser.parse}"
    respond
  else
    respond
    EBounty.msg "yellow", " Bounty Creature: #{EBounty::Parser.parse[:requirements][:creature]}"
    respond
  end
when /bounty/i
  respond
  respond EBounty::Parser.parse
  respond
when 'test'
  EBounty.test
else
  EBounty.help
end
